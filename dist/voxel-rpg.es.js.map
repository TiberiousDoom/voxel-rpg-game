{"version":3,"file":"voxel-rpg.es.js","sources":["../src/core/types.ts","../src/core/EventBus.ts","../src/core/GameEngine.ts","../src/world/TileRegistry.ts","../src/world/TilemapManager.ts","../src/world/AutotileSystem.ts","../src/world/RegionManager.ts","../src/world/NoiseGenerator.ts","../src/world/BiomeManager.ts","../src/world/WorldGenerator.ts","../src/entities/PlayerController.ts","../src/entities/CameraSystem.ts","../src/systems/SaveManager.ts","../src/systems/InputManager.ts","../src/systems/ResourceManager.ts","../src/systems/InventoryManager.ts","../src/systems/CraftingManager.ts","../src/systems/SurvivalManager.ts","../src/ui/UIManager.ts","../src/index.ts"],"sourcesContent":["/**\n * Core type definitions for the 2D RPG game engine\n */\n\n// ============================================================================\n// Vector Types\n// ============================================================================\n\nexport interface Vector2 {\n  x: number;\n  y: number;\n}\n\nexport interface Vector2Int {\n  x: number;\n  y: number;\n}\n\nexport interface Bounds {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n// ============================================================================\n// Direction & Facing\n// ============================================================================\n\nexport enum Direction {\n  North = 'N',\n  South = 'S',\n  East = 'E',\n  West = 'W',\n  NorthEast = 'NE',\n  NorthWest = 'NW',\n  SouthEast = 'SE',\n  SouthWest = 'SW',\n}\n\n// ============================================================================\n// Entity Types\n// ============================================================================\n\nexport enum EntityType {\n  Player = 'player',\n  NPC = 'npc',\n  Monster = 'monster',\n  Item = 'item',\n  Projectile = 'projectile',\n}\n\n// ============================================================================\n// Tile Types\n// Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard\n// ============================================================================\n\nexport enum TileLayer {\n  Background = 0, // Decorative, no collision\n  Ground = 1,     // Terrain, floors\n  Objects = 2,    // Furniture, resources, items\n  Walls = 3,      // Structures, barriers\n  Foreground = 4, // Visual overlays, roofs\n}\n\nexport interface ResourceDrop {\n  resourceId: string;\n  minAmount: number;\n  maxAmount: number;\n  chance: number; // 0-1\n}\n\nexport interface TileType {\n  id: string;\n  name: string;\n  layer: TileLayer;\n  walkable: boolean;\n  hardness: number; // Mining time multiplier (0 = instant, -1 = unbreakable)\n  transparent: boolean;\n  drops: ResourceDrop[];\n  autotileGroup: string | null;\n  buildRequirements: { resourceId: string; amount: number }[];\n}\n\nexport interface Tile {\n  typeId: string;\n  layer: TileLayer;\n  position: Vector2Int;\n  variant: number; // Autotile variant index\n  metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Component System (ECS-lite)\n// ============================================================================\n\nexport interface Component {\n  readonly type: string;\n}\n\nexport interface Entity {\n  id: string;\n  type: EntityType;\n  position: Vector2;\n  velocity: Vector2;\n  facing: Direction;\n  components: Map<string, Component>;\n  active: boolean;\n}\n\n// ============================================================================\n// Game State\n// ============================================================================\n\nexport interface GameTime {\n  totalSeconds: number;\n  deltaTime: number;\n  gameHour: number; // 0-24\n  gameDay: number;\n  isPaused: boolean;\n}\n\nexport interface GameConfig {\n  tileSize: number;\n  regionSize: number; // Tiles per region side\n  loadDistance: number; // Regions to load around player\n  unloadDistance: number; // Regions to unload\n  dayLengthSeconds: number; // Real seconds per game day\n}\n\n// ============================================================================\n// Save Data\n// ============================================================================\n\nexport interface SaveMetadata {\n  version: string;\n  timestamp: number;\n  playtimeSeconds: number;\n  slotName: string;\n}\n\nexport interface SaveData {\n  metadata: SaveMetadata;\n  world: {\n    seed: number;\n    modifiedTiles: Array<{\n      position: Vector2Int;\n      layer: TileLayer;\n      typeId: string;\n    }>;\n  };\n  player: {\n    position: Vector2;\n    health: number;\n    maxHealth: number;\n    inventory: Array<{ itemId: string; quantity: number }>;\n  };\n  gameTime: {\n    totalSeconds: number;\n    gameDay: number;\n  };\n}\n\n// ============================================================================\n// Input Types\n// ============================================================================\n\nexport enum InputAction {\n  MoveUp = 'moveUp',\n  MoveDown = 'moveDown',\n  MoveLeft = 'moveLeft',\n  MoveRight = 'moveRight',\n  Sprint = 'sprint',\n  Interact = 'interact',\n  Attack = 'attack',\n  Secondary = 'secondary',\n  Cancel = 'cancel',\n  Inventory = 'inventory',\n  BuildMenu = 'buildMenu',\n  Pause = 'pause',\n  ZoomIn = 'zoomIn',\n  ZoomOut = 'zoomOut',\n  QuickSlot1 = 'quickSlot1',\n  QuickSlot2 = 'quickSlot2',\n  QuickSlot3 = 'quickSlot3',\n  QuickSlot4 = 'quickSlot4',\n  QuickSlot5 = 'quickSlot5',\n  QuickSlot6 = 'quickSlot6',\n  QuickSlot7 = 'quickSlot7',\n  QuickSlot8 = 'quickSlot8',\n  QuickSlot9 = 'quickSlot9',\n}\n\nexport interface InputBinding {\n  action: InputAction;\n  keys: string[];\n  mouseButtons?: number[];\n  gamepadButtons?: number[];  // Standard Gamepad API button indices\n}\n\n// ============================================================================\n// Gamepad Types\n// Per 2D_GAME_IMPLEMENTATION_PLAN.md - Input System (Gamepad Support)\n// ============================================================================\n\n/**\n * Standard Gamepad button indices (W3C Gamepad API)\n * https://w3c.github.io/gamepad/#remapping\n */\nexport enum GamepadButton {\n  A = 0,            // Bottom button (A on Xbox, X on PlayStation)\n  B = 1,            // Right button (B on Xbox, Circle on PlayStation)\n  X = 2,            // Left button (X on Xbox, Square on PlayStation)\n  Y = 3,            // Top button (Y on Xbox, Triangle on PlayStation)\n  LeftBumper = 4,   // Left shoulder button (LB/L1)\n  RightBumper = 5,  // Right shoulder button (RB/R1)\n  LeftTrigger = 6,  // Left trigger (LT/L2)\n  RightTrigger = 7, // Right trigger (RT/R2)\n  Select = 8,       // Back/Select/Share\n  Start = 9,        // Start/Menu/Options\n  LeftStick = 10,   // Left stick pressed (L3)\n  RightStick = 11,  // Right stick pressed (R3)\n  DPadUp = 12,      // D-pad up\n  DPadDown = 13,    // D-pad down\n  DPadLeft = 14,    // D-pad left\n  DPadRight = 15,   // D-pad right\n  Home = 16,        // Home/Guide button\n}\n\n/**\n * Standard Gamepad axes\n */\nexport enum GamepadAxis {\n  LeftStickX = 0,   // Left stick horizontal (-1 left, 1 right)\n  LeftStickY = 1,   // Left stick vertical (-1 up, 1 down)\n  RightStickX = 2,  // Right stick horizontal\n  RightStickY = 3,  // Right stick vertical\n}\n\n// ============================================================================\n// UI Types\n// ============================================================================\n\nexport enum PanelType {\n  HUD = 'hud',\n  Inventory = 'inventory',\n  Build = 'build',\n  NPC = 'npc',\n  Settings = 'settings',\n  Pause = 'pause',\n}\n\nexport interface UIState {\n  activePanels: Set<PanelType>;\n  modalStack: PanelType[];\n  tooltipContent: string | null;\n  tooltipPosition: Vector2 | null;\n}\n","/**\n * EventBus - Central event system for decoupled communication between game systems\n *\n * Supports typed events with strong typing for event payloads.\n */\n\nimport type { Vector2, Vector2Int, TileLayer, Entity } from './types';\n\n// ============================================================================\n// Event Definitions\n// ============================================================================\n\nexport interface GameEvents {\n  // World Events\n  'world:tileChanged': { position: Vector2Int; layer: TileLayer; oldTypeId: string | null; newTypeId: string | null };\n  'world:regionLoaded': { regionId: string; position: Vector2Int };\n  'world:regionUnloaded': { regionId: string };\n\n  // Entity Events\n  'entity:spawned': { entity: Entity };\n  'entity:despawned': { entityId: string };\n  'entity:moved': { entityId: string; from: Vector2; to: Vector2 };\n  'entity:damaged': { entityId: string; amount: number; sourceId: string | null };\n  'entity:healed': { entityId: string; amount: number };\n  'entity:died': { entityId: string; killerId: string | null };\n\n  // Player Events\n  'player:moved': { position: Vector2 };\n  'player:interacted': { targetId: string | null; position: Vector2Int };\n  'player:inventoryChanged': { itemId: string; delta: number };\n\n  // Input Events\n  'input:actionPressed': { action: string };\n  'input:actionReleased': { action: string };\n  'input:mouseClicked': { button: number; position: Vector2; worldPosition: Vector2 };\n  'input:mouseMoved': { position: Vector2; worldPosition: Vector2 };\n  'input:gamepadConnected': { index: number; id: string };\n  'input:gamepadDisconnected': { index: number; id: string };\n  'input:leftStickMoved': { x: number; y: number };\n  'input:rightStickMoved': { x: number; y: number };\n\n  // Time Events\n  'time:hourChanged': { hour: number; day: number };\n  'time:dayChanged': { day: number };\n  'time:paused': Record<string, never>;\n  'time:resumed': Record<string, never>;\n\n  // UI Events\n  'ui:panelOpened': { panel: string };\n  'ui:panelClosed': { panel: string };\n  'ui:tooltipShow': { content: string; position: Vector2 };\n  'ui:tooltipHide': Record<string, never>;\n\n  // Save Events\n  'save:started': { slot: string };\n  'save:completed': { slot: string };\n  'save:failed': { slot: string; error: string };\n  'load:started': { slot: string };\n  'load:completed': { slot: string };\n  'load:failed': { slot: string; error: string };\n\n  // Game State Events\n  'game:started': Record<string, never>;\n  'game:paused': Record<string, never>;\n  'game:resumed': Record<string, never>;\n  'game:quit': Record<string, never>;\n}\n\n// ============================================================================\n// Event Handler Types\n// ============================================================================\n\ntype EventHandler<T> = (payload: T) => void;\ntype UnsubscribeFn = () => void;\n\ninterface EventSubscription<K extends keyof GameEvents> {\n  handler: EventHandler<GameEvents[K]>;\n  once: boolean;\n  priority: number;\n}\n\n// ============================================================================\n// EventBus Implementation\n// ============================================================================\n\nexport class EventBus {\n  private static instance: EventBus | null = null;\n  private subscribers: Map<keyof GameEvents, EventSubscription<keyof GameEvents>[]> = new Map();\n  private eventQueue: Array<{ event: keyof GameEvents; payload: GameEvents[keyof GameEvents] }> = [];\n  private isProcessing = false;\n\n  private constructor() {}\n\n  /**\n   * Get the singleton EventBus instance\n   */\n  public static getInstance(): EventBus {\n    if (!EventBus.instance) {\n      EventBus.instance = new EventBus();\n    }\n    return EventBus.instance;\n  }\n\n  /**\n   * Reset the EventBus (useful for testing)\n   */\n  public static reset(): void {\n    if (EventBus.instance) {\n      EventBus.instance.subscribers.clear();\n      EventBus.instance.eventQueue = [];\n      EventBus.instance.isProcessing = false;\n    }\n    EventBus.instance = null;\n  }\n\n  /**\n   * Subscribe to an event\n   * @param event - The event type to subscribe to\n   * @param handler - The callback function to invoke\n   * @param priority - Higher priority handlers are called first (default: 0)\n   * @returns Unsubscribe function\n   */\n  public on<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    priority = 0\n  ): UnsubscribeFn {\n    return this.subscribe(event, handler, false, priority);\n  }\n\n  /**\n   * Subscribe to an event, automatically unsubscribing after first invocation\n   * @param event - The event type to subscribe to\n   * @param handler - The callback function to invoke\n   * @param priority - Higher priority handlers are called first (default: 0)\n   * @returns Unsubscribe function\n   */\n  public once<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    priority = 0\n  ): UnsubscribeFn {\n    return this.subscribe(event, handler, true, priority);\n  }\n\n  /**\n   * Emit an event immediately\n   * @param event - The event type to emit\n   * @param payload - The event payload\n   */\n  public emit<K extends keyof GameEvents>(event: K, payload: GameEvents[K]): void {\n    const subscribers = this.subscribers.get(event);\n    if (!subscribers || subscribers.length === 0) {\n      return;\n    }\n\n    // Sort by priority (higher first) and process\n    const sortedSubscribers = [...subscribers].sort((a, b) => b.priority - a.priority);\n    const toRemove: EventSubscription<K>[] = [];\n\n    for (const subscription of sortedSubscribers) {\n      try {\n        (subscription.handler as EventHandler<GameEvents[K]>)(payload);\n        if (subscription.once) {\n          toRemove.push(subscription as EventSubscription<K>);\n        }\n      } catch (error) {\n        console.error(`Error in event handler for \"${event}\":`, error);\n      }\n    }\n\n    // Remove one-time handlers\n    for (const sub of toRemove) {\n      const index = subscribers.indexOf(sub as EventSubscription<keyof GameEvents>);\n      if (index !== -1) {\n        subscribers.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * Queue an event to be processed later (useful for deferring events)\n   * @param event - The event type to queue\n   * @param payload - The event payload\n   */\n  public queue<K extends keyof GameEvents>(event: K, payload: GameEvents[K]): void {\n    this.eventQueue.push({ event, payload: payload as GameEvents[keyof GameEvents] });\n  }\n\n  /**\n   * Process all queued events\n   */\n  public processQueue(): void {\n    if (this.isProcessing) {\n      return;\n    }\n\n    this.isProcessing = true;\n\n    while (this.eventQueue.length > 0) {\n      const queued = this.eventQueue.shift();\n      if (queued) {\n        this.emit(queued.event, queued.payload as GameEvents[typeof queued.event]);\n      }\n    }\n\n    this.isProcessing = false;\n  }\n\n  /**\n   * Remove all subscribers for a specific event\n   * @param event - The event type to clear\n   */\n  public off<K extends keyof GameEvents>(event: K): void {\n    this.subscribers.delete(event);\n  }\n\n  /**\n   * Get the number of subscribers for an event\n   * @param event - The event type to check\n   */\n  public subscriberCount<K extends keyof GameEvents>(event: K): number {\n    return this.subscribers.get(event)?.length ?? 0;\n  }\n\n  private subscribe<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    once: boolean,\n    priority: number\n  ): UnsubscribeFn {\n    if (!this.subscribers.has(event)) {\n      this.subscribers.set(event, []);\n    }\n\n    const subscription: EventSubscription<K> = { handler, once, priority };\n    this.subscribers.get(event)!.push(subscription as EventSubscription<keyof GameEvents>);\n\n    return () => {\n      const subs = this.subscribers.get(event);\n      if (subs) {\n        const index = subs.indexOf(subscription as EventSubscription<keyof GameEvents>);\n        if (index !== -1) {\n          subs.splice(index, 1);\n        }\n      }\n    };\n  }\n}\n\n// Export singleton getter for convenience\nexport const getEventBus = (): EventBus => EventBus.getInstance();\n","/**\n * GameEngine - Central orchestrator for all game systems\n *\n * Manages the game loop, system initialization, and coordinates\n * between all subsystems.\n */\n\nimport { EventBus, getEventBus } from './EventBus';\nimport type { GameConfig, GameTime } from './types';\n\n// ============================================================================\n// System Interface\n// ============================================================================\n\nexport interface GameSystem {\n  readonly name: string;\n  initialize?(): void | Promise<void>;\n  update?(deltaTime: number, gameTime: GameTime): void;\n  fixedUpdate?(fixedDeltaTime: number, gameTime: GameTime): void;\n  lateUpdate?(deltaTime: number, gameTime: GameTime): void;\n  destroy?(): void;\n}\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\nconst DEFAULT_CONFIG: GameConfig = {\n  tileSize: 32,\n  regionSize: 64,\n  loadDistance: 2,\n  unloadDistance: 3,\n  dayLengthSeconds: 600, // 10 real minutes = 1 game day\n};\n\n// ============================================================================\n// GameEngine Implementation\n// ============================================================================\n\nexport class GameEngine {\n  private static instance: GameEngine | null = null;\n\n  private config: GameConfig;\n  private systems: Map<string, GameSystem> = new Map();\n  private systemOrder: string[] = [];\n  private eventBus: EventBus;\n\n  private isRunning = false;\n  private isPaused = false;\n  private lastFrameTime = 0;\n  private accumulatedTime = 0;\n  private readonly fixedTimeStep = 1 / 60; // 60 Hz fixed update\n\n  private gameTime: GameTime = {\n    totalSeconds: 0,\n    deltaTime: 0,\n    gameHour: 6, // Start at 6 AM\n    gameDay: 1,\n    isPaused: false,\n  };\n\n  private animationFrameId: number | null = null;\n\n  private constructor(config: Partial<GameConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.eventBus = getEventBus();\n  }\n\n  /**\n   * Get the singleton GameEngine instance\n   */\n  public static getInstance(config?: Partial<GameConfig>): GameEngine {\n    if (!GameEngine.instance) {\n      GameEngine.instance = new GameEngine(config);\n    }\n    return GameEngine.instance;\n  }\n\n  /**\n   * Reset the GameEngine (useful for testing)\n   */\n  public static reset(): void {\n    if (GameEngine.instance) {\n      GameEngine.instance.stop();\n      GameEngine.instance.systems.clear();\n      GameEngine.instance.systemOrder = [];\n    }\n    GameEngine.instance = null;\n    EventBus.reset();\n  }\n\n  /**\n   * Get the game configuration\n   */\n  public getConfig(): Readonly<GameConfig> {\n    return this.config;\n  }\n\n  /**\n   * Get the current game time\n   */\n  public getGameTime(): Readonly<GameTime> {\n    return this.gameTime;\n  }\n\n  /**\n   * Register a game system\n   * @param system - The system to register\n   * @param order - Optional order index (lower = earlier in update loop)\n   */\n  public registerSystem(system: GameSystem, order?: number): void {\n    if (this.systems.has(system.name)) {\n      console.warn(`System \"${system.name}\" is already registered. Skipping.`);\n      return;\n    }\n\n    this.systems.set(system.name, system);\n\n    if (order !== undefined) {\n      // Insert at specific position\n      this.systemOrder.splice(order, 0, system.name);\n    } else {\n      // Append to end\n      this.systemOrder.push(system.name);\n    }\n  }\n\n  /**\n   * Unregister a game system\n   * @param name - The name of the system to unregister\n   */\n  public unregisterSystem(name: string): void {\n    const system = this.systems.get(name);\n    if (system) {\n      system.destroy?.();\n      this.systems.delete(name);\n      this.systemOrder = this.systemOrder.filter(n => n !== name);\n    }\n  }\n\n  /**\n   * Get a registered system by name\n   */\n  public getSystem<T extends GameSystem>(name: string): T | undefined {\n    return this.systems.get(name) as T | undefined;\n  }\n\n  /**\n   * Initialize all registered systems\n   */\n  public async initialize(): Promise<void> {\n    console.log('[GameEngine] Initializing systems...');\n\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      if (system?.initialize) {\n        console.log(`[GameEngine] Initializing ${name}...`);\n        await system.initialize();\n      }\n    }\n\n    console.log('[GameEngine] All systems initialized.');\n  }\n\n  /**\n   * Start the game loop\n   */\n  public start(): void {\n    if (this.isRunning) {\n      console.warn('[GameEngine] Game loop is already running.');\n      return;\n    }\n\n    console.log('[GameEngine] Starting game loop...');\n    this.isRunning = true;\n    this.lastFrameTime = performance.now();\n    this.eventBus.emit('game:started', {});\n    this.loop();\n  }\n\n  /**\n   * Stop the game loop\n   */\n  public stop(): void {\n    if (!this.isRunning) {\n      return;\n    }\n\n    console.log('[GameEngine] Stopping game loop...');\n    this.isRunning = false;\n\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n\n    this.eventBus.emit('game:quit', {});\n  }\n\n  /**\n   * Pause the game\n   */\n  public pause(): void {\n    if (this.isPaused) return;\n\n    this.isPaused = true;\n    this.gameTime.isPaused = true;\n    this.eventBus.emit('game:paused', {});\n    this.eventBus.emit('time:paused', {});\n  }\n\n  /**\n   * Resume the game\n   */\n  public resume(): void {\n    if (!this.isPaused) return;\n\n    this.isPaused = false;\n    this.gameTime.isPaused = false;\n    this.lastFrameTime = performance.now(); // Reset to avoid huge delta\n    this.eventBus.emit('game:resumed', {});\n    this.eventBus.emit('time:resumed', {});\n  }\n\n  /**\n   * Toggle pause state\n   */\n  public togglePause(): void {\n    if (this.isPaused) {\n      this.resume();\n    } else {\n      this.pause();\n    }\n  }\n\n  /**\n   * Check if the game is currently running\n   */\n  public isGameRunning(): boolean {\n    return this.isRunning;\n  }\n\n  /**\n   * Check if the game is currently paused\n   */\n  public isGamePaused(): boolean {\n    return this.isPaused;\n  }\n\n  /**\n   * Main game loop\n   */\n  private loop = (): void => {\n    if (!this.isRunning) return;\n\n    const currentTime = performance.now();\n    const deltaTime = Math.min((currentTime - this.lastFrameTime) / 1000, 0.1); // Cap at 100ms\n    this.lastFrameTime = currentTime;\n\n    // Update game time\n    this.gameTime.deltaTime = deltaTime;\n\n    if (!this.isPaused) {\n      this.gameTime.totalSeconds += deltaTime;\n      this.updateGameClock(deltaTime);\n\n      // Process queued events\n      this.eventBus.processQueue();\n\n      // Fixed update (physics, etc.)\n      this.accumulatedTime += deltaTime;\n      while (this.accumulatedTime >= this.fixedTimeStep) {\n        this.fixedUpdate(this.fixedTimeStep);\n        this.accumulatedTime -= this.fixedTimeStep;\n      }\n\n      // Variable update\n      this.update(deltaTime);\n\n      // Late update (camera, etc.)\n      this.lateUpdate(deltaTime);\n    }\n\n    this.animationFrameId = requestAnimationFrame(this.loop);\n  };\n\n  /**\n   * Update game clock (day/night cycle)\n   */\n  private updateGameClock(deltaTime: number): void {\n    const secondsPerGameHour = this.config.dayLengthSeconds / 24;\n    const hoursElapsed = deltaTime / secondsPerGameHour;\n\n    const previousHour = Math.floor(this.gameTime.gameHour);\n    this.gameTime.gameHour += hoursElapsed;\n\n    // Check for hour change\n    const currentHour = Math.floor(this.gameTime.gameHour);\n    if (currentHour !== previousHour && currentHour < 24) {\n      this.eventBus.emit('time:hourChanged', {\n        hour: currentHour,\n        day: this.gameTime.gameDay,\n      });\n    }\n\n    // Check for day change\n    if (this.gameTime.gameHour >= 24) {\n      this.gameTime.gameHour -= 24;\n      this.gameTime.gameDay += 1;\n      this.eventBus.emit('time:dayChanged', { day: this.gameTime.gameDay });\n      this.eventBus.emit('time:hourChanged', {\n        hour: Math.floor(this.gameTime.gameHour),\n        day: this.gameTime.gameDay,\n      });\n    }\n  }\n\n  /**\n   * Fixed timestep update (for physics, etc.)\n   */\n  private fixedUpdate(fixedDeltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.fixedUpdate?.(fixedDeltaTime, this.gameTime);\n    }\n  }\n\n  /**\n   * Variable timestep update\n   */\n  private update(deltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.update?.(deltaTime, this.gameTime);\n    }\n  }\n\n  /**\n   * Late update (after all systems have updated)\n   */\n  private lateUpdate(deltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.lateUpdate?.(deltaTime, this.gameTime);\n    }\n  }\n}\n\n// Export singleton getter for convenience\nexport const getGameEngine = (config?: Partial<GameConfig>): GameEngine =>\n  GameEngine.getInstance(config);\n","/**\n * TileRegistry - Manages tile type definitions\n *\n * Central registry for all tile types with their properties.\n */\n\nimport { TileLayer, type TileType, type ResourceDrop } from '../core/types';\n\n// ============================================================================\n// Default Tile Types\n// ============================================================================\n\nconst createTileType = (\n  id: string,\n  name: string,\n  layer: TileLayer,\n  options: Partial<Omit<TileType, 'id' | 'name' | 'layer'>> = {}\n): TileType => ({\n  id,\n  name,\n  layer,\n  walkable: options.walkable ?? true,\n  hardness: options.hardness ?? 1,\n  transparent: options.transparent ?? true,\n  drops: options.drops ?? [],\n  autotileGroup: options.autotileGroup ?? null,\n  buildRequirements: options.buildRequirements ?? [],\n});\n\n// ============================================================================\n// TileRegistry Implementation\n// ============================================================================\n\nexport class TileRegistry {\n  private static instance: TileRegistry | null = null;\n  private tiles: Map<string, TileType> = new Map();\n\n  private constructor() {\n    this.registerDefaultTiles();\n  }\n\n  /**\n   * Get the singleton TileRegistry instance\n   */\n  public static getInstance(): TileRegistry {\n    if (!TileRegistry.instance) {\n      TileRegistry.instance = new TileRegistry();\n    }\n    return TileRegistry.instance;\n  }\n\n  /**\n   * Reset the registry (useful for testing)\n   */\n  public static reset(): void {\n    TileRegistry.instance = null;\n  }\n\n  /**\n   * Register a new tile type\n   */\n  public register(tile: TileType): void {\n    if (this.tiles.has(tile.id)) {\n      console.warn(`Tile type \"${tile.id}\" is already registered. Overwriting.`);\n    }\n    this.tiles.set(tile.id, tile);\n  }\n\n  /**\n   * Get a tile type by ID\n   */\n  public get(id: string): TileType | undefined {\n    return this.tiles.get(id);\n  }\n\n  /**\n   * Check if a tile type exists\n   */\n  public has(id: string): boolean {\n    return this.tiles.has(id);\n  }\n\n  /**\n   * Get all tile types\n   */\n  public getAll(): TileType[] {\n    return Array.from(this.tiles.values());\n  }\n\n  /**\n   * Get all tile types in a specific layer\n   */\n  public getByLayer(layer: TileLayer): TileType[] {\n    return this.getAll().filter(t => t.layer === layer);\n  }\n\n  /**\n   * Get all tile types in an autotile group\n   */\n  public getByAutotileGroup(group: string): TileType[] {\n    return this.getAll().filter(t => t.autotileGroup === group);\n  }\n\n  /**\n   * Register default tile types for the game\n   * Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard:\n   * - Layer 0 (Background): Decorative, no collision\n   * - Layer 1 (Ground): Terrain, floors\n   * - Layer 2 (Objects): Furniture, resources, items\n   * - Layer 3 (Walls): Structures, barriers\n   * - Layer 4 (Foreground): Visual overlays, roofs\n   */\n  private registerDefaultTiles(): void {\n    // Background Layer (Layer 0) - Decorative, no collision\n    // Used for visual decorations under terrain\n\n    // Ground Layer (Layer 1) - Terrain, Floors\n    this.register(createTileType('grass', 'Grass', TileLayer.Ground, {\n      autotileGroup: 'grass',\n      drops: [{ resourceId: 'fiber', minAmount: 0, maxAmount: 1, chance: 0.1 }],\n    }));\n\n    this.register(createTileType('dirt', 'Dirt', TileLayer.Ground, {\n      autotileGroup: 'dirt',\n      hardness: 0.8,\n    }));\n\n    this.register(createTileType('sand', 'Sand', TileLayer.Ground, {\n      autotileGroup: 'sand',\n      hardness: 0.5,\n    }));\n\n    this.register(createTileType('water', 'Water', TileLayer.Ground, {\n      walkable: false,\n      autotileGroup: 'water',\n      hardness: -1, // Unbreakable\n    }));\n\n    this.register(createTileType('deep_water', 'Deep Water', TileLayer.Ground, {\n      walkable: false,\n      autotileGroup: 'water',\n      hardness: -1,\n    }));\n\n    this.register(createTileType('stone_floor', 'Stone Floor', TileLayer.Ground, {\n      autotileGroup: 'stone',\n      hardness: 2,\n      drops: [{ resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.5 }],\n    }));\n\n    this.register(createTileType('wooden_floor', 'Wooden Floor', TileLayer.Ground, {\n      autotileGroup: 'wood_floor',\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 2 }],\n      drops: [{ resourceId: 'wood', minAmount: 1, maxAmount: 2, chance: 0.8 }],\n    }));\n\n    this.register(createTileType('stone_path', 'Stone Path', TileLayer.Ground, {\n      autotileGroup: 'stone_path',\n      hardness: 1.5,\n      buildRequirements: [{ resourceId: 'stone', amount: 2 }],\n      drops: [{ resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.8 }],\n    }));\n\n    // Objects Layer (Layer 2) - Furniture, Resources, Items\n    this.register(createTileType('tree', 'Tree', TileLayer.Objects, {\n      walkable: false,\n      hardness: 3,\n      drops: [\n        { resourceId: 'wood', minAmount: 3, maxAmount: 6, chance: 1 },\n        { resourceId: 'stick', minAmount: 1, maxAmount: 3, chance: 0.5 },\n      ],\n    }));\n\n    this.register(createTileType('rock', 'Rock', TileLayer.Objects, {\n      walkable: false,\n      hardness: 4,\n      drops: [\n        { resourceId: 'stone', minAmount: 2, maxAmount: 5, chance: 1 },\n        { resourceId: 'flint', minAmount: 0, maxAmount: 1, chance: 0.2 },\n      ],\n    }));\n\n    this.register(createTileType('iron_ore', 'Iron Ore', TileLayer.Objects, {\n      walkable: false,\n      hardness: 5,\n      drops: [\n        { resourceId: 'iron_ore', minAmount: 1, maxAmount: 3, chance: 1 },\n        { resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.5 },\n      ],\n    }));\n\n    this.register(createTileType('bush', 'Bush', TileLayer.Objects, {\n      walkable: true,\n      hardness: 0.5,\n      drops: [\n        { resourceId: 'fiber', minAmount: 1, maxAmount: 2, chance: 0.8 },\n        { resourceId: 'berries', minAmount: 0, maxAmount: 2, chance: 0.3 },\n      ],\n    }));\n\n    this.register(createTileType('chest', 'Chest', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 15 }],\n    }));\n\n    this.register(createTileType('workbench', 'Workbench', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1.5,\n      buildRequirements: [{ resourceId: 'wood', amount: 20 }],\n    }));\n\n    this.register(createTileType('campfire', 'Campfire', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [\n        { resourceId: 'wood', amount: 5 },\n        { resourceId: 'stone', amount: 3 },\n      ],\n    }));\n\n    this.register(createTileType('bed', 'Bed', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [\n        { resourceId: 'wood', amount: 10 },\n        { resourceId: 'fiber', amount: 5 },\n      ],\n    }));\n\n    // Walls Layer (Layer 3) - Structures, Barriers\n    this.register(createTileType('wooden_wall', 'Wooden Wall', TileLayer.Walls, {\n      walkable: false,\n      transparent: false,\n      autotileGroup: 'wood_wall',\n      hardness: 2,\n      buildRequirements: [{ resourceId: 'wood', amount: 5 }],\n      drops: [{ resourceId: 'wood', minAmount: 2, maxAmount: 4, chance: 0.9 }],\n    }));\n\n    this.register(createTileType('stone_wall', 'Stone Wall', TileLayer.Walls, {\n      walkable: false,\n      transparent: false,\n      autotileGroup: 'stone_wall',\n      hardness: 4,\n      buildRequirements: [{ resourceId: 'stone', amount: 8 }],\n      drops: [{ resourceId: 'stone', minAmount: 3, maxAmount: 6, chance: 0.9 }],\n    }));\n\n    // Foreground Layer (Layer 4) - Visual overlays, roofs\n    this.register(createTileType('roof_wood', 'Wooden Roof', TileLayer.Foreground, {\n      walkable: true, // Player walks under it\n      transparent: false,\n      autotileGroup: 'roof_wood',\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 3 }],\n    }));\n  }\n}\n\n// Export singleton getter for convenience\nexport const getTileRegistry = (): TileRegistry => TileRegistry.getInstance();\n","/**\n * TilemapManager - Manages the 2D tile-based world\n *\n * Handles tile placement, removal, and querying across multiple layers.\n * Integrates with the EventBus for tile change notifications.\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard:\n * - Layer 0 (Background): Decorative, no collision\n * - Layer 1 (Ground): Terrain, floors\n * - Layer 2 (Objects): Furniture, resources, items\n * - Layer 3 (Walls): Structures, barriers\n * - Layer 4 (Foreground): Visual overlays, roofs\n */\n\nconst MAX_LAYER = 4; // 5 layers total (0-4)\n\nimport type { GameSystem } from '../core/GameEngine';\nimport { getEventBus } from '../core/EventBus';\nimport { TileLayer, type Tile, type TileType, type Vector2Int, type Bounds, type GameTime } from '../core/types';\nimport { getTileRegistry, type TileRegistry } from './TileRegistry';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface TileChange {\n  position: Vector2Int;\n  layer: TileLayer;\n  oldTypeId: string | null;\n  newTypeId: string | null;\n  timestamp: number;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nconst positionKey = (x: number, y: number, layer: TileLayer): string =>\n  `${x},${y},${layer}`;\n\nconst parsePositionKey = (key: string): { x: number; y: number; layer: TileLayer } => {\n  const [x, y, layer] = key.split(',').map(Number);\n  return { x, y, layer: layer as TileLayer };\n};\n\n// ============================================================================\n// TilemapManager Implementation\n// ============================================================================\n\nexport class TilemapManager implements GameSystem {\n  public readonly name = 'TilemapManager';\n\n  private tiles: Map<string, Tile> = new Map();\n  private tileRegistry: TileRegistry;\n  private pendingChanges: TileChange[] = [];\n  private changeHistory: TileChange[] = [];\n  private maxHistorySize = 1000;\n\n  constructor() {\n    this.tileRegistry = getTileRegistry();\n  }\n\n  /**\n   * Initialize the tilemap manager\n   */\n  public initialize(): void {\n    console.log('[TilemapManager] Initialized');\n  }\n\n  /**\n   * Update - processes pending changes\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    // Process any pending tile changes\n    this.processPendingChanges();\n  }\n\n  /**\n   * Set a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @param typeId - Tile type ID\n   * @param variant - Autotile variant (default: 0)\n   * @returns true if tile was set successfully\n   */\n  public setTile(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    typeId: string,\n    variant = 0\n  ): boolean {\n    const tileType = this.tileRegistry.get(typeId);\n    if (!tileType) {\n      console.warn(`[TilemapManager] Unknown tile type: ${typeId}`);\n      return false;\n    }\n\n    const key = positionKey(x, y, layer);\n    const existingTile = this.tiles.get(key);\n    const oldTypeId = existingTile?.typeId ?? null;\n\n    // Create new tile\n    const tile: Tile = {\n      typeId,\n      layer,\n      position: { x, y },\n      variant,\n    };\n\n    this.tiles.set(key, tile);\n\n    // Queue change event\n    this.pendingChanges.push({\n      position: { x, y },\n      layer,\n      oldTypeId,\n      newTypeId: typeId,\n      timestamp: Date.now(),\n    });\n\n    return true;\n  }\n\n  /**\n   * Remove a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The removed tile, or null if no tile existed\n   */\n  public removeTile(x: number, y: number, layer: TileLayer): Tile | null {\n    const key = positionKey(x, y, layer);\n    const tile = this.tiles.get(key);\n\n    if (!tile) {\n      return null;\n    }\n\n    this.tiles.delete(key);\n\n    // Queue change event\n    this.pendingChanges.push({\n      position: { x, y },\n      layer,\n      oldTypeId: tile.typeId,\n      newTypeId: null,\n      timestamp: Date.now(),\n    });\n\n    return tile;\n  }\n\n  /**\n   * Get a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The tile, or undefined if no tile exists\n   */\n  public getTile(x: number, y: number, layer: TileLayer): Tile | undefined {\n    return this.tiles.get(positionKey(x, y, layer));\n  }\n\n  /**\n   * Get the tile type at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The tile type, or undefined if no tile exists\n   */\n  public getTileType(x: number, y: number, layer: TileLayer): TileType | undefined {\n    const tile = this.getTile(x, y, layer);\n    return tile ? this.tileRegistry.get(tile.typeId) : undefined;\n  }\n\n  /**\n   * Check if a position has a tile in any layer\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if any tile exists at this position\n   */\n  public hasTile(x: number, y: number): boolean {\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      if (this.tiles.has(positionKey(x, y, layer as TileLayer))) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if a position is walkable\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if the position can be walked on\n   */\n  public isWalkable(x: number, y: number): boolean {\n    // Check all layers for blocking tiles\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) {\n        const tileType = this.tileRegistry.get(tile.typeId);\n        if (tileType && !tileType.walkable) {\n          return false;\n        }\n      }\n    }\n\n    // Must have at least a Ground layer tile to be walkable\n    // Per 5-layer standard: Layer 1 (Ground) contains terrain/floors\n    const ground = this.getTile(x, y, TileLayer.Ground);\n    if (!ground) {\n      return false; // No ground = not walkable\n    }\n\n    const groundType = this.tileRegistry.get(ground.typeId);\n    return groundType?.walkable ?? false;\n  }\n\n  /**\n   * Check if a position is transparent (for light/vision)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if light can pass through\n   */\n  public isTransparent(x: number, y: number): boolean {\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) {\n        const tileType = this.tileRegistry.get(tile.typeId);\n        if (tileType && !tileType.transparent) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Get all tiles in a rectangular region\n   * @param bounds - The region bounds\n   * @param layer - Optional specific layer (all layers if not specified)\n   * @returns Array of tiles in the region\n   */\n  public getTilesInRegion(bounds: Bounds, layer?: TileLayer): Tile[] {\n    const tiles: Tile[] = [];\n\n    for (let x = bounds.x; x < bounds.x + bounds.width; x++) {\n      for (let y = bounds.y; y < bounds.y + bounds.height; y++) {\n        if (layer !== undefined) {\n          const tile = this.getTile(x, y, layer);\n          if (tile) tiles.push(tile);\n        } else {\n          for (let l = 0; l <= MAX_LAYER; l++) {\n            const tile = this.getTile(x, y, l as TileLayer);\n            if (tile) tiles.push(tile);\n          }\n        }\n      }\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get all tiles at a position (all layers)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns Array of tiles at this position\n   */\n  public getTilesAt(x: number, y: number): Tile[] {\n    const tiles: Tile[] = [];\n\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) tiles.push(tile);\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get neighboring tiles (4-connected)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns Object with north, south, east, west tiles\n   */\n  public getNeighbors4(\n    x: number,\n    y: number,\n    layer: TileLayer\n  ): { north?: Tile; south?: Tile; east?: Tile; west?: Tile } {\n    return {\n      north: this.getTile(x, y - 1, layer),\n      south: this.getTile(x, y + 1, layer),\n      east: this.getTile(x + 1, y, layer),\n      west: this.getTile(x - 1, y, layer),\n    };\n  }\n\n  /**\n   * Get neighboring tiles (8-connected)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns Object with all 8 neighboring tiles\n   */\n  public getNeighbors8(\n    x: number,\n    y: number,\n    layer: TileLayer\n  ): {\n    north?: Tile;\n    south?: Tile;\n    east?: Tile;\n    west?: Tile;\n    northEast?: Tile;\n    northWest?: Tile;\n    southEast?: Tile;\n    southWest?: Tile;\n  } {\n    return {\n      north: this.getTile(x, y - 1, layer),\n      south: this.getTile(x, y + 1, layer),\n      east: this.getTile(x + 1, y, layer),\n      west: this.getTile(x - 1, y, layer),\n      northEast: this.getTile(x + 1, y - 1, layer),\n      northWest: this.getTile(x - 1, y - 1, layer),\n      southEast: this.getTile(x + 1, y + 1, layer),\n      southWest: this.getTile(x - 1, y + 1, layer),\n    };\n  }\n\n  /**\n   * Clear all tiles\n   */\n  public clear(): void {\n    this.tiles.clear();\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Get total tile count\n   */\n  public getTileCount(): number {\n    return this.tiles.size;\n  }\n\n  /**\n   * Get tile count by layer\n   */\n  public getTileCountByLayer(layer: TileLayer): number {\n    let count = 0;\n    for (const key of this.tiles.keys()) {\n      if (key.endsWith(`,${layer}`)) {\n        count++;\n      }\n    }\n    return count;\n  }\n\n  /**\n   * Get change history\n   */\n  public getChangeHistory(): readonly TileChange[] {\n    return this.changeHistory;\n  }\n\n  /**\n   * Serialize tilemap state for saving\n   */\n  public serialize(): Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant: number }> {\n    const data: Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant: number }> = [];\n\n    for (const tile of this.tiles.values()) {\n      data.push({\n        position: tile.position,\n        layer: tile.layer,\n        typeId: tile.typeId,\n        variant: tile.variant,\n      });\n    }\n\n    return data;\n  }\n\n  /**\n   * Deserialize tilemap state from save data\n   */\n  public deserialize(\n    data: Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant?: number }>\n  ): void {\n    this.clear();\n\n    for (const tileData of data) {\n      this.setTile(\n        tileData.position.x,\n        tileData.position.y,\n        tileData.layer,\n        tileData.typeId,\n        tileData.variant ?? 0\n      );\n    }\n\n    // Clear pending changes from deserialization\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Process pending tile changes and emit events\n   */\n  private processPendingChanges(): void {\n    const eventBus = getEventBus();\n\n    for (const change of this.pendingChanges) {\n      eventBus.emit('world:tileChanged', {\n        position: change.position,\n        layer: change.layer,\n        oldTypeId: change.oldTypeId,\n        newTypeId: change.newTypeId,\n      });\n\n      // Add to history\n      this.changeHistory.push(change);\n\n      // Trim history if needed\n      if (this.changeHistory.length > this.maxHistorySize) {\n        this.changeHistory.shift();\n      }\n    }\n\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.clear();\n    console.log('[TilemapManager] Destroyed');\n  }\n}\n","/**\n * AutotileSystem - Calculates tile variants based on neighbors\n *\n * Supports 4-bit (16 variants) and 8-bit (47 variants) autotiling patterns.\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * - 4-bit (16 variants): Simple walls\n * - 8-bit (47 variants): Terrain transitions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus, type GameEvents } from '@core/EventBus';\nimport type { TileLayer, Vector2Int, GameTime } from '@core/types';\nimport { TilemapManager } from './TilemapManager';\nimport { getTileRegistry } from './TileRegistry';\n\n// ============================================================================\n// Autotile Patterns\n// ============================================================================\n\n/**\n * 4-bit autotile bitmask positions:\n *   1\n * 8 X 2\n *   4\n */\nexport enum Neighbor4 {\n  North = 1,\n  East = 2,\n  South = 4,\n  West = 8,\n}\n\n/**\n * 8-bit autotile bitmask positions:\n * 1   2   4\n * 8   X   16\n * 32  64  128\n */\nexport enum Neighbor8 {\n  NorthWest = 1,\n  North = 2,\n  NorthEast = 4,\n  West = 8,\n  East = 16,\n  SouthWest = 32,\n  South = 64,\n  SouthEast = 128,\n}\n\n// ============================================================================\n// 4-bit to Variant Mapping (16 variants)\n// ============================================================================\n\n/**\n * Maps 4-bit neighbor bitmask to tile variant index.\n * Used for simple wall tiles.\n */\nconst VARIANT_MAP_4BIT: Record<number, number> = {\n  0b0000: 0,  // No neighbors\n  0b0001: 1,  // North only\n  0b0010: 2,  // East only\n  0b0011: 3,  // North + East\n  0b0100: 4,  // South only\n  0b0101: 5,  // North + South\n  0b0110: 6,  // East + South\n  0b0111: 7,  // North + East + South\n  0b1000: 8,  // West only\n  0b1001: 9,  // North + West\n  0b1010: 10, // East + West\n  0b1011: 11, // North + East + West\n  0b1100: 12, // South + West\n  0b1101: 13, // North + South + West\n  0b1110: 14, // East + South + West\n  0b1111: 15, // All neighbors\n};\n\n// ============================================================================\n// 8-bit to Variant Mapping (47 variants)\n// ============================================================================\n\n/**\n * Complete lookup table for 8-bit autotiling (47 unique variants).\n * Maps the masked bitmask (after removing irrelevant corners) to tile variant index.\n *\n * Variant indices are organized as follows:\n * 0-15:  Base 4-directional patterns (no relevant corners)\n * 16-46: Patterns with corner variations\n *\n * The tile atlas should be arranged in this order for correct rendering.\n */\nconst VARIANT_MAP_8BIT: Map<number, number> = new Map([\n  // ============ No edges (isolated) ============\n  [0, 0],\n\n  // ============ Single edge (4 end caps) ============\n  [Neighbor8.North, 1],\n  [Neighbor8.East, 2],\n  [Neighbor8.South, 3],\n  [Neighbor8.West, 4],\n\n  // ============ Two opposite edges (2 straight pieces) ============\n  [Neighbor8.North | Neighbor8.South, 5],\n  [Neighbor8.East | Neighbor8.West, 6],\n\n  // ============ Two adjacent edges - outer corners (4 patterns × 2 corner states = 8) ============\n  // NE corner area\n  [Neighbor8.North | Neighbor8.East, 7],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.NorthEast, 8],\n  // SE corner area\n  [Neighbor8.East | Neighbor8.South, 9],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.SouthEast, 10],\n  // SW corner area\n  [Neighbor8.South | Neighbor8.West, 11],\n  [Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 12],\n  // NW corner area\n  [Neighbor8.North | Neighbor8.West, 13],\n  [Neighbor8.North | Neighbor8.West | Neighbor8.NorthWest, 14],\n\n  // ============ Three edges - T junctions (4 patterns × 4 corner states = 16) ============\n  // Missing West (has N, E, S - corners NE and SE matter)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South, 15],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.NorthEast, 16],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.SouthEast, 17],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.NorthEast | Neighbor8.SouthEast, 18],\n\n  // Missing North (has E, S, W - corners SE and SW matter)\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West, 19],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast, 20],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 21],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest, 22],\n\n  // Missing East (has N, S, W - corners NW and SW matter)\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West, 23],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest, 24],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 25],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.SouthWest, 26],\n\n  // Missing South (has N, E, W - corners NW and NE matter)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West, 27],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthEast, 28],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthWest, 29],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.NorthWest, 30],\n\n  // ============ Four edges - center pieces (16 corner combinations) ============\n  // All 4 edges present, varying corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West, 31],\n  // 1 corner\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast, 32],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast, 33],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 34],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest, 35],\n  // 2 adjacent corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthEast, 36],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest, 37],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest | Neighbor8.NorthWest, 38],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.NorthEast, 39],\n  // 2 opposite corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthWest, 40],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.SouthEast, 41],\n  // 3 corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthEast | Neighbor8.SouthWest, 42],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest | Neighbor8.NorthWest, 43],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest | Neighbor8.NorthWest | Neighbor8.NorthEast, 44],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.NorthEast | Neighbor8.SouthEast, 45],\n  // 4 corners (fully surrounded)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West |\n   Neighbor8.NorthEast | Neighbor8.SouthEast | Neighbor8.SouthWest | Neighbor8.NorthWest, 46],\n]);\n\n/**\n * Mask out corners that don't have both adjacent edges present.\n * This is required because corners are only visually relevant when\n * both adjacent cardinal neighbors are also present.\n */\nfunction maskIrrelevantCorners(bitmask: number): number {\n  let masked = bitmask;\n\n  // NorthWest corner: needs both North and West edges\n  if ((bitmask & Neighbor8.NorthWest) && !((bitmask & Neighbor8.North) && (bitmask & Neighbor8.West))) {\n    masked &= ~Neighbor8.NorthWest;\n  }\n\n  // NorthEast corner: needs both North and East edges\n  if ((bitmask & Neighbor8.NorthEast) && !((bitmask & Neighbor8.North) && (bitmask & Neighbor8.East))) {\n    masked &= ~Neighbor8.NorthEast;\n  }\n\n  // SouthWest corner: needs both South and West edges\n  if ((bitmask & Neighbor8.SouthWest) && !((bitmask & Neighbor8.South) && (bitmask & Neighbor8.West))) {\n    masked &= ~Neighbor8.SouthWest;\n  }\n\n  // SouthEast corner: needs both South and East edges\n  if ((bitmask & Neighbor8.SouthEast) && !((bitmask & Neighbor8.South) && (bitmask & Neighbor8.East))) {\n    masked &= ~Neighbor8.SouthEast;\n  }\n\n  return masked;\n}\n\n/**\n * Calculate the 8-bit autotile variant index from a neighbor bitmask.\n * Returns a variant index 0-46 for use with the tile atlas.\n */\nfunction calculate8BitVariant(bitmask: number): number {\n  const maskedBitmask = maskIrrelevantCorners(bitmask);\n  return VARIANT_MAP_8BIT.get(maskedBitmask) ?? 0;\n}\n\n// ============================================================================\n// AutotileSystem Implementation\n// ============================================================================\n\nexport class AutotileSystem implements GameSystem {\n  public readonly name = 'AutotileSystem';\n\n  private tilemapManager: TilemapManager | null = null;\n  private pendingUpdates: Set<string> = new Set();\n  private unsubscribe: (() => void) | null = null;\n\n  /**\n   * Initialize with a reference to the TilemapManager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for tile changes\n    this.unsubscribe = eventBus.on('world:tileChanged', (event) => {\n      this.onTileChanged(event);\n    });\n\n    console.log('[AutotileSystem] Initialized');\n  }\n\n  /**\n   * Set the tilemap manager reference\n   */\n  public setTilemapManager(manager: TilemapManager): void {\n    this.tilemapManager = manager;\n  }\n\n  /**\n   * Update - processes pending autotile updates\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    if (this.pendingUpdates.size === 0 || !this.tilemapManager) {\n      return;\n    }\n\n    // Process all pending updates\n    for (const key of this.pendingUpdates) {\n      const [x, y, layer] = key.split(',').map(Number);\n      this.updateTileVariant(x, y, layer as TileLayer);\n    }\n\n    this.pendingUpdates.clear();\n  }\n\n  /**\n   * Handle tile change events\n   */\n  private onTileChanged(event: GameEvents['world:tileChanged']): void {\n    const { position, layer } = event;\n\n    // Queue update for the changed tile\n    this.queueUpdate(position.x, position.y, layer);\n\n    // Queue updates for all neighbors (they may need to update their variants)\n    this.queueUpdate(position.x, position.y - 1, layer); // North\n    this.queueUpdate(position.x + 1, position.y, layer); // East\n    this.queueUpdate(position.x, position.y + 1, layer); // South\n    this.queueUpdate(position.x - 1, position.y, layer); // West\n    this.queueUpdate(position.x + 1, position.y - 1, layer); // NorthEast\n    this.queueUpdate(position.x - 1, position.y - 1, layer); // NorthWest\n    this.queueUpdate(position.x + 1, position.y + 1, layer); // SouthEast\n    this.queueUpdate(position.x - 1, position.y + 1, layer); // SouthWest\n  }\n\n  /**\n   * Queue a tile position for autotile update\n   */\n  private queueUpdate(x: number, y: number, layer: TileLayer): void {\n    this.pendingUpdates.add(`${x},${y},${layer}`);\n  }\n\n  /**\n   * Update the variant for a single tile\n   */\n  private updateTileVariant(x: number, y: number, layer: TileLayer): void {\n    if (!this.tilemapManager) return;\n\n    const tile = this.tilemapManager.getTile(x, y, layer);\n    if (!tile) return;\n\n    const tileRegistry = getTileRegistry();\n    const tileType = tileRegistry.get(tile.typeId);\n    if (!tileType || !tileType.autotileGroup) return;\n\n    // Calculate neighbor bitmask\n    const variant = this.calculateVariant(x, y, layer, tileType.autotileGroup);\n\n    // Update tile variant if it changed\n    if (tile.variant !== variant) {\n      // Directly update the tile's variant (avoiding event loop)\n      tile.variant = variant;\n    }\n  }\n\n  /**\n   * Calculate the autotile variant for a position\n   */\n  public calculateVariant(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    autotileGroup: string\n  ): number {\n    if (!this.tilemapManager) return 0;\n\n    const tileRegistry = getTileRegistry();\n\n    // Check if neighbor matches the autotile group\n    const matchesGroup = (nx: number, ny: number): boolean => {\n      const neighbor = this.tilemapManager!.getTile(nx, ny, layer);\n      if (!neighbor) return false;\n      const neighborType = tileRegistry.get(neighbor.typeId);\n      return neighborType?.autotileGroup === autotileGroup;\n    };\n\n    // Calculate 4-bit bitmask (for simple autotiling)\n    let bitmask4 = 0;\n    if (matchesGroup(x, y - 1)) bitmask4 |= Neighbor4.North;\n    if (matchesGroup(x + 1, y)) bitmask4 |= Neighbor4.East;\n    if (matchesGroup(x, y + 1)) bitmask4 |= Neighbor4.South;\n    if (matchesGroup(x - 1, y)) bitmask4 |= Neighbor4.West;\n\n    // For now, use 4-bit autotiling (can be extended to 8-bit for terrain)\n    return VARIANT_MAP_4BIT[bitmask4] ?? 0;\n  }\n\n  /**\n   * Calculate 8-bit variant for terrain transitions\n   */\n  public calculateVariant8Bit(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    autotileGroup: string\n  ): number {\n    if (!this.tilemapManager) return 0;\n\n    const tileRegistry = getTileRegistry();\n\n    // Check if neighbor matches the autotile group\n    const matchesGroup = (nx: number, ny: number): boolean => {\n      const neighbor = this.tilemapManager!.getTile(nx, ny, layer);\n      if (!neighbor) return false;\n      const neighborType = tileRegistry.get(neighbor.typeId);\n      return neighborType?.autotileGroup === autotileGroup;\n    };\n\n    // Calculate 8-bit bitmask\n    let bitmask8 = 0;\n    if (matchesGroup(x - 1, y - 1)) bitmask8 |= Neighbor8.NorthWest;\n    if (matchesGroup(x, y - 1)) bitmask8 |= Neighbor8.North;\n    if (matchesGroup(x + 1, y - 1)) bitmask8 |= Neighbor8.NorthEast;\n    if (matchesGroup(x - 1, y)) bitmask8 |= Neighbor8.West;\n    if (matchesGroup(x + 1, y)) bitmask8 |= Neighbor8.East;\n    if (matchesGroup(x - 1, y + 1)) bitmask8 |= Neighbor8.SouthWest;\n    if (matchesGroup(x, y + 1)) bitmask8 |= Neighbor8.South;\n    if (matchesGroup(x + 1, y + 1)) bitmask8 |= Neighbor8.SouthEast;\n\n    return calculate8BitVariant(bitmask8);\n  }\n\n  /**\n   * Force update all tiles in a region\n   */\n  public updateRegion(x: number, y: number, width: number, height: number, layer: TileLayer): void {\n    for (let tx = x; tx < x + width; tx++) {\n      for (let ty = y; ty < y + height; ty++) {\n        this.queueUpdate(tx, ty, layer);\n      }\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n      this.unsubscribe = null;\n    }\n    this.pendingUpdates.clear();\n    console.log('[AutotileSystem] Destroyed');\n  }\n}\n","/**\n * RegionManager - Manages world streaming by regions\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * - Region size: 64x64 tiles\n * - Load distance: 2 regions in each direction\n * - Unload distance: 3 regions in each direction\n * - Pause tasks in unloaded regions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { Vector2, Vector2Int, GameTime, Tile, TileLayer } from '@core/types';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nexport interface RegionConfig {\n  regionSize: number;      // Tiles per region side\n  loadDistance: number;    // Regions to load around player\n  unloadDistance: number;  // Regions to unload beyond this\n}\n\nconst DEFAULT_CONFIG: RegionConfig = {\n  regionSize: 64,\n  loadDistance: 2,\n  unloadDistance: 3,\n};\n\n// ============================================================================\n// Region Data Structure\n// ============================================================================\n\nexport interface RegionData {\n  id: string;\n  position: Vector2Int;      // Region coordinates (not tile coordinates)\n  tiles: Map<string, Tile>;  // Tiles within this region\n  isLoaded: boolean;\n  lastAccessTime: number;\n}\n\n// ============================================================================\n// RegionManager Implementation\n// ============================================================================\n\nexport class RegionManager implements GameSystem {\n  public readonly name = 'RegionManager';\n\n  private config: RegionConfig;\n  private regions: Map<string, RegionData> = new Map();\n  private loadedRegions: Set<string> = new Set();\n  private playerPosition: Vector2 = { x: 0, y: 0 };\n  private lastPlayerRegion: Vector2Int = { x: 0, y: 0 };\n\n  constructor(config: Partial<RegionConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the region manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for player movement to update regions\n    eventBus.on('player:moved', (event) => {\n      this.playerPosition = event.position;\n    });\n\n    console.log('[RegionManager] Initialized with config:', this.config);\n  }\n\n  /**\n   * Update - check if regions need to be loaded/unloaded\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    const currentRegion = this.worldToRegion(this.playerPosition.x, this.playerPosition.y);\n\n    // Only update regions if player moved to a new region\n    if (currentRegion.x !== this.lastPlayerRegion.x || currentRegion.y !== this.lastPlayerRegion.y) {\n      this.updateLoadedRegions(currentRegion);\n      this.lastPlayerRegion = currentRegion;\n    }\n  }\n\n  /**\n   * Convert world coordinates to region coordinates\n   */\n  public worldToRegion(worldX: number, worldY: number): Vector2Int {\n    return {\n      x: Math.floor(worldX / this.config.regionSize),\n      y: Math.floor(worldY / this.config.regionSize),\n    };\n  }\n\n  /**\n   * Convert region coordinates to world coordinates (top-left corner)\n   */\n  public regionToWorld(regionX: number, regionY: number): Vector2Int {\n    return {\n      x: regionX * this.config.regionSize,\n      y: regionY * this.config.regionSize,\n    };\n  }\n\n  /**\n   * Get region ID from region coordinates\n   */\n  public getRegionId(regionX: number, regionY: number): string {\n    return `${regionX},${regionY}`;\n  }\n\n  /**\n   * Parse region ID to coordinates\n   */\n  public parseRegionId(id: string): Vector2Int {\n    const [x, y] = id.split(',').map(Number);\n    return { x, y };\n  }\n\n  /**\n   * Check if a region is currently loaded\n   */\n  public isRegionLoaded(regionX: number, regionY: number): boolean {\n    return this.loadedRegions.has(this.getRegionId(regionX, regionY));\n  }\n\n  /**\n   * Get a region by coordinates\n   */\n  public getRegion(regionX: number, regionY: number): RegionData | undefined {\n    return this.regions.get(this.getRegionId(regionX, regionY));\n  }\n\n  /**\n   * Get or create a region\n   */\n  public getOrCreateRegion(regionX: number, regionY: number): RegionData {\n    const id = this.getRegionId(regionX, regionY);\n    let region = this.regions.get(id);\n\n    if (!region) {\n      region = {\n        id,\n        position: { x: regionX, y: regionY },\n        tiles: new Map(),\n        isLoaded: false,\n        lastAccessTime: Date.now(),\n      };\n      this.regions.set(id, region);\n    }\n\n    return region;\n  }\n\n  /**\n   * Load a region\n   */\n  public loadRegion(regionX: number, regionY: number): RegionData {\n    const region = this.getOrCreateRegion(regionX, regionY);\n\n    if (!region.isLoaded) {\n      region.isLoaded = true;\n      region.lastAccessTime = Date.now();\n      this.loadedRegions.add(region.id);\n\n      const eventBus = getEventBus();\n      eventBus.emit('world:regionLoaded', {\n        regionId: region.id,\n        position: region.position,\n      });\n\n      console.log(`[RegionManager] Loaded region ${region.id}`);\n    }\n\n    return region;\n  }\n\n  /**\n   * Unload a region\n   */\n  public unloadRegion(regionX: number, regionY: number): void {\n    const id = this.getRegionId(regionX, regionY);\n    const region = this.regions.get(id);\n\n    if (region && region.isLoaded) {\n      region.isLoaded = false;\n      this.loadedRegions.delete(id);\n\n      const eventBus = getEventBus();\n      eventBus.emit('world:regionUnloaded', { regionId: id });\n\n      console.log(`[RegionManager] Unloaded region ${id}`);\n    }\n  }\n\n  /**\n   * Update which regions are loaded based on player position\n   */\n  private updateLoadedRegions(playerRegion: Vector2Int): void {\n    const { loadDistance, unloadDistance } = this.config;\n\n    // Determine which regions should be loaded\n    const shouldBeLoaded = new Set<string>();\n    for (let dx = -loadDistance; dx <= loadDistance; dx++) {\n      for (let dy = -loadDistance; dy <= loadDistance; dy++) {\n        const regionX = playerRegion.x + dx;\n        const regionY = playerRegion.y + dy;\n        shouldBeLoaded.add(this.getRegionId(regionX, regionY));\n      }\n    }\n\n    // Load new regions\n    for (const id of shouldBeLoaded) {\n      if (!this.loadedRegions.has(id)) {\n        const { x, y } = this.parseRegionId(id);\n        this.loadRegion(x, y);\n      }\n    }\n\n    // Unload distant regions\n    for (const id of this.loadedRegions) {\n      const { x, y } = this.parseRegionId(id);\n      const dx = Math.abs(x - playerRegion.x);\n      const dy = Math.abs(y - playerRegion.y);\n\n      if (dx > unloadDistance || dy > unloadDistance) {\n        this.unloadRegion(x, y);\n      }\n    }\n  }\n\n  /**\n   * Get all currently loaded regions\n   */\n  public getLoadedRegions(): RegionData[] {\n    const regions: RegionData[] = [];\n    for (const id of this.loadedRegions) {\n      const region = this.regions.get(id);\n      if (region) {\n        regions.push(region);\n      }\n    }\n    return regions;\n  }\n\n  /**\n   * Get the number of loaded regions\n   */\n  public getLoadedRegionCount(): number {\n    return this.loadedRegions.size;\n  }\n\n  /**\n   * Set tile data in a region\n   */\n  public setRegionTile(\n    worldX: number,\n    worldY: number,\n    layer: TileLayer,\n    tile: Tile\n  ): void {\n    const regionCoords = this.worldToRegion(worldX, worldY);\n    const region = this.getOrCreateRegion(regionCoords.x, regionCoords.y);\n\n    // Calculate local position within region\n    const localX = worldX - regionCoords.x * this.config.regionSize;\n    const localY = worldY - regionCoords.y * this.config.regionSize;\n    const key = `${localX},${localY},${layer}`;\n\n    region.tiles.set(key, tile);\n    region.lastAccessTime = Date.now();\n  }\n\n  /**\n   * Get tile data from a region\n   */\n  public getRegionTile(\n    worldX: number,\n    worldY: number,\n    layer: TileLayer\n  ): Tile | undefined {\n    const regionCoords = this.worldToRegion(worldX, worldY);\n    const region = this.regions.get(this.getRegionId(regionCoords.x, regionCoords.y));\n\n    if (!region) return undefined;\n\n    const localX = worldX - regionCoords.x * this.config.regionSize;\n    const localY = worldY - regionCoords.y * this.config.regionSize;\n    const key = `${localX},${localY},${layer}`;\n\n    region.lastAccessTime = Date.now();\n    return region.tiles.get(key);\n  }\n\n  /**\n   * Serialize a region for saving\n   */\n  public serializeRegion(regionX: number, regionY: number): {\n    id: string;\n    position: Vector2Int;\n    tiles: Array<{ key: string; tile: Tile }>;\n  } | null {\n    const region = this.getRegion(regionX, regionY);\n    if (!region) return null;\n\n    const tiles: Array<{ key: string; tile: Tile }> = [];\n    for (const [key, tile] of region.tiles) {\n      tiles.push({ key, tile });\n    }\n\n    return {\n      id: region.id,\n      position: region.position,\n      tiles,\n    };\n  }\n\n  /**\n   * Deserialize a region from save data\n   */\n  public deserializeRegion(data: {\n    id: string;\n    position: Vector2Int;\n    tiles: Array<{ key: string; tile: Tile }>;\n  }): void {\n    const region = this.getOrCreateRegion(data.position.x, data.position.y);\n\n    region.tiles.clear();\n    for (const { key, tile } of data.tiles) {\n      region.tiles.set(key, tile);\n    }\n  }\n\n  /**\n   * Clear all regions\n   */\n  public clear(): void {\n    this.regions.clear();\n    this.loadedRegions.clear();\n    this.lastPlayerRegion = { x: 0, y: 0 };\n  }\n\n  /**\n   * Get region size\n   */\n  public getRegionSize(): number {\n    return this.config.regionSize;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.clear();\n    console.log('[RegionManager] Destroyed');\n  }\n}\n","/**\n * NoiseGenerator - Procedural noise functions for world generation\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 World Generation:\n * - Perlin noise for height maps (4 octaves, scale 0.01)\n * - Simplex noise for moisture (3 octaves, scale 0.015)\n */\n\n// ============================================================================\n// Noise Configuration\n// ============================================================================\n\nexport interface NoiseConfig {\n  seed: number;\n  octaves: number;\n  scale: number;\n  persistence: number;  // Amplitude reduction per octave (0-1)\n  lacunarity: number;   // Frequency multiplier per octave\n}\n\nconst DEFAULT_PERLIN_CONFIG: NoiseConfig = {\n  seed: 12345,\n  octaves: 4,\n  scale: 0.01,\n  persistence: 0.5,\n  lacunarity: 2.0,\n};\n\nconst DEFAULT_SIMPLEX_CONFIG: NoiseConfig = {\n  seed: 54321,\n  octaves: 3,\n  scale: 0.015,\n  persistence: 0.5,\n  lacunarity: 2.0,\n};\n\n// ============================================================================\n// Permutation Table (for reproducible noise)\n// ============================================================================\n\nfunction createPermutationTable(seed: number): Uint8Array {\n  const perm = new Uint8Array(512);\n  const p = new Uint8Array(256);\n\n  // Initialize with values 0-255\n  for (let i = 0; i < 256; i++) {\n    p[i] = i;\n  }\n\n  // Shuffle using seed\n  let n = seed;\n  for (let i = 255; i > 0; i--) {\n    n = (n * 1103515245 + 12345) & 0x7fffffff;\n    const j = n % (i + 1);\n    [p[i], p[j]] = [p[j], p[i]];\n  }\n\n  // Duplicate for wrapping\n  for (let i = 0; i < 256; i++) {\n    perm[i] = p[i];\n    perm[i + 256] = p[i];\n  }\n\n  return perm;\n}\n\n// ============================================================================\n// Gradient Vectors\n// ============================================================================\n\nconst GRAD3 = [\n  [1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0],\n  [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1],\n  [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1],\n];\n\n// ============================================================================\n// NoiseGenerator Implementation\n// ============================================================================\n\nexport class NoiseGenerator {\n  private perm: Uint8Array;\n  private seed: number;\n\n  constructor(seed: number = Date.now()) {\n    this.seed = seed;\n    this.perm = createPermutationTable(seed);\n  }\n\n  /**\n   * Get the seed used for this generator\n   */\n  public getSeed(): number {\n    return this.seed;\n  }\n\n  /**\n   * Reseed the generator\n   */\n  public reseed(seed: number): void {\n    this.seed = seed;\n    this.perm = createPermutationTable(seed);\n  }\n\n  // ==========================================================================\n  // Perlin Noise\n  // ==========================================================================\n\n  /**\n   * 2D Perlin noise at a single point\n   * Returns value in range [-1, 1]\n   */\n  public perlin2D(x: number, y: number): number {\n    // Find unit grid cell\n    const X = Math.floor(x) & 255;\n    const Y = Math.floor(y) & 255;\n\n    // Relative position in cell\n    const xf = x - Math.floor(x);\n    const yf = y - Math.floor(y);\n\n    // Fade curves\n    const u = this.fade(xf);\n    const v = this.fade(yf);\n\n    // Hash coordinates of the 4 corners\n    const aa = this.perm[this.perm[X] + Y];\n    const ab = this.perm[this.perm[X] + Y + 1];\n    const ba = this.perm[this.perm[X + 1] + Y];\n    const bb = this.perm[this.perm[X + 1] + Y + 1];\n\n    // Gradient values at corners\n    const gradAA = this.grad2D(aa, xf, yf);\n    const gradBA = this.grad2D(ba, xf - 1, yf);\n    const gradAB = this.grad2D(ab, xf, yf - 1);\n    const gradBB = this.grad2D(bb, xf - 1, yf - 1);\n\n    // Interpolate\n    const x1 = this.lerp(gradAA, gradBA, u);\n    const x2 = this.lerp(gradAB, gradBB, u);\n\n    return this.lerp(x1, x2, v);\n  }\n\n  /**\n   * Fractal Brownian Motion using Perlin noise\n   * Returns value in range [0, 1]\n   */\n  public perlinFBM(\n    x: number,\n    y: number,\n    config: Partial<NoiseConfig> = {}\n  ): number {\n    const { octaves, scale, persistence, lacunarity } = {\n      ...DEFAULT_PERLIN_CONFIG,\n      ...config,\n    };\n\n    let total = 0;\n    let amplitude = 1;\n    let frequency = scale;\n    let maxValue = 0;\n\n    for (let i = 0; i < octaves; i++) {\n      total += this.perlin2D(x * frequency, y * frequency) * amplitude;\n      maxValue += amplitude;\n      amplitude *= persistence;\n      frequency *= lacunarity;\n    }\n\n    // Normalize to [0, 1]\n    return (total / maxValue + 1) / 2;\n  }\n\n  // ==========================================================================\n  // Simplex Noise\n  // ==========================================================================\n\n  /**\n   * 2D Simplex noise at a single point\n   * Returns value in range [-1, 1]\n   */\n  public simplex2D(x: number, y: number): number {\n    const F2 = 0.5 * (Math.sqrt(3) - 1);\n    const G2 = (3 - Math.sqrt(3)) / 6;\n\n    // Skew input space\n    const s = (x + y) * F2;\n    const i = Math.floor(x + s);\n    const j = Math.floor(y + s);\n\n    // Unskew cell origin\n    const t = (i + j) * G2;\n    const X0 = i - t;\n    const Y0 = j - t;\n    const x0 = x - X0;\n    const y0 = y - Y0;\n\n    // Determine which simplex we're in\n    let i1: number, j1: number;\n    if (x0 > y0) {\n      i1 = 1;\n      j1 = 0;\n    } else {\n      i1 = 0;\n      j1 = 1;\n    }\n\n    // Offsets for corners\n    const x1 = x0 - i1 + G2;\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2;\n    const y2 = y0 - 1 + 2 * G2;\n\n    // Hash indices\n    const ii = i & 255;\n    const jj = j & 255;\n    const gi0 = this.perm[ii + this.perm[jj]] % 12;\n    const gi1 = this.perm[ii + i1 + this.perm[jj + j1]] % 12;\n    const gi2 = this.perm[ii + 1 + this.perm[jj + 1]] % 12;\n\n    // Calculate contributions\n    let n0 = 0, n1 = 0, n2 = 0;\n\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 >= 0) {\n      t0 *= t0;\n      n0 = t0 * t0 * this.dot2D(GRAD3[gi0], x0, y0);\n    }\n\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 >= 0) {\n      t1 *= t1;\n      n1 = t1 * t1 * this.dot2D(GRAD3[gi1], x1, y1);\n    }\n\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 >= 0) {\n      t2 *= t2;\n      n2 = t2 * t2 * this.dot2D(GRAD3[gi2], x2, y2);\n    }\n\n    // Scale to [-1, 1]\n    return 70 * (n0 + n1 + n2);\n  }\n\n  /**\n   * Fractal Brownian Motion using Simplex noise\n   * Returns value in range [0, 1]\n   */\n  public simplexFBM(\n    x: number,\n    y: number,\n    config: Partial<NoiseConfig> = {}\n  ): number {\n    const { octaves, scale, persistence, lacunarity } = {\n      ...DEFAULT_SIMPLEX_CONFIG,\n      ...config,\n    };\n\n    let total = 0;\n    let amplitude = 1;\n    let frequency = scale;\n    let maxValue = 0;\n\n    for (let i = 0; i < octaves; i++) {\n      total += this.simplex2D(x * frequency, y * frequency) * amplitude;\n      maxValue += amplitude;\n      amplitude *= persistence;\n      frequency *= lacunarity;\n    }\n\n    // Normalize to [0, 1]\n    return (total / maxValue + 1) / 2;\n  }\n\n  // ==========================================================================\n  // Voronoi Noise (for biome regions)\n  // ==========================================================================\n\n  /**\n   * 2D Voronoi noise (cellular noise)\n   * Returns the distance to nearest cell point, normalized to [0, 1]\n   */\n  public voronoi2D(x: number, y: number, scale: number = 0.005): number {\n    const sx = x * scale;\n    const sy = y * scale;\n\n    const cellX = Math.floor(sx);\n    const cellY = Math.floor(sy);\n\n    let minDist = 10;\n\n    // Check neighboring cells\n    for (let dx = -1; dx <= 1; dx++) {\n      for (let dy = -1; dy <= 1; dy++) {\n        const neighborX = cellX + dx;\n        const neighborY = cellY + dy;\n\n        // Get reproducible random point in this cell\n        const hash = this.perm[(neighborX & 255) + this.perm[neighborY & 255]];\n        const px = neighborX + (hash / 256);\n        const py = neighborY + ((hash * 7) % 256) / 256;\n\n        // Calculate distance\n        const distX = sx - px;\n        const distY = sy - py;\n        const dist = Math.sqrt(distX * distX + distY * distY);\n\n        if (dist < minDist) {\n          minDist = dist;\n        }\n      }\n    }\n\n    // Normalize to [0, 1]\n    return Math.min(minDist / 1.5, 1);\n  }\n\n  /**\n   * Get the cell ID for Voronoi (useful for biome assignment)\n   * Returns a stable ID for the cell containing this point\n   */\n  public voronoiCellId(x: number, y: number, scale: number = 0.005): number {\n    const sx = x * scale;\n    const sy = y * scale;\n\n    const cellX = Math.floor(sx);\n    const cellY = Math.floor(sy);\n\n    let minDist = 10;\n    let closestHash = 0;\n\n    // Check neighboring cells\n    for (let dx = -1; dx <= 1; dx++) {\n      for (let dy = -1; dy <= 1; dy++) {\n        const neighborX = cellX + dx;\n        const neighborY = cellY + dy;\n\n        const hash = this.perm[(neighborX & 255) + this.perm[neighborY & 255]];\n        const px = neighborX + (hash / 256);\n        const py = neighborY + ((hash * 7) % 256) / 256;\n\n        const distX = sx - px;\n        const distY = sy - py;\n        const dist = Math.sqrt(distX * distX + distY * distY);\n\n        if (dist < minDist) {\n          minDist = dist;\n          closestHash = (neighborX * 73856093) ^ (neighborY * 19349663);\n        }\n      }\n    }\n\n    return Math.abs(closestHash);\n  }\n\n  // ==========================================================================\n  // Helper Functions\n  // ==========================================================================\n\n  private fade(t: number): number {\n    return t * t * t * (t * (t * 6 - 15) + 10);\n  }\n\n  private lerp(a: number, b: number, t: number): number {\n    return a + t * (b - a);\n  }\n\n  private grad2D(hash: number, x: number, y: number): number {\n    const h = hash & 3;\n    const u = h < 2 ? x : y;\n    const v = h < 2 ? y : x;\n    return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);\n  }\n\n  private dot2D(g: number[], x: number, y: number): number {\n    return g[0] * x + g[1] * y;\n  }\n}\n\n// ============================================================================\n// Default Noise Configurations (per spec)\n// ============================================================================\n\nexport const NOISE_CONFIGS = {\n  height: {\n    octaves: 4,\n    scale: 0.01,\n    persistence: 0.5,\n    lacunarity: 2.0,\n  },\n  moisture: {\n    octaves: 3,\n    scale: 0.015,\n    persistence: 0.5,\n    lacunarity: 2.0,\n  },\n  temperature: {\n    octaves: 2,\n    scale: 0.008,\n    persistence: 0.6,\n    lacunarity: 2.0,\n  },\n};\n","/**\n * BiomeManager - Manages biome definitions and determination\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * Biomes are determined by height and moisture values.\n * Required: 5+ distinct biomes in average world.\n */\n\nimport { TileLayer } from '@core/types';\n\n// ============================================================================\n// Biome Types\n// ============================================================================\n\nexport enum BiomeType {\n  Ocean = 'ocean',\n  Beach = 'beach',\n  Desert = 'desert',\n  Plains = 'plains',\n  Forest = 'forest',\n  Swamp = 'swamp',\n  Mountains = 'mountains',\n  Snow = 'snow',\n  Tundra = 'tundra',\n  Jungle = 'jungle',\n}\n\nexport interface BiomeDefinition {\n  id: BiomeType;\n  name: string;\n  color: string;               // Debug/minimap color\n  groundTile: string;          // Default ground tile type\n  decorationTiles: string[];   // Possible decorations (trees, rocks, etc.)\n  decorationDensity: number;   // 0-1 chance per tile\n  resourceTiles: string[];     // Possible resources (ores, plants)\n  resourceDensity: number;     // 0-1 chance per tile\n  walkable: boolean;           // Can player walk here?\n  buildable: boolean;          // Can player build here?\n  hostileSpawnRate: number;    // Monsters per 100 tiles\n}\n\n// ============================================================================\n// Biome Definitions\n// ============================================================================\n\nconst BIOME_DEFINITIONS: Map<BiomeType, BiomeDefinition> = new Map([\n  [BiomeType.Ocean, {\n    id: BiomeType.Ocean,\n    name: 'Ocean',\n    color: '#1a5276',\n    groundTile: 'water_deep',\n    decorationTiles: ['seaweed', 'coral'],\n    decorationDensity: 0.05,\n    resourceTiles: ['fish_spot'],\n    resourceDensity: 0.02,\n    walkable: false,\n    buildable: false,\n    hostileSpawnRate: 0.5,\n  }],\n  [BiomeType.Beach, {\n    id: BiomeType.Beach,\n    name: 'Beach',\n    color: '#f9e79f',\n    groundTile: 'sand',\n    decorationTiles: ['palm_tree', 'shell', 'driftwood'],\n    decorationDensity: 0.08,\n    resourceTiles: ['coconut', 'crab'],\n    resourceDensity: 0.03,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.2,\n  }],\n  [BiomeType.Desert, {\n    id: BiomeType.Desert,\n    name: 'Desert',\n    color: '#f5b041',\n    groundTile: 'sand',\n    decorationTiles: ['cactus', 'dead_bush', 'skull'],\n    decorationDensity: 0.04,\n    resourceTiles: ['iron_ore', 'gold_ore'],\n    resourceDensity: 0.02,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.8,\n  }],\n  [BiomeType.Plains, {\n    id: BiomeType.Plains,\n    name: 'Plains',\n    color: '#82e0aa',\n    groundTile: 'grass',\n    decorationTiles: ['tall_grass', 'flower_red', 'flower_yellow', 'small_rock'],\n    decorationDensity: 0.15,\n    resourceTiles: ['berry_bush', 'fiber_plant'],\n    resourceDensity: 0.05,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.3,\n  }],\n  [BiomeType.Forest, {\n    id: BiomeType.Forest,\n    name: 'Forest',\n    color: '#1e8449',\n    groundTile: 'grass',\n    decorationTiles: ['tree_oak', 'tree_birch', 'bush', 'mushroom', 'fallen_log'],\n    decorationDensity: 0.35,\n    resourceTiles: ['wood_log', 'berry_bush', 'mushroom_edible', 'herb'],\n    resourceDensity: 0.08,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.5,\n  }],\n  [BiomeType.Swamp, {\n    id: BiomeType.Swamp,\n    name: 'Swamp',\n    color: '#6c7a32',\n    groundTile: 'mud',\n    decorationTiles: ['dead_tree', 'cattail', 'lily_pad', 'moss_rock'],\n    decorationDensity: 0.25,\n    resourceTiles: ['slime_mold', 'swamp_herb', 'clay'],\n    resourceDensity: 0.06,\n    walkable: true,\n    buildable: false,\n    hostileSpawnRate: 1.0,\n  }],\n  [BiomeType.Mountains, {\n    id: BiomeType.Mountains,\n    name: 'Mountains',\n    color: '#7f8c8d',\n    groundTile: 'stone',\n    decorationTiles: ['boulder', 'pine_tree', 'mountain_flower'],\n    decorationDensity: 0.12,\n    resourceTiles: ['iron_ore', 'copper_ore', 'coal', 'crystal'],\n    resourceDensity: 0.1,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.6,\n  }],\n  [BiomeType.Snow, {\n    id: BiomeType.Snow,\n    name: 'Snow',\n    color: '#ecf0f1',\n    groundTile: 'snow',\n    decorationTiles: ['pine_tree_snowy', 'ice_crystal', 'snowman'],\n    decorationDensity: 0.1,\n    resourceTiles: ['ice', 'frozen_herb'],\n    resourceDensity: 0.03,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.4,\n  }],\n  [BiomeType.Tundra, {\n    id: BiomeType.Tundra,\n    name: 'Tundra',\n    color: '#bdc3c7',\n    groundTile: 'frozen_grass',\n    decorationTiles: ['dead_bush', 'small_rock', 'lichen'],\n    decorationDensity: 0.08,\n    resourceTiles: ['fiber_plant', 'flint'],\n    resourceDensity: 0.04,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.3,\n  }],\n  [BiomeType.Jungle, {\n    id: BiomeType.Jungle,\n    name: 'Jungle',\n    color: '#145a32',\n    groundTile: 'jungle_grass',\n    decorationTiles: ['jungle_tree', 'giant_fern', 'vine', 'exotic_flower'],\n    decorationDensity: 0.45,\n    resourceTiles: ['tropical_fruit', 'rare_herb', 'bamboo'],\n    resourceDensity: 0.1,\n    walkable: true,\n    buildable: false,\n    hostileSpawnRate: 1.2,\n  }],\n]);\n\n// ============================================================================\n// Biome Determination Thresholds\n// ============================================================================\n\ninterface BiomeThresholds {\n  heightOcean: number;\n  heightBeach: number;\n  heightMountain: number;\n  heightSnow: number;\n  moistureDry: number;\n  moistureMedium: number;\n  moistureWet: number;\n  temperatureCold: number;\n  temperatureHot: number;\n}\n\nconst DEFAULT_THRESHOLDS: BiomeThresholds = {\n  heightOcean: 0.3,\n  heightBeach: 0.35,\n  heightMountain: 0.75,\n  heightSnow: 0.85,\n  moistureDry: 0.25,\n  moistureMedium: 0.5,\n  moistureWet: 0.75,\n  temperatureCold: 0.3,\n  temperatureHot: 0.7,\n};\n\n// ============================================================================\n// BiomeManager Implementation\n// ============================================================================\n\nexport class BiomeManager {\n  private thresholds: BiomeThresholds;\n\n  constructor(thresholds: Partial<BiomeThresholds> = {}) {\n    this.thresholds = { ...DEFAULT_THRESHOLDS, ...thresholds };\n  }\n\n  /**\n   * Determine biome based on height, moisture, and temperature\n   * @param height - Height value [0, 1] - 0 is lowest, 1 is highest\n   * @param moisture - Moisture value [0, 1] - 0 is driest, 1 is wettest\n   * @param temperature - Temperature value [0, 1] - 0 is coldest, 1 is hottest\n   */\n  public determineBiome(\n    height: number,\n    moisture: number,\n    temperature: number = 0.5\n  ): BiomeType {\n    const t = this.thresholds;\n\n    // Ocean (deep water)\n    if (height < t.heightOcean) {\n      return BiomeType.Ocean;\n    }\n\n    // Beach (transition zone)\n    if (height < t.heightBeach) {\n      return BiomeType.Beach;\n    }\n\n    // Snow peaks\n    if (height > t.heightSnow) {\n      return BiomeType.Snow;\n    }\n\n    // Mountains\n    if (height > t.heightMountain) {\n      return temperature < t.temperatureCold ? BiomeType.Snow : BiomeType.Mountains;\n    }\n\n    // Cold biomes\n    if (temperature < t.temperatureCold) {\n      return moisture < t.moistureMedium ? BiomeType.Tundra : BiomeType.Snow;\n    }\n\n    // Hot biomes\n    if (temperature > t.temperatureHot) {\n      if (moisture < t.moistureDry) return BiomeType.Desert;\n      if (moisture > t.moistureWet) return BiomeType.Jungle;\n      return BiomeType.Plains;\n    }\n\n    // Temperate biomes (based on moisture)\n    if (moisture < t.moistureDry) {\n      return BiomeType.Desert;\n    }\n    if (moisture < t.moistureMedium) {\n      return BiomeType.Plains;\n    }\n    if (moisture < t.moistureWet) {\n      return BiomeType.Forest;\n    }\n    return BiomeType.Swamp;\n  }\n\n  /**\n   * Get biome definition by type\n   */\n  public getBiomeDefinition(biome: BiomeType): BiomeDefinition {\n    return BIOME_DEFINITIONS.get(biome)!;\n  }\n\n  /**\n   * Get all biome definitions\n   */\n  public getAllBiomes(): BiomeDefinition[] {\n    return Array.from(BIOME_DEFINITIONS.values());\n  }\n\n  /**\n   * Check if a biome is walkable\n   */\n  public isWalkable(biome: BiomeType): boolean {\n    return this.getBiomeDefinition(biome).walkable;\n  }\n\n  /**\n   * Check if a biome is buildable\n   */\n  public isBuildable(biome: BiomeType): boolean {\n    return this.getBiomeDefinition(biome).buildable;\n  }\n\n  /**\n   * Get ground tile for a biome\n   */\n  public getGroundTile(biome: BiomeType): string {\n    return this.getBiomeDefinition(biome).groundTile;\n  }\n\n  /**\n   * Get random decoration for a biome (or null based on density)\n   */\n  public getRandomDecoration(biome: BiomeType, random: number): string | null {\n    const def = this.getBiomeDefinition(biome);\n    if (random > def.decorationDensity || def.decorationTiles.length === 0) {\n      return null;\n    }\n    const index = Math.floor(random * def.decorationTiles.length / def.decorationDensity);\n    return def.decorationTiles[index % def.decorationTiles.length];\n  }\n\n  /**\n   * Get random resource for a biome (or null based on density)\n   */\n  public getRandomResource(biome: BiomeType, random: number): string | null {\n    const def = this.getBiomeDefinition(biome);\n    if (random > def.resourceDensity || def.resourceTiles.length === 0) {\n      return null;\n    }\n    const index = Math.floor(random * def.resourceTiles.length / def.resourceDensity);\n    return def.resourceTiles[index % def.resourceTiles.length];\n  }\n\n  /**\n   * Get spawn rate for hostile creatures in a biome\n   */\n  public getHostileSpawnRate(biome: BiomeType): number {\n    return this.getBiomeDefinition(biome).hostileSpawnRate;\n  }\n}\n\n// Export singleton instance\nlet biomeManagerInstance: BiomeManager | null = null;\n\nexport function getBiomeManager(): BiomeManager {\n  if (!biomeManagerInstance) {\n    biomeManagerInstance = new BiomeManager();\n  }\n  return biomeManagerInstance;\n}\n","/**\n * WorldGenerator - Procedural world generation\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * - Noise-based terrain generation\n * - Biome determination from height/moisture\n * - Target: < 10 seconds for starting region\n * - 5+ distinct biomes in average world\n */\n\nimport { NoiseGenerator, NOISE_CONFIGS } from './NoiseGenerator';\nimport { BiomeManager, BiomeType, getBiomeManager } from './BiomeManager';\nimport { TileLayer } from '@core/types';\n\n// ============================================================================\n// World Generation Config\n// ============================================================================\n\nexport interface WorldGenConfig {\n  seed: number;\n  regionSize: number;              // Tiles per region (should match RegionManager)\n  seaLevel: number;                // Height below which is water\n  temperatureLatitudeScale: number; // How temperature varies with Y\n  spawnAreaSize: number;           // Safe starting area radius\n}\n\nconst DEFAULT_CONFIG: WorldGenConfig = {\n  seed: Date.now(),\n  regionSize: 64,\n  seaLevel: 0.35,\n  temperatureLatitudeScale: 0.001,\n  spawnAreaSize: 32,\n};\n\n// ============================================================================\n// Generated Tile Data\n// ============================================================================\n\nexport interface GeneratedTile {\n  x: number;\n  y: number;\n  layer: TileLayer;\n  tileId: string;\n  biome: BiomeType;\n}\n\nexport interface GeneratedRegion {\n  regionX: number;\n  regionY: number;\n  tiles: GeneratedTile[];\n  biomeDistribution: Map<BiomeType, number>;\n  generationTimeMs: number;\n}\n\n// ============================================================================\n// WorldGenerator Implementation\n// ============================================================================\n\nexport class WorldGenerator {\n  private config: WorldGenConfig;\n  private noise: NoiseGenerator;\n  private biomeManager: BiomeManager;\n\n  constructor(config: Partial<WorldGenConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.noise = new NoiseGenerator(this.config.seed);\n    this.biomeManager = getBiomeManager();\n  }\n\n  /**\n   * Get the world seed\n   */\n  public getSeed(): number {\n    return this.config.seed;\n  }\n\n  /**\n   * Generate a region at the specified region coordinates\n   */\n  public generateRegion(regionX: number, regionY: number): GeneratedRegion {\n    const startTime = performance.now();\n    const tiles: GeneratedTile[] = [];\n    const biomeDistribution = new Map<BiomeType, number>();\n    const { regionSize } = this.config;\n\n    // Calculate world coordinates for this region\n    const worldStartX = regionX * regionSize;\n    const worldStartY = regionY * regionSize;\n\n    // Generate each tile in the region\n    for (let localX = 0; localX < regionSize; localX++) {\n      for (let localY = 0; localY < regionSize; localY++) {\n        const worldX = worldStartX + localX;\n        const worldY = worldStartY + localY;\n\n        const generatedTiles = this.generateTile(worldX, worldY);\n        tiles.push(...generatedTiles);\n\n        // Track biome distribution\n        if (generatedTiles.length > 0) {\n          const biome = generatedTiles[0].biome;\n          biomeDistribution.set(biome, (biomeDistribution.get(biome) ?? 0) + 1);\n        }\n      }\n    }\n\n    const generationTimeMs = performance.now() - startTime;\n\n    return {\n      regionX,\n      regionY,\n      tiles,\n      biomeDistribution,\n      generationTimeMs,\n    };\n  }\n\n  /**\n   * Generate tiles at a specific world coordinate\n   * Returns tiles for all relevant layers\n   */\n  public generateTile(worldX: number, worldY: number): GeneratedTile[] {\n    const tiles: GeneratedTile[] = [];\n\n    // Generate noise values\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const moisture = this.noise.simplexFBM(worldX, worldY, NOISE_CONFIGS.moisture);\n    const temperature = this.getTemperature(worldX, worldY);\n\n    // Determine biome\n    const biome = this.biomeManager.determineBiome(height, moisture, temperature);\n    const biomeDef = this.biomeManager.getBiomeDefinition(biome);\n\n    // Ground layer (always present)\n    tiles.push({\n      x: worldX,\n      y: worldY,\n      layer: TileLayer.Ground,\n      tileId: biomeDef.groundTile,\n      biome,\n    });\n\n    // Generate decoration/object layer based on biome\n    const decorationRandom = this.noise.perlin2D(worldX * 0.5 + 1000, worldY * 0.5) * 0.5 + 0.5;\n    const decoration = this.biomeManager.getRandomDecoration(biome, decorationRandom);\n    if (decoration) {\n      tiles.push({\n        x: worldX,\n        y: worldY,\n        layer: TileLayer.Objects,\n        tileId: decoration,\n        biome,\n      });\n    }\n\n    // Generate resources (separate noise channel)\n    const resourceRandom = this.noise.simplex2D(worldX * 0.3 + 2000, worldY * 0.3) * 0.5 + 0.5;\n    const resource = this.biomeManager.getRandomResource(biome, resourceRandom);\n    if (resource && !decoration) {\n      // Only place resource if no decoration\n      tiles.push({\n        x: worldX,\n        y: worldY,\n        layer: TileLayer.Objects,\n        tileId: resource,\n        biome,\n      });\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get temperature at a world position\n   * Temperature varies with Y coordinate to simulate latitude\n   */\n  private getTemperature(worldX: number, worldY: number): number {\n    const { temperatureLatitudeScale } = this.config;\n\n    // Base temperature from noise\n    const baseTemp = this.noise.simplexFBM(\n      worldX + 5000,\n      worldY + 5000,\n      NOISE_CONFIGS.temperature\n    );\n\n    // Latitude effect (colder at higher Y values, simulating going north)\n    const latitudeEffect = 1 - Math.abs(worldY * temperatureLatitudeScale);\n\n    // Altitude effect (colder at higher elevations)\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const altitudeEffect = 1 - Math.max(0, (height - 0.5) * 0.5);\n\n    return Math.max(0, Math.min(1, baseTemp * 0.5 + latitudeEffect * 0.3 + altitudeEffect * 0.2));\n  }\n\n  /**\n   * Get spawn point (safe starting location)\n   */\n  public findSpawnPoint(): { x: number; y: number } {\n    const { spawnAreaSize } = this.config;\n\n    // Search for a suitable spawn point near origin\n    for (let radius = 0; radius < 100; radius += 5) {\n      for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 8) {\n        const x = Math.round(Math.cos(angle) * radius);\n        const y = Math.round(Math.sin(angle) * radius);\n\n        if (this.isSuitableSpawn(x, y)) {\n          return { x, y };\n        }\n      }\n    }\n\n    // Fallback to origin\n    return { x: 0, y: 0 };\n  }\n\n  /**\n   * Check if a location is suitable for spawning\n   */\n  private isSuitableSpawn(x: number, y: number): boolean {\n    const tiles = this.generateTile(x, y);\n    if (tiles.length === 0) return false;\n\n    const biome = tiles[0].biome;\n\n    // Must be walkable and buildable\n    if (!this.biomeManager.isWalkable(biome)) return false;\n    if (!this.biomeManager.isBuildable(biome)) return false;\n\n    // Prefer low hostile spawn rate\n    if (this.biomeManager.getHostileSpawnRate(biome) > 0.5) return false;\n\n    // Prefer plains or forest (good starting biomes)\n    return biome === BiomeType.Plains || biome === BiomeType.Forest;\n  }\n\n  /**\n   * Get the biome at a world position\n   */\n  public getBiomeAt(worldX: number, worldY: number): BiomeType {\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const moisture = this.noise.simplexFBM(worldX, worldY, NOISE_CONFIGS.moisture);\n    const temperature = this.getTemperature(worldX, worldY);\n\n    return this.biomeManager.determineBiome(height, moisture, temperature);\n  }\n\n  /**\n   * Get height at a world position (for pathfinding, etc.)\n   */\n  public getHeightAt(worldX: number, worldY: number): number {\n    return this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n  }\n\n  /**\n   * Check if position is above water\n   */\n  public isLand(worldX: number, worldY: number): boolean {\n    return this.getHeightAt(worldX, worldY) >= this.config.seaLevel;\n  }\n\n  /**\n   * Validate world generation (for testing)\n   * Generates a sample area and checks biome diversity\n   */\n  public validateGeneration(sampleSize: number = 1000): {\n    valid: boolean;\n    biomeCount: number;\n    biomeCounts: Map<BiomeType, number>;\n    averageGenerationTime: number;\n  } {\n    const biomeCounts = new Map<BiomeType, number>();\n    let totalTime = 0;\n    const samples = Math.sqrt(sampleSize);\n\n    for (let i = 0; i < samples; i++) {\n      for (let j = 0; j < samples; j++) {\n        const x = (i - samples / 2) * 10;\n        const y = (j - samples / 2) * 10;\n\n        const start = performance.now();\n        const biome = this.getBiomeAt(x, y);\n        totalTime += performance.now() - start;\n\n        biomeCounts.set(biome, (biomeCounts.get(biome) ?? 0) + 1);\n      }\n    }\n\n    const biomeCount = biomeCounts.size;\n    const valid = biomeCount >= 5; // Spec requires 5+ distinct biomes\n\n    return {\n      valid,\n      biomeCount,\n      biomeCounts,\n      averageGenerationTime: totalTime / sampleSize,\n    };\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet worldGeneratorInstance: WorldGenerator | null = null;\n\nexport function getWorldGenerator(seed?: number): WorldGenerator {\n  if (!worldGeneratorInstance || seed !== undefined) {\n    worldGeneratorInstance = new WorldGenerator(seed !== undefined ? { seed } : {});\n  }\n  return worldGeneratorInstance;\n}\n\nexport function resetWorldGenerator(): void {\n  worldGeneratorInstance = null;\n}\n","/**\n * PlayerController - Handles player movement and state\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Player Controller:\n * States: Idle, Walking, Running, Interacting, InMenu, Combat\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport { Direction } from '@core/types';\nimport type { Vector2, GameTime, InputAction } from '@core/types';\n\n// ============================================================================\n// Player State\n// ============================================================================\n\nexport enum PlayerState {\n  Idle = 'idle',\n  Walking = 'walking',\n  Running = 'running',\n  Interacting = 'interacting',\n  InMenu = 'inMenu',\n  Combat = 'combat',\n}\n\n// ============================================================================\n// Player Configuration\n// ============================================================================\n\nexport interface PlayerConfig {\n  walkSpeed: number;\n  runSpeed: number;\n  acceleration: number;\n  deceleration: number;\n}\n\nconst DEFAULT_CONFIG: PlayerConfig = {\n  walkSpeed: 4,      // Tiles per second\n  runSpeed: 7,       // Tiles per second when sprinting\n  acceleration: 20,  // How fast to reach max speed\n  deceleration: 15,  // How fast to stop\n};\n\n// ============================================================================\n// PlayerController Implementation\n// ============================================================================\n\nexport class PlayerController implements GameSystem {\n  public readonly name = 'PlayerController';\n\n  private config: PlayerConfig;\n  private position: Vector2 = { x: 0, y: 0 };\n  private velocity: Vector2 = { x: 0, y: 0 };\n  private facing: Direction = Direction.South;\n  private state: PlayerState = PlayerState.Idle;\n\n  // Input state\n  private moveInput: Vector2 = { x: 0, y: 0 };\n  private digitalMoveInput: Vector2 = { x: 0, y: 0 }; // D-pad/keyboard\n  private analogMoveInput: Vector2 = { x: 0, y: 0 };  // Left stick\n  private isSprinting = false;\n\n  // Collision callback (set by game to check tile walkability)\n  private checkWalkable: ((x: number, y: number) => boolean) | null = null;\n\n  constructor(config: Partial<PlayerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the player controller\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Subscribe to input events\n    eventBus.on('input:actionPressed', this.onActionPressed.bind(this));\n    eventBus.on('input:actionReleased', this.onActionReleased.bind(this));\n\n    // Subscribe to gamepad analog stick for smooth movement\n    eventBus.on('input:leftStickMoved', this.onLeftStickMoved.bind(this));\n\n    console.log('[PlayerController] Initialized');\n  }\n\n  /**\n   * Set the walkability check function\n   */\n  public setWalkableCheck(fn: (x: number, y: number) => boolean): void {\n    this.checkWalkable = fn;\n  }\n\n  /**\n   * Handle action pressed events (digital input: keyboard/D-pad)\n   */\n  private onActionPressed(event: { action: string }): void {\n    switch (event.action) {\n      case 'moveUp':\n        this.digitalMoveInput.y = -1;\n        break;\n      case 'moveDown':\n        this.digitalMoveInput.y = 1;\n        break;\n      case 'moveLeft':\n        this.digitalMoveInput.x = -1;\n        break;\n      case 'moveRight':\n        this.digitalMoveInput.x = 1;\n        break;\n      case 'sprint':\n        this.isSprinting = true;\n        break;\n      case 'interact':\n        this.interact();\n        break;\n    }\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Handle action released events (digital input: keyboard/D-pad)\n   */\n  private onActionReleased(event: { action: string }): void {\n    switch (event.action) {\n      case 'moveUp':\n        if (this.digitalMoveInput.y < 0) this.digitalMoveInput.y = 0;\n        break;\n      case 'moveDown':\n        if (this.digitalMoveInput.y > 0) this.digitalMoveInput.y = 0;\n        break;\n      case 'moveLeft':\n        if (this.digitalMoveInput.x < 0) this.digitalMoveInput.x = 0;\n        break;\n      case 'moveRight':\n        if (this.digitalMoveInput.x > 0) this.digitalMoveInput.x = 0;\n        break;\n      case 'sprint':\n        this.isSprinting = false;\n        break;\n    }\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Handle left stick input (analog input from gamepad)\n   */\n  private onLeftStickMoved(event: { x: number; y: number }): void {\n    this.analogMoveInput = { x: event.x, y: event.y };\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Combine digital and analog input (analog takes priority when active)\n   */\n  private updateCombinedInput(): void {\n    const analogLength = Math.sqrt(\n      this.analogMoveInput.x ** 2 + this.analogMoveInput.y ** 2\n    );\n\n    // Use analog if active (magnitude > small threshold), otherwise digital\n    if (analogLength > 0.1) {\n      this.moveInput = { ...this.analogMoveInput };\n    } else {\n      this.moveInput = { ...this.digitalMoveInput };\n    }\n  }\n\n  /**\n   * Fixed update for physics\n   */\n  public fixedUpdate(fixedDeltaTime: number, _gameTime: GameTime): void {\n    if (this.state === PlayerState.InMenu || this.state === PlayerState.Interacting) {\n      return;\n    }\n\n    this.updateMovement(fixedDeltaTime);\n  }\n\n  /**\n   * Update movement physics\n   */\n  private updateMovement(deltaTime: number): void {\n    const { acceleration, deceleration, walkSpeed, runSpeed } = this.config;\n\n    // Normalize input\n    let inputX = this.moveInput.x;\n    let inputY = this.moveInput.y;\n    const inputLength = Math.sqrt(inputX * inputX + inputY * inputY);\n    if (inputLength > 1) {\n      inputX /= inputLength;\n      inputY /= inputLength;\n    }\n\n    // Calculate target velocity\n    const maxSpeed = this.isSprinting ? runSpeed : walkSpeed;\n    const targetVelX = inputX * maxSpeed;\n    const targetVelY = inputY * maxSpeed;\n\n    // Apply acceleration/deceleration\n    if (inputLength > 0) {\n      // Accelerate toward target\n      this.velocity.x = this.approach(this.velocity.x, targetVelX, acceleration * deltaTime);\n      this.velocity.y = this.approach(this.velocity.y, targetVelY, acceleration * deltaTime);\n    } else {\n      // Decelerate to stop\n      this.velocity.x = this.approach(this.velocity.x, 0, deceleration * deltaTime);\n      this.velocity.y = this.approach(this.velocity.y, 0, deceleration * deltaTime);\n    }\n\n    // Calculate new position\n    const newX = this.position.x + this.velocity.x * deltaTime;\n    const newY = this.position.y + this.velocity.y * deltaTime;\n\n    // Check collision (simple tile-based check)\n    const canMoveX = this.canMoveTo(newX, this.position.y);\n    const canMoveY = this.canMoveTo(this.position.x, newY);\n\n    const oldPosition = { ...this.position };\n\n    if (canMoveX) {\n      this.position.x = newX;\n    } else {\n      this.velocity.x = 0;\n    }\n\n    if (canMoveY) {\n      this.position.y = newY;\n    } else {\n      this.velocity.y = 0;\n    }\n\n    // Update facing direction\n    if (inputLength > 0) {\n      this.facing = this.calculateFacing(inputX, inputY);\n    }\n\n    // Update state\n    this.updateState();\n\n    // Emit movement event if position changed\n    if (this.position.x !== oldPosition.x || this.position.y !== oldPosition.y) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:moved', { position: { ...this.position } });\n    }\n  }\n\n  /**\n   * Check if player can move to a position\n   */\n  private canMoveTo(x: number, y: number): boolean {\n    if (!this.checkWalkable) {\n      return true; // No collision check set, allow movement\n    }\n\n    // Check the tile at the target position\n    const tileX = Math.floor(x);\n    const tileY = Math.floor(y);\n\n    return this.checkWalkable(tileX, tileY);\n  }\n\n  /**\n   * Calculate facing direction from input\n   */\n  private calculateFacing(inputX: number, inputY: number): Direction {\n    // Prioritize vertical movement for diagonal\n    if (Math.abs(inputY) >= Math.abs(inputX)) {\n      return inputY < 0 ? Direction.North : Direction.South;\n    } else {\n      return inputX < 0 ? Direction.West : Direction.East;\n    }\n  }\n\n  /**\n   * Update player state based on current conditions\n   */\n  private updateState(): void {\n    const speed = Math.sqrt(this.velocity.x ** 2 + this.velocity.y ** 2);\n\n    if (speed < 0.1) {\n      this.state = PlayerState.Idle;\n    } else if (this.isSprinting && speed > this.config.walkSpeed * 0.9) {\n      this.state = PlayerState.Running;\n    } else {\n      this.state = PlayerState.Walking;\n    }\n  }\n\n  /**\n   * Handle interaction\n   */\n  private interact(): void {\n    // Calculate the tile in front of the player\n    const targetX = Math.floor(this.position.x + this.getFacingOffset().x);\n    const targetY = Math.floor(this.position.y + this.getFacingOffset().y);\n\n    const eventBus = getEventBus();\n    eventBus.emit('player:interacted', {\n      targetId: null,\n      position: { x: targetX, y: targetY },\n    });\n  }\n\n  /**\n   * Get the offset for the facing direction\n   */\n  private getFacingOffset(): Vector2 {\n    switch (this.facing) {\n      case Direction.North:\n        return { x: 0, y: -1 };\n      case Direction.South:\n        return { x: 0, y: 1 };\n      case Direction.East:\n        return { x: 1, y: 0 };\n      case Direction.West:\n        return { x: -1, y: 0 };\n      default:\n        return { x: 0, y: 0 };\n    }\n  }\n\n  /**\n   * Approach a target value at a given rate\n   */\n  private approach(current: number, target: number, rate: number): number {\n    if (current < target) {\n      return Math.min(current + rate, target);\n    } else {\n      return Math.max(current - rate, target);\n    }\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Get current position\n   */\n  public getPosition(): Readonly<Vector2> {\n    return this.position;\n  }\n\n  /**\n   * Set position (e.g., for teleportation or loading)\n   */\n  public setPosition(x: number, y: number): void {\n    this.position = { x, y };\n    this.velocity = { x: 0, y: 0 };\n\n    const eventBus = getEventBus();\n    eventBus.emit('player:moved', { position: { ...this.position } });\n  }\n\n  /**\n   * Get current velocity\n   */\n  public getVelocity(): Readonly<Vector2> {\n    return this.velocity;\n  }\n\n  /**\n   * Get current facing direction\n   */\n  public getFacing(): Direction {\n    return this.facing;\n  }\n\n  /**\n   * Get current state\n   */\n  public getState(): PlayerState {\n    return this.state;\n  }\n\n  /**\n   * Set state (e.g., for entering menus)\n   */\n  public setState(state: PlayerState): void {\n    this.state = state;\n\n    // Reset velocity when entering menu/interacting\n    if (state === PlayerState.InMenu || state === PlayerState.Interacting) {\n      this.velocity = { x: 0, y: 0 };\n    }\n  }\n\n  /**\n   * Check if player is moving\n   */\n  public isMoving(): boolean {\n    return this.state === PlayerState.Walking || this.state === PlayerState.Running;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[PlayerController] Destroyed');\n  }\n}\n","/**\n * CameraSystem - Smooth camera following for the player\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Camera Settings:\n * - Follow speed: 5.0\n * - Deadzone: 0.5 units\n * - Zoom range: 0.5x to 2.0x\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { Vector2, Bounds, GameTime } from '@core/types';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nexport interface CameraConfig {\n  followSpeed: number;      // How fast camera follows target\n  deadzone: number;         // Distance before camera starts moving\n  minZoom: number;          // Minimum zoom level\n  maxZoom: number;          // Maximum zoom level\n  zoomSpeed: number;        // How fast zoom changes\n  shakeDecay: number;       // How fast shake diminishes\n  viewportWidth: number;    // Viewport width in tiles\n  viewportHeight: number;   // Viewport height in tiles\n}\n\nconst DEFAULT_CONFIG: CameraConfig = {\n  followSpeed: 5.0,\n  deadzone: 0.5,\n  minZoom: 0.5,\n  maxZoom: 2.0,\n  zoomSpeed: 2.0,\n  shakeDecay: 5.0,\n  viewportWidth: 20,\n  viewportHeight: 15,\n};\n\n// ============================================================================\n// CameraSystem Implementation\n// ============================================================================\n\nexport class CameraSystem implements GameSystem {\n  public readonly name = 'CameraSystem';\n\n  private config: CameraConfig;\n  private position: Vector2 = { x: 0, y: 0 };\n  private targetPosition: Vector2 = { x: 0, y: 0 };\n  private zoom = 1.0;\n  private targetZoom = 1.0;\n\n  // Screen shake\n  private shakeIntensity = 0;\n  private shakeOffset: Vector2 = { x: 0, y: 0 };\n\n  // Bounds (optional camera limits)\n  private bounds: Bounds | null = null;\n\n  constructor(config: Partial<CameraConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the camera system\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for player movement\n    eventBus.on('player:moved', (event) => {\n      this.setTarget(event.position.x, event.position.y);\n    });\n\n    // Listen for zoom input\n    eventBus.on('input:actionPressed', (event) => {\n      if (event.action === 'zoomIn') {\n        this.zoomIn();\n      } else if (event.action === 'zoomOut') {\n        this.zoomOut();\n      }\n    });\n\n    console.log('[CameraSystem] Initialized');\n  }\n\n  /**\n   * Late update - camera follows after all other updates\n   */\n  public lateUpdate(deltaTime: number, _gameTime: GameTime): void {\n    this.updateFollow(deltaTime);\n    this.updateZoom(deltaTime);\n    this.updateShake(deltaTime);\n  }\n\n  /**\n   * Update camera following\n   */\n  private updateFollow(deltaTime: number): void {\n    const { followSpeed, deadzone } = this.config;\n\n    // Calculate distance to target\n    const dx = this.targetPosition.x - this.position.x;\n    const dy = this.targetPosition.y - this.position.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n\n    // Only move if outside deadzone\n    if (distance > deadzone) {\n      // Calculate movement\n      const moveAmount = followSpeed * deltaTime;\n\n      if (moveAmount >= distance) {\n        // Snap to target if we'd overshoot\n        this.position.x = this.targetPosition.x;\n        this.position.y = this.targetPosition.y;\n      } else {\n        // Move toward target\n        const ratio = moveAmount / distance;\n        this.position.x += dx * ratio;\n        this.position.y += dy * ratio;\n      }\n    }\n\n    // Apply bounds if set\n    if (this.bounds) {\n      this.clampToBounds();\n    }\n  }\n\n  /**\n   * Update zoom level\n   */\n  private updateZoom(deltaTime: number): void {\n    if (this.zoom !== this.targetZoom) {\n      const { zoomSpeed } = this.config;\n      const diff = this.targetZoom - this.zoom;\n      const change = zoomSpeed * deltaTime;\n\n      if (Math.abs(diff) <= change) {\n        this.zoom = this.targetZoom;\n      } else {\n        this.zoom += Math.sign(diff) * change;\n      }\n    }\n  }\n\n  /**\n   * Update screen shake\n   */\n  private updateShake(deltaTime: number): void {\n    if (this.shakeIntensity > 0) {\n      // Generate random shake offset\n      const angle = Math.random() * Math.PI * 2;\n      this.shakeOffset.x = Math.cos(angle) * this.shakeIntensity;\n      this.shakeOffset.y = Math.sin(angle) * this.shakeIntensity;\n\n      // Decay shake\n      this.shakeIntensity -= this.config.shakeDecay * deltaTime;\n      if (this.shakeIntensity < 0) {\n        this.shakeIntensity = 0;\n        this.shakeOffset.x = 0;\n        this.shakeOffset.y = 0;\n      }\n    }\n  }\n\n  /**\n   * Clamp camera position to bounds\n   */\n  private clampToBounds(): void {\n    if (!this.bounds) return;\n\n    const halfWidth = this.getViewWidth() / 2;\n    const halfHeight = this.getViewHeight() / 2;\n\n    this.position.x = Math.max(\n      this.bounds.x + halfWidth,\n      Math.min(this.bounds.x + this.bounds.width - halfWidth, this.position.x)\n    );\n\n    this.position.y = Math.max(\n      this.bounds.y + halfHeight,\n      Math.min(this.bounds.y + this.bounds.height - halfHeight, this.position.y)\n    );\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Set camera target position\n   */\n  public setTarget(x: number, y: number): void {\n    this.targetPosition.x = x;\n    this.targetPosition.y = y;\n  }\n\n  /**\n   * Immediately snap camera to position\n   */\n  public snapTo(x: number, y: number): void {\n    this.position.x = x;\n    this.position.y = y;\n    this.targetPosition.x = x;\n    this.targetPosition.y = y;\n  }\n\n  /**\n   * Get camera position (with shake applied)\n   */\n  public getPosition(): Readonly<Vector2> {\n    return {\n      x: this.position.x + this.shakeOffset.x,\n      y: this.position.y + this.shakeOffset.y,\n    };\n  }\n\n  /**\n   * Get raw camera position (without shake)\n   */\n  public getRawPosition(): Readonly<Vector2> {\n    return this.position;\n  }\n\n  /**\n   * Get current zoom level\n   */\n  public getZoom(): number {\n    return this.zoom;\n  }\n\n  /**\n   * Set zoom level\n   */\n  public setZoom(zoom: number): void {\n    this.targetZoom = Math.max(this.config.minZoom, Math.min(this.config.maxZoom, zoom));\n  }\n\n  /**\n   * Zoom in\n   */\n  public zoomIn(): void {\n    this.setZoom(this.targetZoom * 1.2);\n  }\n\n  /**\n   * Zoom out\n   */\n  public zoomOut(): void {\n    this.setZoom(this.targetZoom / 1.2);\n  }\n\n  /**\n   * Add screen shake\n   */\n  public shake(intensity: number): void {\n    this.shakeIntensity = Math.max(this.shakeIntensity, intensity);\n  }\n\n  /**\n   * Set camera bounds\n   */\n  public setBounds(bounds: Bounds | null): void {\n    this.bounds = bounds;\n    if (bounds) {\n      this.clampToBounds();\n    }\n  }\n\n  /**\n   * Get visible area in world coordinates\n   */\n  public getViewBounds(): Bounds {\n    const halfWidth = this.getViewWidth() / 2;\n    const halfHeight = this.getViewHeight() / 2;\n    const pos = this.getPosition();\n\n    return {\n      x: pos.x - halfWidth,\n      y: pos.y - halfHeight,\n      width: this.getViewWidth(),\n      height: this.getViewHeight(),\n    };\n  }\n\n  /**\n   * Get view width in world units\n   */\n  public getViewWidth(): number {\n    return this.config.viewportWidth / this.zoom;\n  }\n\n  /**\n   * Get view height in world units\n   */\n  public getViewHeight(): number {\n    return this.config.viewportHeight / this.zoom;\n  }\n\n  /**\n   * Convert screen coordinates to world coordinates\n   */\n  public screenToWorld(screenX: number, screenY: number, screenWidth: number, screenHeight: number): Vector2 {\n    const pos = this.getPosition();\n    const viewWidth = this.getViewWidth();\n    const viewHeight = this.getViewHeight();\n\n    return {\n      x: pos.x + (screenX / screenWidth - 0.5) * viewWidth,\n      y: pos.y + (screenY / screenHeight - 0.5) * viewHeight,\n    };\n  }\n\n  /**\n   * Convert world coordinates to screen coordinates\n   */\n  public worldToScreen(worldX: number, worldY: number, screenWidth: number, screenHeight: number): Vector2 {\n    const pos = this.getPosition();\n    const viewWidth = this.getViewWidth();\n    const viewHeight = this.getViewHeight();\n\n    return {\n      x: ((worldX - pos.x) / viewWidth + 0.5) * screenWidth,\n      y: ((worldY - pos.y) / viewHeight + 0.5) * screenHeight,\n    };\n  }\n\n  /**\n   * Check if a world position is visible\n   */\n  public isVisible(worldX: number, worldY: number, margin = 0): boolean {\n    const bounds = this.getViewBounds();\n    return (\n      worldX >= bounds.x - margin &&\n      worldX <= bounds.x + bounds.width + margin &&\n      worldY >= bounds.y - margin &&\n      worldY <= bounds.y + bounds.height + margin\n    );\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[CameraSystem] Destroyed');\n  }\n}\n","/**\n * SaveManager - Handles game state persistence\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Save System:\n * - JSON serialization\n * - Version migrations\n * - Save slot management\n * - Target: < 5 seconds for 10 regions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { SaveData, SaveMetadata, Vector2, GameTime } from '@core/types';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst SAVE_VERSION = '0.1.0';\nconst STORAGE_PREFIX = 'voxel_rpg_save_';\nconst MAX_SAVE_SLOTS = 10;\n\n// ============================================================================\n// Save Slot Info\n// ============================================================================\n\nexport interface SaveSlotInfo {\n  slot: string;\n  exists: boolean;\n  metadata?: SaveMetadata;\n}\n\n// ============================================================================\n// Serializable Game State Interface\n// ============================================================================\n\nexport interface GameStateProvider {\n  getPlayerPosition(): Vector2;\n  getPlayerHealth(): number;\n  getPlayerMaxHealth(): number;\n  getPlayerInventory(): Array<{ itemId: string; quantity: number }>;\n  getWorldSeed(): number;\n  getModifiedTiles(): Array<{ position: { x: number; y: number }; layer: number; typeId: string }>;\n  getTotalPlaytime(): number;\n  getGameDay(): number;\n}\n\nexport interface GameStateConsumer {\n  loadPlayerPosition(position: Vector2): void;\n  loadPlayerHealth(current: number, max: number): void;\n  loadPlayerInventory(items: Array<{ itemId: string; quantity: number }>): void;\n  loadWorldSeed(seed: number): void;\n  loadModifiedTiles(tiles: Array<{ position: { x: number; y: number }; layer: number; typeId: string }>): void;\n  loadPlaytime(seconds: number): void;\n  loadGameDay(day: number): void;\n}\n\n// ============================================================================\n// SaveManager Implementation\n// ============================================================================\n\nexport class SaveManager implements GameSystem {\n  public readonly name = 'SaveManager';\n\n  private stateProvider: GameStateProvider | null = null;\n  private stateConsumer: GameStateConsumer | null = null;\n  private autosaveInterval: number | null = null;\n  private autosaveSlot = 'autosave';\n\n  /**\n   * Initialize the save manager\n   */\n  public initialize(): void {\n    console.log('[SaveManager] Initialized');\n  }\n\n  /**\n   * Set the game state provider (for saving)\n   */\n  public setStateProvider(provider: GameStateProvider): void {\n    this.stateProvider = provider;\n  }\n\n  /**\n   * Set the game state consumer (for loading)\n   */\n  public setStateConsumer(consumer: GameStateConsumer): void {\n    this.stateConsumer = consumer;\n  }\n\n  /**\n   * Get all save slots\n   */\n  public getSaveSlots(): SaveSlotInfo[] {\n    const slots: SaveSlotInfo[] = [];\n\n    // Check numbered slots\n    for (let i = 1; i <= MAX_SAVE_SLOTS; i++) {\n      const slot = `slot${i}`;\n      const key = STORAGE_PREFIX + slot;\n      const exists = localStorage.getItem(key) !== null;\n      const info: SaveSlotInfo = { slot, exists };\n\n      if (exists) {\n        try {\n          const data = JSON.parse(localStorage.getItem(key)!) as SaveData;\n          info.metadata = data.metadata;\n        } catch {\n          // Invalid save data\n        }\n      }\n\n      slots.push(info);\n    }\n\n    // Check autosave slot\n    const autosaveKey = STORAGE_PREFIX + this.autosaveSlot;\n    const autosaveExists = localStorage.getItem(autosaveKey) !== null;\n    const autosaveInfo: SaveSlotInfo = { slot: this.autosaveSlot, exists: autosaveExists };\n\n    if (autosaveExists) {\n      try {\n        const data = JSON.parse(localStorage.getItem(autosaveKey)!) as SaveData;\n        autosaveInfo.metadata = data.metadata;\n      } catch {\n        // Invalid save data\n      }\n    }\n\n    slots.unshift(autosaveInfo);\n\n    return slots;\n  }\n\n  /**\n   * Save game to a slot\n   */\n  public async saveGame(slot: string): Promise<boolean> {\n    if (!this.stateProvider) {\n      console.error('[SaveManager] No state provider set');\n      return false;\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('save:started', { slot });\n\n    try {\n      const saveData = this.createSaveData(slot);\n      const json = JSON.stringify(saveData);\n      const key = STORAGE_PREFIX + slot;\n\n      localStorage.setItem(key, json);\n\n      eventBus.emit('save:completed', { slot });\n      console.log(`[SaveManager] Game saved to slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      eventBus.emit('save:failed', { slot, error: message });\n      console.error(`[SaveManager] Save failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Load game from a slot\n   */\n  public async loadGame(slot: string): Promise<boolean> {\n    if (!this.stateConsumer) {\n      console.error('[SaveManager] No state consumer set');\n      return false;\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('load:started', { slot });\n\n    try {\n      const key = STORAGE_PREFIX + slot;\n      const json = localStorage.getItem(key);\n\n      if (!json) {\n        throw new Error(`Save slot \"${slot}\" not found`);\n      }\n\n      const saveData = JSON.parse(json) as SaveData;\n\n      // Check version and migrate if needed\n      const migratedData = this.migrateData(saveData);\n\n      // Apply save data to game state\n      this.applySaveData(migratedData);\n\n      eventBus.emit('load:completed', { slot });\n      console.log(`[SaveManager] Game loaded from slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      eventBus.emit('load:failed', { slot, error: message });\n      console.error(`[SaveManager] Load failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Delete a save slot\n   */\n  public deleteSave(slot: string): boolean {\n    try {\n      const key = STORAGE_PREFIX + slot;\n      localStorage.removeItem(key);\n      console.log(`[SaveManager] Deleted save slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      console.error(`[SaveManager] Delete failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Check if a save slot exists\n   */\n  public saveExists(slot: string): boolean {\n    const key = STORAGE_PREFIX + slot;\n    return localStorage.getItem(key) !== null;\n  }\n\n  /**\n   * Enable autosave at specified interval (in seconds)\n   */\n  public enableAutosave(intervalSeconds: number): void {\n    this.disableAutosave();\n    this.autosaveInterval = window.setInterval(() => {\n      this.saveGame(this.autosaveSlot);\n    }, intervalSeconds * 1000);\n    console.log(`[SaveManager] Autosave enabled every ${intervalSeconds} seconds`);\n  }\n\n  /**\n   * Disable autosave\n   */\n  public disableAutosave(): void {\n    if (this.autosaveInterval !== null) {\n      window.clearInterval(this.autosaveInterval);\n      this.autosaveInterval = null;\n      console.log('[SaveManager] Autosave disabled');\n    }\n  }\n\n  /**\n   * Create save data from current game state\n   */\n  private createSaveData(slotName: string): SaveData {\n    const provider = this.stateProvider!;\n\n    return {\n      metadata: {\n        version: SAVE_VERSION,\n        timestamp: Date.now(),\n        playtimeSeconds: provider.getTotalPlaytime(),\n        slotName,\n      },\n      world: {\n        seed: provider.getWorldSeed(),\n        modifiedTiles: provider.getModifiedTiles(),\n      },\n      player: {\n        position: provider.getPlayerPosition(),\n        health: provider.getPlayerHealth(),\n        maxHealth: provider.getPlayerMaxHealth(),\n        inventory: provider.getPlayerInventory(),\n      },\n      gameTime: {\n        totalSeconds: provider.getTotalPlaytime(),\n        gameDay: provider.getGameDay(),\n      },\n    };\n  }\n\n  /**\n   * Apply save data to game state\n   */\n  private applySaveData(data: SaveData): void {\n    const consumer = this.stateConsumer!;\n\n    consumer.loadWorldSeed(data.world.seed);\n    consumer.loadModifiedTiles(data.world.modifiedTiles);\n    consumer.loadPlayerPosition(data.player.position);\n    consumer.loadPlayerHealth(data.player.health, data.player.maxHealth);\n    consumer.loadPlayerInventory(data.player.inventory);\n    consumer.loadPlaytime(data.gameTime.totalSeconds);\n    consumer.loadGameDay(data.gameTime.gameDay);\n  }\n\n  /**\n   * Migrate save data from older versions\n   */\n  private migrateData(data: SaveData): SaveData {\n    // Currently no migrations needed\n    // Future migrations would check data.metadata.version and transform as needed\n    return data;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.disableAutosave();\n    console.log('[SaveManager] Destroyed');\n  }\n}\n","/**\n * InputManager - Handles keyboard, mouse, and gamepad input\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Input System:\n * - Default bindings for keyboard and gamepad\n * - Rebindable keys\n * - Target: < 50ms input latency\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { InputAction, InputBinding, Vector2, GameTime } from '@core/types';\nimport { GamepadButton, GamepadAxis } from '@core/types';\n\n// ============================================================================\n// Default Bindings\n// ============================================================================\n\n/**\n * Default input bindings per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * | Action    | Keyboard       | Gamepad          |\n * |-----------|----------------|------------------|\n * | Move      | WASD / Arrows  | Left Stick       |\n * | Sprint    | Shift          | Left Trigger     |\n * | Interact  | E              | A Button         |\n * | Attack    | Left Click     | Right Trigger    |\n * | Cancel    | Escape         | B Button         |\n * | Inventory | I              | Start            |\n * | Build Menu| B              | Select           |\n */\nconst DEFAULT_BINDINGS: InputBinding[] = [\n  // Movement (D-pad also supported for digital input)\n  { action: 'moveUp' as InputAction, keys: ['KeyW', 'ArrowUp'], gamepadButtons: [GamepadButton.DPadUp] },\n  { action: 'moveDown' as InputAction, keys: ['KeyS', 'ArrowDown'], gamepadButtons: [GamepadButton.DPadDown] },\n  { action: 'moveLeft' as InputAction, keys: ['KeyA', 'ArrowLeft'], gamepadButtons: [GamepadButton.DPadLeft] },\n  { action: 'moveRight' as InputAction, keys: ['KeyD', 'ArrowRight'], gamepadButtons: [GamepadButton.DPadRight] },\n  // Actions\n  { action: 'sprint' as InputAction, keys: ['ShiftLeft', 'ShiftRight'], gamepadButtons: [GamepadButton.LeftTrigger] },\n  { action: 'interact' as InputAction, keys: ['KeyE'], gamepadButtons: [GamepadButton.A] },\n  { action: 'attack' as InputAction, keys: [], mouseButtons: [0], gamepadButtons: [GamepadButton.RightTrigger] },\n  { action: 'secondary' as InputAction, keys: [], mouseButtons: [2], gamepadButtons: [GamepadButton.RightBumper] },\n  { action: 'cancel' as InputAction, keys: ['Escape'], gamepadButtons: [GamepadButton.B] },\n  { action: 'inventory' as InputAction, keys: ['KeyI'], gamepadButtons: [GamepadButton.Start] },\n  { action: 'buildMenu' as InputAction, keys: ['KeyB'], gamepadButtons: [GamepadButton.Select] },\n  { action: 'pause' as InputAction, keys: ['KeyP', 'Escape'], gamepadButtons: [GamepadButton.Start] },\n  // Zoom (bumpers on gamepad)\n  { action: 'zoomIn' as InputAction, keys: ['Equal', 'NumpadAdd'], gamepadButtons: [GamepadButton.Y] },\n  { action: 'zoomOut' as InputAction, keys: ['Minus', 'NumpadSubtract'], gamepadButtons: [GamepadButton.X] },\n  // Quick slots (no gamepad equivalent - use radial menu instead)\n  { action: 'quickSlot1' as InputAction, keys: ['Digit1', 'Numpad1'] },\n  { action: 'quickSlot2' as InputAction, keys: ['Digit2', 'Numpad2'] },\n  { action: 'quickSlot3' as InputAction, keys: ['Digit3', 'Numpad3'] },\n  { action: 'quickSlot4' as InputAction, keys: ['Digit4', 'Numpad4'] },\n  { action: 'quickSlot5' as InputAction, keys: ['Digit5', 'Numpad5'] },\n  { action: 'quickSlot6' as InputAction, keys: ['Digit6', 'Numpad6'] },\n  { action: 'quickSlot7' as InputAction, keys: ['Digit7', 'Numpad7'] },\n  { action: 'quickSlot8' as InputAction, keys: ['Digit8', 'Numpad8'] },\n  { action: 'quickSlot9' as InputAction, keys: ['Digit9', 'Numpad9'] },\n];\n\n// Gamepad configuration\nconst GAMEPAD_CONFIG = {\n  deadzone: 0.15,           // Stick deadzone to prevent drift\n  triggerThreshold: 0.5,    // Trigger activation threshold\n};\n\n// ============================================================================\n// InputManager Implementation\n// ============================================================================\n\nexport class InputManager implements GameSystem {\n  public readonly name = 'InputManager';\n\n  private bindings: InputBinding[] = [];\n  private keyToAction: Map<string, InputAction[]> = new Map();\n  private mouseButtonToAction: Map<number, InputAction[]> = new Map();\n  private gamepadButtonToAction: Map<number, InputAction[]> = new Map();\n\n  // Current input state\n  private pressedKeys: Set<string> = new Set();\n  private pressedMouseButtons: Set<number> = new Set();\n  private pressedGamepadButtons: Set<number> = new Set();\n  private activeActions: Set<InputAction> = new Set();\n\n  // Mouse state\n  private mousePosition: Vector2 = { x: 0, y: 0 };\n  private mouseWorldPosition: Vector2 = { x: 0, y: 0 };\n\n  // Gamepad state\n  private activeGamepadIndex: number | null = null;\n  private leftStickInput: Vector2 = { x: 0, y: 0 };\n  private rightStickInput: Vector2 = { x: 0, y: 0 };\n  private gamepadConnected = false;\n\n  // Screen to world converter (set by game)\n  private screenToWorld: ((screenX: number, screenY: number) => Vector2) | null = null;\n\n  /**\n   * Initialize the input manager\n   */\n  public initialize(): void {\n    // Load default bindings\n    this.setBindings(DEFAULT_BINDINGS);\n\n    // Set up keyboard/mouse event listeners\n    window.addEventListener('keydown', this.onKeyDown.bind(this));\n    window.addEventListener('keyup', this.onKeyUp.bind(this));\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\n    window.addEventListener('mousemove', this.onMouseMove.bind(this));\n    window.addEventListener('contextmenu', this.onContextMenu.bind(this));\n    window.addEventListener('blur', this.onBlur.bind(this));\n\n    // Set up gamepad event listeners\n    window.addEventListener('gamepadconnected', this.onGamepadConnected.bind(this));\n    window.addEventListener('gamepaddisconnected', this.onGamepadDisconnected.bind(this));\n\n    // Check for already-connected gamepads\n    this.detectGamepads();\n\n    console.log('[InputManager] Initialized');\n  }\n\n  /**\n   * Update - polls gamepad state (Gamepad API requires polling)\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    this.pollGamepad();\n  }\n\n  /**\n   * Set input bindings\n   */\n  public setBindings(bindings: InputBinding[]): void {\n    this.bindings = [...bindings];\n    this.rebuildBindingMaps();\n  }\n\n  /**\n   * Get current bindings\n   */\n  public getBindings(): readonly InputBinding[] {\n    return this.bindings;\n  }\n\n  /**\n   * Rebind a key for an action\n   */\n  public rebindKey(action: InputAction, oldKey: string, newKey: string): void {\n    const binding = this.bindings.find(b => b.action === action);\n    if (binding) {\n      const index = binding.keys.indexOf(oldKey);\n      if (index !== -1) {\n        binding.keys[index] = newKey;\n        this.rebuildBindingMaps();\n      }\n    }\n  }\n\n  /**\n   * Set screen to world conversion function\n   */\n  public setScreenToWorldConverter(fn: (screenX: number, screenY: number) => Vector2): void {\n    this.screenToWorld = fn;\n  }\n\n  /**\n   * Rebuild the key/button to action maps\n   */\n  private rebuildBindingMaps(): void {\n    this.keyToAction.clear();\n    this.mouseButtonToAction.clear();\n    this.gamepadButtonToAction.clear();\n\n    for (const binding of this.bindings) {\n      // Map keys to actions\n      for (const key of binding.keys) {\n        const actions = this.keyToAction.get(key) ?? [];\n        actions.push(binding.action);\n        this.keyToAction.set(key, actions);\n      }\n\n      // Map mouse buttons to actions\n      if (binding.mouseButtons) {\n        for (const button of binding.mouseButtons) {\n          const actions = this.mouseButtonToAction.get(button) ?? [];\n          actions.push(binding.action);\n          this.mouseButtonToAction.set(button, actions);\n        }\n      }\n\n      // Map gamepad buttons to actions\n      if (binding.gamepadButtons) {\n        for (const button of binding.gamepadButtons) {\n          const actions = this.gamepadButtonToAction.get(button) ?? [];\n          actions.push(binding.action);\n          this.gamepadButtonToAction.set(button, actions);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle key down event\n   */\n  private onKeyDown(event: KeyboardEvent): void {\n    // Ignore if typing in an input field\n    if (this.isTypingInInput(event)) {\n      return;\n    }\n\n    const key = event.code;\n\n    if (this.pressedKeys.has(key)) {\n      return; // Already pressed, ignore repeat\n    }\n\n    this.pressedKeys.add(key);\n\n    // Trigger actions for this key\n    const actions = this.keyToAction.get(key);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        if (!this.activeActions.has(action)) {\n          this.activeActions.add(action);\n          eventBus.emit('input:actionPressed', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle key up event\n   */\n  private onKeyUp(event: KeyboardEvent): void {\n    const key = event.code;\n    this.pressedKeys.delete(key);\n\n    // Check if actions should be released\n    const actions = this.keyToAction.get(key);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        // Only release if no other bound keys are still pressed\n        if (!this.isActionStillPressed(action)) {\n          this.activeActions.delete(action);\n          eventBus.emit('input:actionReleased', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse down event\n   */\n  private onMouseDown(event: MouseEvent): void {\n    const button = event.button;\n    this.pressedMouseButtons.add(button);\n\n    const eventBus = getEventBus();\n\n    // Emit click event\n    eventBus.emit('input:mouseClicked', {\n      button,\n      position: { ...this.mousePosition },\n      worldPosition: { ...this.mouseWorldPosition },\n    });\n\n    // Trigger actions for this button\n    const actions = this.mouseButtonToAction.get(button);\n    if (actions) {\n      for (const action of actions) {\n        if (!this.activeActions.has(action)) {\n          this.activeActions.add(action);\n          eventBus.emit('input:actionPressed', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse up event\n   */\n  private onMouseUp(event: MouseEvent): void {\n    const button = event.button;\n    this.pressedMouseButtons.delete(button);\n\n    // Check if actions should be released\n    const actions = this.mouseButtonToAction.get(button);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        if (!this.isActionStillPressed(action)) {\n          this.activeActions.delete(action);\n          eventBus.emit('input:actionReleased', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse move event\n   */\n  private onMouseMove(event: MouseEvent): void {\n    this.mousePosition = { x: event.clientX, y: event.clientY };\n\n    // Calculate world position if converter is set\n    if (this.screenToWorld) {\n      this.mouseWorldPosition = this.screenToWorld(event.clientX, event.clientY);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:mouseMoved', {\n      position: { ...this.mousePosition },\n      worldPosition: { ...this.mouseWorldPosition },\n    });\n  }\n\n  /**\n   * Handle context menu (prevent default right-click menu)\n   */\n  private onContextMenu(event: Event): void {\n    event.preventDefault();\n  }\n\n  /**\n   * Handle window blur (release all keys)\n   */\n  private onBlur(): void {\n    const eventBus = getEventBus();\n\n    // Release all active actions\n    for (const action of this.activeActions) {\n      eventBus.emit('input:actionReleased', { action });\n    }\n\n    this.pressedKeys.clear();\n    this.pressedMouseButtons.clear();\n    this.pressedGamepadButtons.clear();\n    this.activeActions.clear();\n    this.leftStickInput = { x: 0, y: 0 };\n    this.rightStickInput = { x: 0, y: 0 };\n  }\n\n  // ============================================================================\n  // Gamepad Methods\n  // ============================================================================\n\n  /**\n   * Handle gamepad connected event\n   */\n  private onGamepadConnected(event: GamepadEvent): void {\n    console.log(`[InputManager] Gamepad connected: ${event.gamepad.id}`);\n    this.activeGamepadIndex = event.gamepad.index;\n    this.gamepadConnected = true;\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:gamepadConnected', {\n      index: event.gamepad.index,\n      id: event.gamepad.id\n    });\n  }\n\n  /**\n   * Handle gamepad disconnected event\n   */\n  private onGamepadDisconnected(event: GamepadEvent): void {\n    console.log(`[InputManager] Gamepad disconnected: ${event.gamepad.id}`);\n\n    if (this.activeGamepadIndex === event.gamepad.index) {\n      this.activeGamepadIndex = null;\n      this.gamepadConnected = false;\n      this.pressedGamepadButtons.clear();\n      this.leftStickInput = { x: 0, y: 0 };\n      this.rightStickInput = { x: 0, y: 0 };\n\n      // Try to find another connected gamepad\n      this.detectGamepads();\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:gamepadDisconnected', {\n      index: event.gamepad.index,\n      id: event.gamepad.id\n    });\n  }\n\n  /**\n   * Detect already-connected gamepads\n   */\n  private detectGamepads(): void {\n    const gamepads = navigator.getGamepads();\n    for (const gamepad of gamepads) {\n      if (gamepad) {\n        this.activeGamepadIndex = gamepad.index;\n        this.gamepadConnected = true;\n        console.log(`[InputManager] Found gamepad: ${gamepad.id}`);\n        break;\n      }\n    }\n  }\n\n  /**\n   * Poll gamepad state (called every frame)\n   */\n  private pollGamepad(): void {\n    if (this.activeGamepadIndex === null) return;\n\n    const gamepads = navigator.getGamepads();\n    const gamepad = gamepads[this.activeGamepadIndex];\n\n    if (!gamepad) {\n      this.activeGamepadIndex = null;\n      this.gamepadConnected = false;\n      return;\n    }\n\n    // Poll buttons\n    this.pollGamepadButtons(gamepad);\n\n    // Poll analog sticks\n    this.pollGamepadSticks(gamepad);\n  }\n\n  /**\n   * Poll gamepad buttons\n   */\n  private pollGamepadButtons(gamepad: Gamepad): void {\n    const eventBus = getEventBus();\n\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i];\n      const isPressed = button.pressed || button.value > GAMEPAD_CONFIG.triggerThreshold;\n      const wasPressed = this.pressedGamepadButtons.has(i);\n\n      if (isPressed && !wasPressed) {\n        // Button pressed\n        this.pressedGamepadButtons.add(i);\n\n        const actions = this.gamepadButtonToAction.get(i);\n        if (actions) {\n          for (const action of actions) {\n            if (!this.activeActions.has(action)) {\n              this.activeActions.add(action);\n              eventBus.emit('input:actionPressed', { action });\n            }\n          }\n        }\n      } else if (!isPressed && wasPressed) {\n        // Button released\n        this.pressedGamepadButtons.delete(i);\n\n        const actions = this.gamepadButtonToAction.get(i);\n        if (actions) {\n          for (const action of actions) {\n            if (!this.isActionStillPressed(action)) {\n              this.activeActions.delete(action);\n              eventBus.emit('input:actionReleased', { action });\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Poll gamepad analog sticks\n   */\n  private pollGamepadSticks(gamepad: Gamepad): void {\n    const { deadzone } = GAMEPAD_CONFIG;\n\n    // Left stick\n    let leftX = gamepad.axes[GamepadAxis.LeftStickX] ?? 0;\n    let leftY = gamepad.axes[GamepadAxis.LeftStickY] ?? 0;\n\n    // Apply deadzone\n    if (Math.abs(leftX) < deadzone) leftX = 0;\n    if (Math.abs(leftY) < deadzone) leftY = 0;\n\n    // Update left stick input\n    const oldLeftX = this.leftStickInput.x;\n    const oldLeftY = this.leftStickInput.y;\n    this.leftStickInput = { x: leftX, y: leftY };\n\n    // Emit stick moved event if changed significantly\n    if (Math.abs(leftX - oldLeftX) > 0.01 || Math.abs(leftY - oldLeftY) > 0.01) {\n      const eventBus = getEventBus();\n      eventBus.emit('input:leftStickMoved', { x: leftX, y: leftY });\n    }\n\n    // Right stick\n    let rightX = gamepad.axes[GamepadAxis.RightStickX] ?? 0;\n    let rightY = gamepad.axes[GamepadAxis.RightStickY] ?? 0;\n\n    if (Math.abs(rightX) < deadzone) rightX = 0;\n    if (Math.abs(rightY) < deadzone) rightY = 0;\n\n    const oldRightX = this.rightStickInput.x;\n    const oldRightY = this.rightStickInput.y;\n    this.rightStickInput = { x: rightX, y: rightY };\n\n    if (Math.abs(rightX - oldRightX) > 0.01 || Math.abs(rightY - oldRightY) > 0.01) {\n      const eventBus = getEventBus();\n      eventBus.emit('input:rightStickMoved', { x: rightX, y: rightY });\n    }\n  }\n\n  /**\n   * Check if an action is still pressed by any bound key/button\n   */\n  private isActionStillPressed(action: InputAction): boolean {\n    const binding = this.bindings.find(b => b.action === action);\n    if (!binding) return false;\n\n    // Check keys\n    for (const key of binding.keys) {\n      if (this.pressedKeys.has(key)) {\n        return true;\n      }\n    }\n\n    // Check mouse buttons\n    if (binding.mouseButtons) {\n      for (const button of binding.mouseButtons) {\n        if (this.pressedMouseButtons.has(button)) {\n          return true;\n        }\n      }\n    }\n\n    // Check gamepad buttons\n    if (binding.gamepadButtons) {\n      for (const button of binding.gamepadButtons) {\n        if (this.pressedGamepadButtons.has(button)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if user is typing in an input field\n   */\n  private isTypingInInput(event: KeyboardEvent): boolean {\n    const target = event.target as HTMLElement;\n    return (\n      target.tagName === 'INPUT' ||\n      target.tagName === 'TEXTAREA' ||\n      target.isContentEditable\n    );\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Check if an action is currently active\n   */\n  public isActionActive(action: InputAction): boolean {\n    return this.activeActions.has(action);\n  }\n\n  /**\n   * Check if a key is currently pressed\n   */\n  public isKeyPressed(key: string): boolean {\n    return this.pressedKeys.has(key);\n  }\n\n  /**\n   * Check if a mouse button is currently pressed\n   */\n  public isMouseButtonPressed(button: number): boolean {\n    return this.pressedMouseButtons.has(button);\n  }\n\n  /**\n   * Get mouse position in screen coordinates\n   */\n  public getMousePosition(): Readonly<Vector2> {\n    return this.mousePosition;\n  }\n\n  /**\n   * Get mouse position in world coordinates\n   */\n  public getMouseWorldPosition(): Readonly<Vector2> {\n    return this.mouseWorldPosition;\n  }\n\n  /**\n   * Get all currently active actions\n   */\n  public getActiveActions(): ReadonlySet<InputAction> {\n    return this.activeActions;\n  }\n\n  // ============================================================================\n  // Gamepad Public API\n  // ============================================================================\n\n  /**\n   * Check if a gamepad is connected\n   */\n  public isGamepadConnected(): boolean {\n    return this.gamepadConnected;\n  }\n\n  /**\n   * Get left stick input (-1 to 1 for each axis)\n   */\n  public getLeftStick(): Readonly<Vector2> {\n    return this.leftStickInput;\n  }\n\n  /**\n   * Get right stick input (-1 to 1 for each axis)\n   */\n  public getRightStick(): Readonly<Vector2> {\n    return this.rightStickInput;\n  }\n\n  /**\n   * Check if a gamepad button is currently pressed\n   */\n  public isGamepadButtonPressed(button: number): boolean {\n    return this.pressedGamepadButtons.has(button);\n  }\n\n  /**\n   * Get the active gamepad (if any)\n   */\n  public getActiveGamepad(): Gamepad | null {\n    if (this.activeGamepadIndex === null) return null;\n    const gamepads = navigator.getGamepads();\n    return gamepads[this.activeGamepadIndex] ?? null;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    window.removeEventListener('keydown', this.onKeyDown.bind(this));\n    window.removeEventListener('keyup', this.onKeyUp.bind(this));\n    window.removeEventListener('mousedown', this.onMouseDown.bind(this));\n    window.removeEventListener('mouseup', this.onMouseUp.bind(this));\n    window.removeEventListener('mousemove', this.onMouseMove.bind(this));\n    window.removeEventListener('contextmenu', this.onContextMenu.bind(this));\n    window.removeEventListener('blur', this.onBlur.bind(this));\n    window.removeEventListener('gamepadconnected', this.onGamepadConnected.bind(this));\n    window.removeEventListener('gamepaddisconnected', this.onGamepadDisconnected.bind(this));\n\n    this.pressedKeys.clear();\n    this.pressedMouseButtons.clear();\n    this.pressedGamepadButtons.clear();\n    this.activeActions.clear();\n\n    console.log('[InputManager] Destroyed');\n  }\n}\n","/**\n * ResourceManager - Manages resource definitions and items\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 Resource System:\n * Categories: Raw Materials, Ores, Food, Special\n */\n\n// ============================================================================\n// Resource Categories\n// ============================================================================\n\nexport enum ResourceCategory {\n  RawMaterial = 'raw_material',\n  Ore = 'ore',\n  Food = 'food',\n  Tool = 'tool',\n  Weapon = 'weapon',\n  Armor = 'armor',\n  Building = 'building',\n  Special = 'special',\n  Consumable = 'consumable',\n}\n\n// ============================================================================\n// Resource Definition\n// ============================================================================\n\nexport interface ResourceDefinition {\n  id: string;\n  name: string;\n  description: string;\n  category: ResourceCategory;\n  stackSize: number;           // Max stack size (1 for non-stackable)\n  value: number;               // Base trade value\n  weight: number;              // Weight per unit\n  durability?: number;         // For tools/weapons/armor (undefined = indestructible)\n  damage?: number;             // For weapons\n  protection?: number;         // For armor\n  healAmount?: number;         // For food/consumables\n  hungerRestore?: number;      // For food\n  icon?: string;               // Icon asset path\n}\n\n// ============================================================================\n// Default Resources\n// ============================================================================\n\nconst DEFAULT_RESOURCES: ResourceDefinition[] = [\n  // Raw Materials\n  {\n    id: 'wood',\n    name: 'Wood',\n    description: 'Basic building material gathered from trees',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 2,\n    weight: 1,\n  },\n  {\n    id: 'stone',\n    name: 'Stone',\n    description: 'Common stone for building and tools',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 1,\n    weight: 2,\n  },\n  {\n    id: 'fiber',\n    name: 'Plant Fiber',\n    description: 'Flexible plant material for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 1,\n    weight: 0.2,\n  },\n  {\n    id: 'clay',\n    name: 'Clay',\n    description: 'Moldable earth for pottery and bricks',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 2,\n    weight: 1.5,\n  },\n  {\n    id: 'leather',\n    name: 'Leather',\n    description: 'Tanned animal hide',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 5,\n    weight: 0.5,\n  },\n  {\n    id: 'cloth',\n    name: 'Cloth',\n    description: 'Woven fabric from plant fibers',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 4,\n    weight: 0.3,\n  },\n\n  // Ores\n  {\n    id: 'iron_ore',\n    name: 'Iron Ore',\n    description: 'Raw iron ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 5,\n    weight: 3,\n  },\n  {\n    id: 'copper_ore',\n    name: 'Copper Ore',\n    description: 'Raw copper ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 3,\n    weight: 2.5,\n  },\n  {\n    id: 'gold_ore',\n    name: 'Gold Ore',\n    description: 'Precious gold ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 30,\n    value: 20,\n    weight: 4,\n  },\n  {\n    id: 'coal',\n    name: 'Coal',\n    description: 'Fuel for smelting and crafting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 2,\n    weight: 1,\n  },\n  {\n    id: 'iron_ingot',\n    name: 'Iron Ingot',\n    description: 'Smelted iron, ready for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 10,\n    weight: 2,\n  },\n  {\n    id: 'copper_ingot',\n    name: 'Copper Ingot',\n    description: 'Smelted copper, ready for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 6,\n    weight: 1.5,\n  },\n  {\n    id: 'gold_ingot',\n    name: 'Gold Ingot',\n    description: 'Smelted gold, valuable and beautiful',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 30,\n    value: 40,\n    weight: 3,\n  },\n\n  // Food\n  {\n    id: 'berries',\n    name: 'Berries',\n    description: 'Wild berries, slightly restores hunger',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 1,\n    weight: 0.1,\n    hungerRestore: 5,\n    healAmount: 0,\n  },\n  {\n    id: 'mushroom',\n    name: 'Mushroom',\n    description: 'Edible forest mushroom',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 2,\n    weight: 0.1,\n    hungerRestore: 8,\n    healAmount: 0,\n  },\n  {\n    id: 'raw_meat',\n    name: 'Raw Meat',\n    description: 'Uncooked meat, should be cooked before eating',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 5,\n    weight: 0.5,\n    hungerRestore: 10,\n    healAmount: -5, // Raw meat is bad for you\n  },\n  {\n    id: 'cooked_meat',\n    name: 'Cooked Meat',\n    description: 'Well-cooked meat, restores hunger and health',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 10,\n    weight: 0.4,\n    hungerRestore: 25,\n    healAmount: 10,\n  },\n  {\n    id: 'bread',\n    name: 'Bread',\n    description: 'Baked bread, a staple food',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 8,\n    weight: 0.2,\n    hungerRestore: 20,\n    healAmount: 0,\n  },\n  {\n    id: 'apple',\n    name: 'Apple',\n    description: 'Fresh apple from a tree',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 3,\n    weight: 0.2,\n    hungerRestore: 10,\n    healAmount: 2,\n  },\n  {\n    id: 'fish',\n    name: 'Cooked Fish',\n    description: 'Freshly caught and cooked fish',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 12,\n    weight: 0.4,\n    hungerRestore: 30,\n    healAmount: 5,\n  },\n\n  // Tools\n  {\n    id: 'stone_pickaxe',\n    name: 'Stone Pickaxe',\n    description: 'Basic mining tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 15,\n    weight: 3,\n    durability: 100,\n    damage: 5,\n  },\n  {\n    id: 'iron_pickaxe',\n    name: 'Iron Pickaxe',\n    description: 'Sturdy mining tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 50,\n    weight: 4,\n    durability: 250,\n    damage: 8,\n  },\n  {\n    id: 'stone_axe',\n    name: 'Stone Axe',\n    description: 'Basic woodcutting tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 15,\n    weight: 2.5,\n    durability: 100,\n    damage: 8,\n  },\n  {\n    id: 'iron_axe',\n    name: 'Iron Axe',\n    description: 'Sturdy woodcutting tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 50,\n    weight: 3.5,\n    durability: 250,\n    damage: 12,\n  },\n\n  // Weapons\n  {\n    id: 'wooden_sword',\n    name: 'Wooden Sword',\n    description: 'A basic wooden sword',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 10,\n    weight: 1.5,\n    durability: 50,\n    damage: 10,\n  },\n  {\n    id: 'stone_sword',\n    name: 'Stone Sword',\n    description: 'A crude stone blade',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 20,\n    weight: 3,\n    durability: 100,\n    damage: 15,\n  },\n  {\n    id: 'iron_sword',\n    name: 'Iron Sword',\n    description: 'A sturdy iron blade',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 75,\n    weight: 2.5,\n    durability: 300,\n    damage: 25,\n  },\n  {\n    id: 'bow',\n    name: 'Wooden Bow',\n    description: 'A ranged weapon for hunting',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 30,\n    weight: 1,\n    durability: 150,\n    damage: 20,\n  },\n  {\n    id: 'arrow',\n    name: 'Arrow',\n    description: 'Ammunition for bows',\n    category: ResourceCategory.Weapon,\n    stackSize: 50,\n    value: 1,\n    weight: 0.1,\n    damage: 5,\n  },\n\n  // Consumables\n  {\n    id: 'health_potion',\n    name: 'Health Potion',\n    description: 'Restores health when consumed',\n    category: ResourceCategory.Consumable,\n    stackSize: 10,\n    value: 25,\n    weight: 0.5,\n    healAmount: 50,\n  },\n  {\n    id: 'bandage',\n    name: 'Bandage',\n    description: 'Stops bleeding and heals minor wounds',\n    category: ResourceCategory.Consumable,\n    stackSize: 20,\n    value: 5,\n    weight: 0.1,\n    healAmount: 15,\n  },\n\n  // Building Materials\n  {\n    id: 'wooden_plank',\n    name: 'Wooden Plank',\n    description: 'Processed wood for building',\n    category: ResourceCategory.Building,\n    stackSize: 50,\n    value: 5,\n    weight: 1,\n  },\n  {\n    id: 'stone_brick',\n    name: 'Stone Brick',\n    description: 'Cut stone for sturdy construction',\n    category: ResourceCategory.Building,\n    stackSize: 50,\n    value: 4,\n    weight: 2,\n  },\n  {\n    id: 'rope',\n    name: 'Rope',\n    description: 'Woven rope for building and crafting',\n    category: ResourceCategory.Building,\n    stackSize: 30,\n    value: 6,\n    weight: 0.5,\n  },\n\n  // Special\n  {\n    id: 'portal_shard',\n    name: 'Portal Shard',\n    description: 'A mysterious crystal from a closed portal',\n    category: ResourceCategory.Special,\n    stackSize: 10,\n    value: 100,\n    weight: 0.3,\n  },\n  {\n    id: 'monster_essence',\n    name: 'Monster Essence',\n    description: 'Magical essence dropped by monsters',\n    category: ResourceCategory.Special,\n    stackSize: 50,\n    value: 15,\n    weight: 0.1,\n  },\n];\n\n// ============================================================================\n// ResourceManager Implementation\n// ============================================================================\n\nexport class ResourceManager {\n  private resources: Map<string, ResourceDefinition> = new Map();\n\n  constructor() {\n    // Register default resources\n    for (const resource of DEFAULT_RESOURCES) {\n      this.registerResource(resource);\n    }\n  }\n\n  /**\n   * Register a new resource\n   */\n  public registerResource(resource: ResourceDefinition): void {\n    this.resources.set(resource.id, resource);\n  }\n\n  /**\n   * Get a resource by ID\n   */\n  public getResource(id: string): ResourceDefinition | undefined {\n    return this.resources.get(id);\n  }\n\n  /**\n   * Get all resources\n   */\n  public getAllResources(): ResourceDefinition[] {\n    return Array.from(this.resources.values());\n  }\n\n  /**\n   * Get resources by category\n   */\n  public getResourcesByCategory(category: ResourceCategory): ResourceDefinition[] {\n    return this.getAllResources().filter(r => r.category === category);\n  }\n\n  /**\n   * Check if a resource exists\n   */\n  public hasResource(id: string): boolean {\n    return this.resources.has(id);\n  }\n\n  /**\n   * Get resource count\n   */\n  public getResourceCount(): number {\n    return this.resources.size;\n  }\n\n  /**\n   * Check if resource is stackable\n   */\n  public isStackable(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource ? resource.stackSize > 1 : false;\n  }\n\n  /**\n   * Get max stack size for a resource\n   */\n  public getStackSize(id: string): number {\n    const resource = this.getResource(id);\n    return resource?.stackSize ?? 1;\n  }\n\n  /**\n   * Check if resource is consumable (food or consumable)\n   */\n  public isConsumable(id: string): boolean {\n    const resource = this.getResource(id);\n    if (!resource) return false;\n    return resource.category === ResourceCategory.Food ||\n           resource.category === ResourceCategory.Consumable;\n  }\n\n  /**\n   * Check if resource is a weapon\n   */\n  public isWeapon(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource?.category === ResourceCategory.Weapon;\n  }\n\n  /**\n   * Check if resource is a tool\n   */\n  public isTool(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource?.category === ResourceCategory.Tool;\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet resourceManagerInstance: ResourceManager | null = null;\n\nexport function getResourceManager(): ResourceManager {\n  if (!resourceManagerInstance) {\n    resourceManagerInstance = new ResourceManager();\n  }\n  return resourceManagerInstance;\n}\n","/**\n * InventoryManager - Manages player inventory\n *\n * Handles item storage, stacking, and quick slots.\n */\n\nimport { getEventBus } from '@core/EventBus';\nimport { getResourceManager, ResourceDefinition } from './ResourceManager';\n\n// ============================================================================\n// Inventory Types\n// ============================================================================\n\nexport interface InventorySlot {\n  resourceId: string | null;\n  quantity: number;\n  durability?: number;  // For tools/weapons\n}\n\nexport interface InventoryConfig {\n  size: number;           // Total inventory slots\n  quickSlots: number;     // Number of quick access slots\n}\n\nconst DEFAULT_CONFIG: InventoryConfig = {\n  size: 30,\n  quickSlots: 9,\n};\n\n// ============================================================================\n// InventoryManager Implementation\n// ============================================================================\n\nexport class InventoryManager {\n  private slots: InventorySlot[] = [];\n  private config: InventoryConfig;\n  private selectedQuickSlot: number = 0;\n\n  constructor(config: Partial<InventoryConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.initializeSlots();\n  }\n\n  /**\n   * Initialize empty slots\n   */\n  private initializeSlots(): void {\n    this.slots = [];\n    for (let i = 0; i < this.config.size; i++) {\n      this.slots.push({ resourceId: null, quantity: 0 });\n    }\n  }\n\n  /**\n   * Get all slots\n   */\n  public getSlots(): readonly InventorySlot[] {\n    return this.slots;\n  }\n\n  /**\n   * Get a specific slot\n   */\n  public getSlot(index: number): InventorySlot | undefined {\n    return this.slots[index];\n  }\n\n  /**\n   * Get quick slots (first N slots)\n   */\n  public getQuickSlots(): readonly InventorySlot[] {\n    return this.slots.slice(0, this.config.quickSlots);\n  }\n\n  /**\n   * Get selected quick slot index\n   */\n  public getSelectedQuickSlot(): number {\n    return this.selectedQuickSlot;\n  }\n\n  /**\n   * Set selected quick slot\n   */\n  public setSelectedQuickSlot(index: number): void {\n    if (index >= 0 && index < this.config.quickSlots) {\n      this.selectedQuickSlot = index;\n    }\n  }\n\n  /**\n   * Get item in hand (selected quick slot)\n   */\n  public getItemInHand(): InventorySlot {\n    return this.slots[this.selectedQuickSlot];\n  }\n\n  /**\n   * Add an item to inventory\n   * Returns the amount that couldn't be added (0 if all added)\n   */\n  public addItem(resourceId: string, quantity: number = 1, durability?: number): number {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n    if (!resource) {\n      console.warn(`[InventoryManager] Unknown resource: ${resourceId}`);\n      return quantity;\n    }\n\n    let remaining = quantity;\n    const stackSize = resource.stackSize;\n\n    // First, try to add to existing stacks\n    if (stackSize > 1) {\n      for (const slot of this.slots) {\n        if (remaining <= 0) break;\n        if (slot.resourceId === resourceId && slot.quantity < stackSize) {\n          const canAdd = Math.min(remaining, stackSize - slot.quantity);\n          slot.quantity += canAdd;\n          remaining -= canAdd;\n        }\n      }\n    }\n\n    // Then, add to empty slots\n    for (const slot of this.slots) {\n      if (remaining <= 0) break;\n      if (slot.resourceId === null) {\n        const canAdd = Math.min(remaining, stackSize);\n        slot.resourceId = resourceId;\n        slot.quantity = canAdd;\n        slot.durability = durability ?? resource.durability;\n        remaining -= canAdd;\n      }\n    }\n\n    // Emit event for what was added\n    if (remaining < quantity) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId,\n        delta: quantity - remaining,\n      });\n    }\n\n    return remaining;\n  }\n\n  /**\n   * Remove an item from inventory\n   * Returns the amount actually removed\n   */\n  public removeItem(resourceId: string, quantity: number = 1): number {\n    let remaining = quantity;\n\n    // Remove from slots in reverse order (preserves quick slots longer)\n    for (let i = this.slots.length - 1; i >= 0; i--) {\n      if (remaining <= 0) break;\n      const slot = this.slots[i];\n      if (slot.resourceId === resourceId) {\n        const canRemove = Math.min(remaining, slot.quantity);\n        slot.quantity -= canRemove;\n        remaining -= canRemove;\n\n        if (slot.quantity <= 0) {\n          slot.resourceId = null;\n          slot.quantity = 0;\n          slot.durability = undefined;\n        }\n      }\n    }\n\n    const removed = quantity - remaining;\n\n    if (removed > 0) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId,\n        delta: -removed,\n      });\n    }\n\n    return removed;\n  }\n\n  /**\n   * Check if inventory has a certain amount of an item\n   */\n  public hasItem(resourceId: string, quantity: number = 1): boolean {\n    return this.getItemCount(resourceId) >= quantity;\n  }\n\n  /**\n   * Get total count of an item\n   */\n  public getItemCount(resourceId: string): number {\n    return this.slots\n      .filter(slot => slot.resourceId === resourceId)\n      .reduce((sum, slot) => sum + slot.quantity, 0);\n  }\n\n  /**\n   * Check if inventory has space for items\n   */\n  public hasSpace(resourceId: string, quantity: number = 1): boolean {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n    if (!resource) return false;\n\n    const stackSize = resource.stackSize;\n    let canFit = 0;\n\n    // Check existing stacks\n    if (stackSize > 1) {\n      for (const slot of this.slots) {\n        if (slot.resourceId === resourceId) {\n          canFit += stackSize - slot.quantity;\n        }\n      }\n    }\n\n    // Check empty slots\n    for (const slot of this.slots) {\n      if (slot.resourceId === null) {\n        canFit += stackSize;\n      }\n    }\n\n    return canFit >= quantity;\n  }\n\n  /**\n   * Get number of empty slots\n   */\n  public getEmptySlotCount(): number {\n    return this.slots.filter(slot => slot.resourceId === null).length;\n  }\n\n  /**\n   * Check if inventory is full\n   */\n  public isFull(): boolean {\n    return this.getEmptySlotCount() === 0;\n  }\n\n  /**\n   * Move item between slots\n   */\n  public moveItem(fromIndex: number, toIndex: number): boolean {\n    if (fromIndex < 0 || fromIndex >= this.slots.length) return false;\n    if (toIndex < 0 || toIndex >= this.slots.length) return false;\n    if (fromIndex === toIndex) return false;\n\n    const fromSlot = this.slots[fromIndex];\n    const toSlot = this.slots[toIndex];\n\n    // If target is empty, just move\n    if (toSlot.resourceId === null) {\n      toSlot.resourceId = fromSlot.resourceId;\n      toSlot.quantity = fromSlot.quantity;\n      toSlot.durability = fromSlot.durability;\n      fromSlot.resourceId = null;\n      fromSlot.quantity = 0;\n      fromSlot.durability = undefined;\n      return true;\n    }\n\n    // If same item type, try to stack\n    if (toSlot.resourceId === fromSlot.resourceId) {\n      const resourceManager = getResourceManager();\n      const resource = resourceManager.getResource(toSlot.resourceId!);\n      if (resource && resource.stackSize > 1) {\n        const canMove = Math.min(fromSlot.quantity, resource.stackSize - toSlot.quantity);\n        toSlot.quantity += canMove;\n        fromSlot.quantity -= canMove;\n        if (fromSlot.quantity <= 0) {\n          fromSlot.resourceId = null;\n          fromSlot.quantity = 0;\n          fromSlot.durability = undefined;\n        }\n        return true;\n      }\n    }\n\n    // Otherwise, swap\n    const temp = { ...fromSlot };\n    fromSlot.resourceId = toSlot.resourceId;\n    fromSlot.quantity = toSlot.quantity;\n    fromSlot.durability = toSlot.durability;\n    toSlot.resourceId = temp.resourceId;\n    toSlot.quantity = temp.quantity;\n    toSlot.durability = temp.durability;\n\n    return true;\n  }\n\n  /**\n   * Use durability on an item (for tools/weapons)\n   * Returns true if item broke\n   */\n  public useDurability(index: number, amount: number = 1): boolean {\n    const slot = this.slots[index];\n    if (!slot || slot.durability === undefined) return false;\n\n    slot.durability -= amount;\n    if (slot.durability <= 0) {\n      const resourceId = slot.resourceId;\n      slot.resourceId = null;\n      slot.quantity = 0;\n      slot.durability = undefined;\n\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId!,\n        delta: -1,\n      });\n\n      return true; // Item broke\n    }\n\n    return false;\n  }\n\n  /**\n   * Clear the inventory\n   */\n  public clear(): void {\n    this.initializeSlots();\n  }\n\n  /**\n   * Serialize for saving\n   */\n  public serialize(): Array<{ itemId: string; quantity: number; durability?: number }> {\n    const items: Array<{ itemId: string; quantity: number; durability?: number }> = [];\n\n    for (const slot of this.slots) {\n      if (slot.resourceId) {\n        items.push({\n          itemId: slot.resourceId,\n          quantity: slot.quantity,\n          durability: slot.durability,\n        });\n      }\n    }\n\n    return items;\n  }\n\n  /**\n   * Deserialize from save data\n   */\n  public deserialize(items: Array<{ itemId: string; quantity: number; durability?: number }>): void {\n    this.clear();\n    for (const item of items) {\n      this.addItem(item.itemId, item.quantity, item.durability);\n    }\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet inventoryManagerInstance: InventoryManager | null = null;\n\nexport function getInventoryManager(): InventoryManager {\n  if (!inventoryManagerInstance) {\n    inventoryManagerInstance = new InventoryManager();\n  }\n  return inventoryManagerInstance;\n}\n","/**\n * CraftingManager - Manages crafting recipes and crafting operations\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * Requires 20+ recipes functional\n */\n\nimport { getEventBus } from '@core/EventBus';\nimport { getInventoryManager, InventoryManager } from './InventoryManager';\n\n// ============================================================================\n// Crafting Types\n// ============================================================================\n\nexport enum CraftingStation {\n  Hand = 'hand',           // No station required\n  Workbench = 'workbench',\n  Furnace = 'furnace',\n  Anvil = 'anvil',\n  Alchemy = 'alchemy',\n  Loom = 'loom',\n}\n\nexport interface RecipeIngredient {\n  resourceId: string;\n  quantity: number;\n  consumed: boolean;  // If false, item is a tool/catalyst\n}\n\nexport interface RecipeOutput {\n  resourceId: string;\n  quantity: number;\n}\n\nexport interface Recipe {\n  id: string;\n  name: string;\n  description: string;\n  inputs: RecipeIngredient[];\n  outputs: RecipeOutput[];\n  craftTime: number;         // Seconds to craft\n  requiredStation: CraftingStation;\n  skillRequired?: string;    // Future: skill requirements\n  skillLevel?: number;\n}\n\n// ============================================================================\n// Default Recipes (20+ per spec requirement)\n// ============================================================================\n\nconst DEFAULT_RECIPES: Recipe[] = [\n  // ===== HAND CRAFTING (No station) =====\n  {\n    id: 'craft_wooden_plank',\n    name: 'Wooden Plank',\n    description: 'Process wood into planks',\n    inputs: [{ resourceId: 'wood', quantity: 1, consumed: true }],\n    outputs: [{ resourceId: 'wooden_plank', quantity: 4 }],\n    craftTime: 2,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_rope',\n    name: 'Rope',\n    description: 'Weave fibers into rope',\n    inputs: [{ resourceId: 'fiber', quantity: 5, consumed: true }],\n    outputs: [{ resourceId: 'rope', quantity: 1 }],\n    craftTime: 3,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_bandage',\n    name: 'Bandage',\n    description: 'Create a simple bandage',\n    inputs: [{ resourceId: 'cloth', quantity: 2, consumed: true }],\n    outputs: [{ resourceId: 'bandage', quantity: 1 }],\n    craftTime: 2,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_wooden_sword',\n    name: 'Wooden Sword',\n    description: 'Carve a basic wooden sword',\n    inputs: [\n      { resourceId: 'wood', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'wooden_sword', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_arrow',\n    name: 'Arrows',\n    description: 'Craft a bundle of arrows',\n    inputs: [\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'stone', quantity: 1, consumed: true },\n      { resourceId: 'fiber', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'arrow', quantity: 10 }],\n    craftTime: 4,\n    requiredStation: CraftingStation.Hand,\n  },\n\n  // ===== WORKBENCH RECIPES =====\n  {\n    id: 'craft_stone_pickaxe',\n    name: 'Stone Pickaxe',\n    description: 'Craft a stone mining tool',\n    inputs: [\n      { resourceId: 'wood', quantity: 2, consumed: true },\n      { resourceId: 'stone', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_pickaxe', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_axe',\n    name: 'Stone Axe',\n    description: 'Craft a stone woodcutting tool',\n    inputs: [\n      { resourceId: 'wood', quantity: 2, consumed: true },\n      { resourceId: 'stone', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_axe', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_sword',\n    name: 'Stone Sword',\n    description: 'Craft a stone blade',\n    inputs: [\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'stone', quantity: 4, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_sword', quantity: 1 }],\n    craftTime: 6,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_bow',\n    name: 'Wooden Bow',\n    description: 'Craft a hunting bow',\n    inputs: [\n      { resourceId: 'wood', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 5, consumed: true },\n    ],\n    outputs: [{ resourceId: 'bow', quantity: 1 }],\n    craftTime: 8,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_brick',\n    name: 'Stone Bricks',\n    description: 'Cut stone into building bricks',\n    inputs: [{ resourceId: 'stone', quantity: 2, consumed: true }],\n    outputs: [{ resourceId: 'stone_brick', quantity: 4 }],\n    craftTime: 4,\n    requiredStation: CraftingStation.Workbench,\n  },\n\n  // ===== FURNACE RECIPES =====\n  {\n    id: 'smelt_iron',\n    name: 'Iron Ingot',\n    description: 'Smelt iron ore into an ingot',\n    inputs: [\n      { resourceId: 'iron_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_ingot', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'smelt_copper',\n    name: 'Copper Ingot',\n    description: 'Smelt copper ore into an ingot',\n    inputs: [\n      { resourceId: 'copper_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'copper_ingot', quantity: 1 }],\n    craftTime: 8,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'smelt_gold',\n    name: 'Gold Ingot',\n    description: 'Smelt gold ore into an ingot',\n    inputs: [\n      { resourceId: 'gold_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'gold_ingot', quantity: 1 }],\n    craftTime: 12,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'cook_meat',\n    name: 'Cooked Meat',\n    description: 'Cook raw meat',\n    inputs: [\n      { resourceId: 'raw_meat', quantity: 1, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'cooked_meat', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'bake_bread',\n    name: 'Bread',\n    description: 'Bake bread from fiber (wheat)',\n    inputs: [\n      { resourceId: 'fiber', quantity: 3, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'bread', quantity: 1 }],\n    craftTime: 6,\n    requiredStation: CraftingStation.Furnace,\n  },\n\n  // ===== ANVIL RECIPES =====\n  {\n    id: 'craft_iron_pickaxe',\n    name: 'Iron Pickaxe',\n    description: 'Forge an iron mining tool',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 3, consumed: true },\n      { resourceId: 'wood', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_pickaxe', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Anvil,\n  },\n  {\n    id: 'craft_iron_axe',\n    name: 'Iron Axe',\n    description: 'Forge an iron woodcutting tool',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 3, consumed: true },\n      { resourceId: 'wood', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_axe', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Anvil,\n  },\n  {\n    id: 'craft_iron_sword',\n    name: 'Iron Sword',\n    description: 'Forge an iron blade',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 4, consumed: true },\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'leather', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_sword', quantity: 1 }],\n    craftTime: 12,\n    requiredStation: CraftingStation.Anvil,\n  },\n\n  // ===== LOOM RECIPES =====\n  {\n    id: 'craft_cloth',\n    name: 'Cloth',\n    description: 'Weave fibers into cloth',\n    inputs: [{ resourceId: 'fiber', quantity: 4, consumed: true }],\n    outputs: [{ resourceId: 'cloth', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Loom,\n  },\n\n  // ===== ALCHEMY RECIPES =====\n  {\n    id: 'brew_health_potion',\n    name: 'Health Potion',\n    description: 'Brew a healing potion',\n    inputs: [\n      { resourceId: 'mushroom', quantity: 3, consumed: true },\n      { resourceId: 'berries', quantity: 2, consumed: true },\n      { resourceId: 'monster_essence', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'health_potion', quantity: 1 }],\n    craftTime: 15,\n    requiredStation: CraftingStation.Alchemy,\n  },\n];\n\n// ============================================================================\n// CraftingManager Implementation\n// ============================================================================\n\nexport class CraftingManager {\n  private recipes: Map<string, Recipe> = new Map();\n  private activeCrafts: Map<string, { recipe: Recipe; startTime: number; stationId: string }> = new Map();\n\n  constructor() {\n    // Register default recipes\n    for (const recipe of DEFAULT_RECIPES) {\n      this.registerRecipe(recipe);\n    }\n  }\n\n  /**\n   * Register a new recipe\n   */\n  public registerRecipe(recipe: Recipe): void {\n    this.recipes.set(recipe.id, recipe);\n  }\n\n  /**\n   * Get a recipe by ID\n   */\n  public getRecipe(id: string): Recipe | undefined {\n    return this.recipes.get(id);\n  }\n\n  /**\n   * Get all recipes\n   */\n  public getAllRecipes(): Recipe[] {\n    return Array.from(this.recipes.values());\n  }\n\n  /**\n   * Get recipes for a specific station\n   */\n  public getRecipesForStation(station: CraftingStation): Recipe[] {\n    return this.getAllRecipes().filter(r => r.requiredStation === station);\n  }\n\n  /**\n   * Get recipe count (should be 20+ per spec)\n   */\n  public getRecipeCount(): number {\n    return this.recipes.size;\n  }\n\n  /**\n   * Check if player can craft a recipe\n   */\n  public canCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    availableStation: CraftingStation = CraftingStation.Hand\n  ): boolean {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return false;\n\n    // Check station requirement\n    if (recipe.requiredStation !== CraftingStation.Hand &&\n        recipe.requiredStation !== availableStation) {\n      return false;\n    }\n\n    // Check ingredients\n    for (const input of recipe.inputs) {\n      if (!inventory.hasItem(input.resourceId, input.quantity)) {\n        return false;\n      }\n    }\n\n    // Check output space\n    for (const output of recipe.outputs) {\n      if (!inventory.hasSpace(output.resourceId, output.quantity)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Get missing ingredients for a recipe\n   */\n  public getMissingIngredients(\n    recipeId: string,\n    inventory: InventoryManager\n  ): Array<{ resourceId: string; have: number; need: number }> {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return [];\n\n    const missing: Array<{ resourceId: string; have: number; need: number }> = [];\n\n    for (const input of recipe.inputs) {\n      const have = inventory.getItemCount(input.resourceId);\n      if (have < input.quantity) {\n        missing.push({\n          resourceId: input.resourceId,\n          have,\n          need: input.quantity,\n        });\n      }\n    }\n\n    return missing;\n  }\n\n  /**\n   * Start crafting a recipe (for timed crafting)\n   */\n  public startCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    stationId: string = 'hand'\n  ): string | null {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return null;\n\n    // Consume ingredients\n    for (const input of recipe.inputs) {\n      if (input.consumed) {\n        inventory.removeItem(input.resourceId, input.quantity);\n      }\n    }\n\n    const craftId = `${recipeId}_${Date.now()}`;\n    this.activeCrafts.set(craftId, {\n      recipe,\n      startTime: Date.now(),\n      stationId,\n    });\n\n    return craftId;\n  }\n\n  /**\n   * Check if a craft is complete\n   */\n  public isCraftComplete(craftId: string): boolean {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft) return false;\n\n    const elapsed = (Date.now() - craft.startTime) / 1000;\n    return elapsed >= craft.recipe.craftTime;\n  }\n\n  /**\n   * Get craft progress (0-1)\n   */\n  public getCraftProgress(craftId: string): number {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft) return 0;\n\n    const elapsed = (Date.now() - craft.startTime) / 1000;\n    return Math.min(1, elapsed / craft.recipe.craftTime);\n  }\n\n  /**\n   * Complete a craft and receive outputs\n   */\n  public completeCraft(craftId: string, inventory: InventoryManager): boolean {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft || !this.isCraftComplete(craftId)) return false;\n\n    // Give outputs\n    for (const output of craft.recipe.outputs) {\n      inventory.addItem(output.resourceId, output.quantity);\n    }\n\n    this.activeCrafts.delete(craftId);\n    return true;\n  }\n\n  /**\n   * Cancel an active craft (ingredients are lost)\n   */\n  public cancelCraft(craftId: string): boolean {\n    return this.activeCrafts.delete(craftId);\n  }\n\n  /**\n   * Instant craft (for simple recipes or testing)\n   */\n  public instantCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    station: CraftingStation = CraftingStation.Hand\n  ): boolean {\n    if (!this.canCraft(recipeId, inventory, station)) return false;\n\n    const recipe = this.getRecipe(recipeId)!;\n\n    // Consume ingredients\n    for (const input of recipe.inputs) {\n      if (input.consumed) {\n        inventory.removeItem(input.resourceId, input.quantity);\n      }\n    }\n\n    // Give outputs\n    for (const output of recipe.outputs) {\n      inventory.addItem(output.resourceId, output.quantity);\n    }\n\n    return true;\n  }\n\n  /**\n   * Get all craftable recipes with current inventory\n   */\n  public getCraftableRecipes(\n    inventory: InventoryManager,\n    station: CraftingStation = CraftingStation.Hand\n  ): Recipe[] {\n    return this.getAllRecipes().filter(recipe =>\n      this.canCraft(recipe.id, inventory, station)\n    );\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet craftingManagerInstance: CraftingManager | null = null;\n\nexport function getCraftingManager(): CraftingManager {\n  if (!craftingManagerInstance) {\n    craftingManagerInstance = new CraftingManager();\n  }\n  return craftingManagerInstance;\n}\n","/**\n * SurvivalManager - Manages player survival mechanics\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 Survival Mechanics:\n * - Health: Via damage, 0 = death\n * - Hunger: 2.0/hour decay, 20 critical = health drain, speed reduction\n * - Stamina: Via actions, 0 = cannot sprint, reduced actions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { GameTime } from '@core/types';\nimport { getResourceManager } from './ResourceManager';\n\n// ============================================================================\n// Survival Configuration\n// ============================================================================\n\nexport interface SurvivalConfig {\n  maxHealth: number;\n  maxHunger: number;\n  maxStamina: number;\n\n  hungerDecayRate: number;     // Per game hour\n  staminaRegenRate: number;    // Per second when resting\n  hungerCritical: number;      // Below this, negative effects apply\n  staminaCritical: number;     // Below this, cannot sprint\n\n  hungerHealthDrain: number;   // Health lost per second when critical\n  hungerSpeedPenalty: number;  // Speed multiplier when hungry (0.5 = 50%)\n\n  sprintStaminaCost: number;   // Stamina per second while sprinting\n  attackStaminaCost: number;   // Stamina per attack\n  mineStaminaCost: number;     // Stamina per mining action\n}\n\nconst DEFAULT_CONFIG: SurvivalConfig = {\n  maxHealth: 100,\n  maxHunger: 100,\n  maxStamina: 100,\n\n  hungerDecayRate: 2.0,\n  staminaRegenRate: 10,\n  hungerCritical: 20,\n  staminaCritical: 10,\n\n  hungerHealthDrain: 1,\n  hungerSpeedPenalty: 0.5,\n\n  sprintStaminaCost: 15,\n  attackStaminaCost: 10,\n  mineStaminaCost: 5,\n};\n\n// ============================================================================\n// Player Stats\n// ============================================================================\n\nexport interface PlayerStats {\n  health: number;\n  maxHealth: number;\n  hunger: number;\n  maxHunger: number;\n  stamina: number;\n  maxStamina: number;\n}\n\n// ============================================================================\n// SurvivalManager Implementation\n// ============================================================================\n\nexport class SurvivalManager implements GameSystem {\n  public readonly name = 'SurvivalManager';\n\n  private config: SurvivalConfig;\n  private health: number;\n  private hunger: number;\n  private stamina: number;\n  private isResting: boolean = false;\n  private isSprinting: boolean = false;\n  private isDead: boolean = false;\n\n  // Accumulator for hunger decay (tracks fractional game hours)\n  private hungerAccumulator: number = 0;\n\n  constructor(config: Partial<SurvivalConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.health = this.config.maxHealth;\n    this.hunger = this.config.maxHunger;\n    this.stamina = this.config.maxStamina;\n  }\n\n  /**\n   * Initialize the survival manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for sprint state changes\n    eventBus.on('input:actionPressed', (event) => {\n      if (event.action === 'sprint') {\n        this.isSprinting = true;\n      }\n    });\n\n    eventBus.on('input:actionReleased', (event) => {\n      if (event.action === 'sprint') {\n        this.isSprinting = false;\n      }\n    });\n\n    console.log('[SurvivalManager] Initialized');\n  }\n\n  /**\n   * Update survival mechanics each frame\n   */\n  public update(deltaTime: number, gameTime: GameTime): void {\n    if (this.isDead) return;\n\n    // Update hunger based on game time\n    this.updateHunger(deltaTime, gameTime);\n\n    // Update stamina\n    this.updateStamina(deltaTime);\n\n    // Apply critical hunger effects\n    this.applyCriticalEffects(deltaTime);\n  }\n\n  /**\n   * Update hunger decay\n   */\n  private updateHunger(deltaTime: number, gameTime: GameTime): void {\n    // Convert real time to game hours (assuming 1 game hour = 1 minute real time)\n    const gameHoursPerSecond = 1 / 60; // 1 hour per 60 real seconds\n    this.hungerAccumulator += deltaTime * gameHoursPerSecond * this.config.hungerDecayRate;\n\n    // Apply accumulated hunger decay\n    if (this.hungerAccumulator >= 1) {\n      const decay = Math.floor(this.hungerAccumulator);\n      this.hunger = Math.max(0, this.hunger - decay);\n      this.hungerAccumulator -= decay;\n    }\n  }\n\n  /**\n   * Update stamina (drain if sprinting, regen if resting)\n   */\n  private updateStamina(deltaTime: number): void {\n    if (this.isSprinting && this.stamina > 0) {\n      this.stamina = Math.max(0, this.stamina - this.config.sprintStaminaCost * deltaTime);\n    } else if (!this.isSprinting && this.stamina < this.config.maxStamina) {\n      // Regen rate is reduced if hungry\n      const regenMultiplier = this.isHungryCritical() ? 0.5 : 1.0;\n      this.stamina = Math.min(\n        this.config.maxStamina,\n        this.stamina + this.config.staminaRegenRate * deltaTime * regenMultiplier\n      );\n    }\n  }\n\n  /**\n   * Apply effects when survival stats are critical\n   */\n  private applyCriticalEffects(deltaTime: number): void {\n    // Health drain from starvation\n    if (this.isHungryCritical()) {\n      this.takeDamage(this.config.hungerHealthDrain * deltaTime, 'starvation');\n    }\n  }\n\n  // ==========================================================================\n  // Public API - Health\n  // ==========================================================================\n\n  /**\n   * Get current health\n   */\n  public getHealth(): number {\n    return this.health;\n  }\n\n  /**\n   * Get max health\n   */\n  public getMaxHealth(): number {\n    return this.config.maxHealth;\n  }\n\n  /**\n   * Take damage\n   */\n  public takeDamage(amount: number, source: string = 'unknown'): void {\n    if (this.isDead) return;\n\n    this.health = Math.max(0, this.health - amount);\n\n    const eventBus = getEventBus();\n    eventBus.emit('entity:damaged', {\n      entityId: 'player',\n      amount,\n      sourceId: source,\n    });\n\n    if (this.health <= 0) {\n      this.die();\n    }\n  }\n\n  /**\n   * Heal the player\n   */\n  public heal(amount: number): void {\n    if (this.isDead) return;\n\n    const oldHealth = this.health;\n    this.health = Math.min(this.config.maxHealth, this.health + amount);\n    const healed = this.health - oldHealth;\n\n    if (healed > 0) {\n      const eventBus = getEventBus();\n      eventBus.emit('entity:healed', {\n        entityId: 'player',\n        amount: healed,\n      });\n    }\n  }\n\n  /**\n   * Check if player is dead\n   */\n  public isPlayerDead(): boolean {\n    return this.isDead;\n  }\n\n  /**\n   * Handle player death\n   */\n  private die(): void {\n    this.isDead = true;\n    const eventBus = getEventBus();\n    eventBus.emit('entity:died', {\n      entityId: 'player',\n      killerId: null,\n    });\n  }\n\n  /**\n   * Respawn player (reset stats)\n   */\n  public respawn(): void {\n    this.health = this.config.maxHealth;\n    this.hunger = this.config.maxHunger;\n    this.stamina = this.config.maxStamina;\n    this.isDead = false;\n    this.hungerAccumulator = 0;\n  }\n\n  // ==========================================================================\n  // Public API - Hunger\n  // ==========================================================================\n\n  /**\n   * Get current hunger\n   */\n  public getHunger(): number {\n    return this.hunger;\n  }\n\n  /**\n   * Get max hunger\n   */\n  public getMaxHunger(): number {\n    return this.config.maxHunger;\n  }\n\n  /**\n   * Check if hunger is critical\n   */\n  public isHungryCritical(): boolean {\n    return this.hunger <= this.config.hungerCritical;\n  }\n\n  /**\n   * Restore hunger (eating)\n   */\n  public restoreHunger(amount: number): void {\n    this.hunger = Math.min(this.config.maxHunger, this.hunger + amount);\n  }\n\n  /**\n   * Get speed multiplier based on hunger\n   */\n  public getSpeedMultiplier(): number {\n    return this.isHungryCritical() ? this.config.hungerSpeedPenalty : 1.0;\n  }\n\n  // ==========================================================================\n  // Public API - Stamina\n  // ==========================================================================\n\n  /**\n   * Get current stamina\n   */\n  public getStamina(): number {\n    return this.stamina;\n  }\n\n  /**\n   * Get max stamina\n   */\n  public getMaxStamina(): number {\n    return this.config.maxStamina;\n  }\n\n  /**\n   * Check if stamina is critical\n   */\n  public isStaminaCritical(): boolean {\n    return this.stamina <= this.config.staminaCritical;\n  }\n\n  /**\n   * Check if player can sprint\n   */\n  public canSprint(): boolean {\n    return this.stamina > this.config.staminaCritical;\n  }\n\n  /**\n   * Use stamina for an action\n   * Returns true if action was possible\n   */\n  public useStamina(amount: number): boolean {\n    if (this.stamina < amount) return false;\n    this.stamina -= amount;\n    return true;\n  }\n\n  /**\n   * Use stamina for attack\n   */\n  public useAttackStamina(): boolean {\n    return this.useStamina(this.config.attackStaminaCost);\n  }\n\n  /**\n   * Use stamina for mining\n   */\n  public useMineStamina(): boolean {\n    return this.useStamina(this.config.mineStaminaCost);\n  }\n\n  // ==========================================================================\n  // Public API - Consumables\n  // ==========================================================================\n\n  /**\n   * Consume a food/consumable item\n   * Returns true if consumed successfully\n   */\n  public consume(resourceId: string): boolean {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n\n    if (!resource) return false;\n    if (!resourceManager.isConsumable(resourceId)) return false;\n\n    // Apply effects\n    if (resource.healAmount) {\n      if (resource.healAmount > 0) {\n        this.heal(resource.healAmount);\n      } else {\n        this.takeDamage(-resource.healAmount, 'food_poisoning');\n      }\n    }\n\n    if (resource.hungerRestore) {\n      this.restoreHunger(resource.hungerRestore);\n    }\n\n    return true;\n  }\n\n  // ==========================================================================\n  // Stats Summary\n  // ==========================================================================\n\n  /**\n   * Get all player stats\n   */\n  public getStats(): PlayerStats {\n    return {\n      health: this.health,\n      maxHealth: this.config.maxHealth,\n      hunger: this.hunger,\n      maxHunger: this.config.maxHunger,\n      stamina: this.stamina,\n      maxStamina: this.config.maxStamina,\n    };\n  }\n\n  /**\n   * Set stats (for loading saves)\n   */\n  public setStats(stats: Partial<PlayerStats>): void {\n    if (stats.health !== undefined) this.health = stats.health;\n    if (stats.hunger !== undefined) this.hunger = stats.hunger;\n    if (stats.stamina !== undefined) this.stamina = stats.stamina;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[SurvivalManager] Destroyed');\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet survivalManagerInstance: SurvivalManager | null = null;\n\nexport function getSurvivalManager(): SurvivalManager {\n  if (!survivalManagerInstance) {\n    survivalManagerInstance = new SurvivalManager();\n  }\n  return survivalManagerInstance;\n}\n","/**\n * UIManager - Manages game UI panels and HUD\n *\n * Handles panel visibility, modal stacking, and tooltips.\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport { PanelType } from '@core/types';\nimport type { UIState, Vector2, GameTime } from '@core/types';\n\n// ============================================================================\n// UIManager Implementation\n// ============================================================================\n\nexport class UIManager implements GameSystem {\n  public readonly name = 'UIManager';\n\n  private state: UIState = {\n    activePanels: new Set([PanelType.HUD]),\n    modalStack: [],\n    tooltipContent: null,\n    tooltipPosition: null,\n  };\n\n  // Panel render callbacks\n  private panelRenderers: Map<PanelType, () => void> = new Map();\n\n  // UI element update callbacks (for external rendering systems)\n  private updateCallbacks: Set<(state: UIState) => void> = new Set();\n\n  /**\n   * Initialize the UI manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for panel events from other systems\n    eventBus.on('ui:tooltipShow', (event) => {\n      this.showTooltip(event.content, event.position);\n    });\n\n    eventBus.on('ui:tooltipHide', () => {\n      this.hideTooltip();\n    });\n\n    console.log('[UIManager] Initialized');\n  }\n\n  /**\n   * Update - notify render callbacks\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    // Notify all update callbacks\n    for (const callback of this.updateCallbacks) {\n      callback(this.state);\n    }\n  }\n\n  // ============================================================================\n  // Panel Management\n  // ============================================================================\n\n  /**\n   * Open a panel\n   */\n  public openPanel(panel: PanelType, modal = false): void {\n    if (this.isPanelOpen(panel)) {\n      return;\n    }\n\n    this.state.activePanels.add(panel);\n\n    if (modal) {\n      this.state.modalStack.push(panel);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelOpened', { panel });\n  }\n\n  /**\n   * Close a panel\n   */\n  public closePanel(panel: PanelType): void {\n    if (!this.isPanelOpen(panel)) {\n      return;\n    }\n\n    this.state.activePanels.delete(panel);\n\n    // Remove from modal stack if present\n    const modalIndex = this.state.modalStack.indexOf(panel);\n    if (modalIndex !== -1) {\n      this.state.modalStack.splice(modalIndex, 1);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelClosed', { panel });\n  }\n\n  /**\n   * Toggle a panel\n   */\n  public togglePanel(panel: PanelType, modal = false): void {\n    if (this.isPanelOpen(panel)) {\n      this.closePanel(panel);\n    } else {\n      this.openPanel(panel, modal);\n    }\n  }\n\n  /**\n   * Check if a panel is open\n   */\n  public isPanelOpen(panel: PanelType): boolean {\n    return this.state.activePanels.has(panel);\n  }\n\n  /**\n   * Close the topmost modal\n   */\n  public closeTopModal(): boolean {\n    if (this.state.modalStack.length === 0) {\n      return false;\n    }\n\n    const topModal = this.state.modalStack.pop()!;\n    this.state.activePanels.delete(topModal);\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelClosed', { panel: topModal });\n\n    return true;\n  }\n\n  /**\n   * Close all modals\n   */\n  public closeAllModals(): void {\n    while (this.closeTopModal()) {\n      // Continue until all modals closed\n    }\n  }\n\n  /**\n   * Get the topmost modal panel\n   */\n  public getTopModal(): PanelType | null {\n    if (this.state.modalStack.length === 0) {\n      return null;\n    }\n    return this.state.modalStack[this.state.modalStack.length - 1];\n  }\n\n  /**\n   * Check if any modal is open\n   */\n  public hasOpenModal(): boolean {\n    return this.state.modalStack.length > 0;\n  }\n\n  // ============================================================================\n  // Tooltip Management\n  // ============================================================================\n\n  /**\n   * Show a tooltip\n   */\n  public showTooltip(content: string, position: Vector2): void {\n    this.state.tooltipContent = content;\n    this.state.tooltipPosition = { ...position };\n  }\n\n  /**\n   * Hide the tooltip\n   */\n  public hideTooltip(): void {\n    this.state.tooltipContent = null;\n    this.state.tooltipPosition = null;\n  }\n\n  /**\n   * Check if tooltip is visible\n   */\n  public isTooltipVisible(): boolean {\n    return this.state.tooltipContent !== null;\n  }\n\n  /**\n   * Get tooltip content\n   */\n  public getTooltipContent(): string | null {\n    return this.state.tooltipContent;\n  }\n\n  /**\n   * Get tooltip position\n   */\n  public getTooltipPosition(): Vector2 | null {\n    return this.state.tooltipPosition;\n  }\n\n  // ============================================================================\n  // Render Callback Management\n  // ============================================================================\n\n  /**\n   * Register a panel renderer\n   */\n  public registerPanelRenderer(panel: PanelType, renderer: () => void): void {\n    this.panelRenderers.set(panel, renderer);\n  }\n\n  /**\n   * Unregister a panel renderer\n   */\n  public unregisterPanelRenderer(panel: PanelType): void {\n    this.panelRenderers.delete(panel);\n  }\n\n  /**\n   * Register an update callback\n   */\n  public onUpdate(callback: (state: UIState) => void): () => void {\n    this.updateCallbacks.add(callback);\n    return () => this.updateCallbacks.delete(callback);\n  }\n\n  // ============================================================================\n  // State Access\n  // ============================================================================\n\n  /**\n   * Get all active panels\n   */\n  public getActivePanels(): ReadonlySet<PanelType> {\n    return this.state.activePanels;\n  }\n\n  /**\n   * Get the modal stack\n   */\n  public getModalStack(): readonly PanelType[] {\n    return this.state.modalStack;\n  }\n\n  /**\n   * Get the full UI state\n   */\n  public getState(): Readonly<UIState> {\n    return this.state;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.state.activePanels.clear();\n    this.state.modalStack = [];\n    this.panelRenderers.clear();\n    this.updateCallbacks.clear();\n    console.log('[UIManager] Destroyed');\n  }\n}\n","/**\n * 2D RPG Game - Main Entry Point\n *\n * Phase 0 Foundation Systems per 2D_GAME_IMPLEMENTATION_PLAN.md\n */\n\n// Core engine\nexport * from './core';\n\n// World systems\nexport * from './world';\n\n// Entities\nexport * from './entities';\n\n// Game systems\nexport * from './systems';\n\n// UI\nexport * from './ui';\n\n// ============================================================================\n// Game Initialization\n// ============================================================================\n\nimport { GameEngine, getGameEngine } from './core';\nimport { TilemapManager, TileRegistry, AutotileSystem, RegionManager } from './world';\nimport { PlayerController, CameraSystem } from './entities';\nimport { InputManager, SaveManager } from './systems';\nimport { UIManager } from './ui';\n\n/**\n * Initialize and start the game\n */\nexport async function initializeGame(): Promise<GameEngine> {\n  const engine = getGameEngine();\n\n  // Register core systems in order\n  const inputManager = new InputManager();\n  const tilemapManager = new TilemapManager();\n  const autotileSystem = new AutotileSystem();\n  const regionManager = new RegionManager();\n  const playerController = new PlayerController();\n  const cameraSystem = new CameraSystem();\n  const saveManager = new SaveManager();\n  const uiManager = new UIManager();\n\n  // Connect autotile system to tilemap\n  autotileSystem.setTilemapManager(tilemapManager);\n\n  // Connect player to collision check\n  playerController.setWalkableCheck((x, y) => tilemapManager.isWalkable(x, y));\n\n  // Connect input to camera\n  inputManager.setScreenToWorldConverter((screenX, screenY) => {\n    // Placeholder - would use actual screen dimensions\n    return cameraSystem.screenToWorld(screenX, screenY, 800, 600);\n  });\n\n  // Register systems in update order\n  engine.registerSystem(inputManager, 0);\n  engine.registerSystem(tilemapManager, 1);\n  engine.registerSystem(autotileSystem, 2);\n  engine.registerSystem(regionManager, 3);\n  engine.registerSystem(playerController, 4);\n  engine.registerSystem(cameraSystem, 5);\n  engine.registerSystem(saveManager, 6);\n  engine.registerSystem(uiManager, 7);\n\n  // Initialize all systems\n  await engine.initialize();\n\n  return engine;\n}\n\n/**\n * Quick start for development\n */\nexport async function quickStart(): Promise<void> {\n  console.log('Starting 2D RPG Game...');\n\n  const engine = await initializeGame();\n\n  // Set up a basic world for testing\n  const tilemapManager = engine.getSystem<TilemapManager>('TilemapManager');\n  const playerController = engine.getSystem<PlayerController>('PlayerController');\n  const cameraSystem = engine.getSystem<CameraSystem>('CameraSystem');\n\n  if (tilemapManager) {\n    // Create a simple starting area\n    for (let x = -10; x <= 10; x++) {\n      for (let y = -10; y <= 10; y++) {\n        tilemapManager.setTile(x, y, 1, 'grass'); // Ground layer\n      }\n    }\n\n    // Add some trees\n    tilemapManager.setTile(5, 5, 2, 'tree');\n    tilemapManager.setTile(-3, 2, 2, 'tree');\n    tilemapManager.setTile(7, -4, 2, 'tree');\n\n    // Add some rocks\n    tilemapManager.setTile(-5, -5, 2, 'rock');\n    tilemapManager.setTile(3, -7, 2, 'rock');\n  }\n\n  if (playerController) {\n    playerController.setPosition(0, 0);\n  }\n\n  if (cameraSystem) {\n    cameraSystem.snapTo(0, 0);\n  }\n\n  // Start the game loop\n  engine.start();\n\n  console.log('Game started! Use WASD to move.');\n}\n"],"names":["Direction","EntityType","TileLayer","InputAction","GamepadButton","GamepadAxis","PanelType","EventBus","event","handler","priority","payload","subscribers","sortedSubscribers","b","toRemove","subscription","error","sub","index","queued","once","subs","getEventBus","DEFAULT_CONFIG","GameEngine","config","system","order","name","n","currentTime","deltaTime","secondsPerGameHour","hoursElapsed","previousHour","currentHour","fixedDeltaTime","getGameEngine","createTileType","id","layer","options","TileRegistry","tile","group","getTileRegistry","MAX_LAYER","positionKey","x","y","TilemapManager","_deltaTime","_gameTime","typeId","variant","key","oldTypeId","tileType","ground","bounds","tiles","l","count","data","tileData","eventBus","change","Neighbor4","Neighbor8","VARIANT_MAP_4BIT","VARIANT_MAP_8BIT","maskIrrelevantCorners","bitmask","masked","calculate8BitVariant","maskedBitmask","AutotileSystem","manager","position","autotileGroup","tileRegistry","matchesGroup","nx","ny","neighbor","bitmask4","bitmask8","width","height","tx","ty","RegionManager","currentRegion","worldX","worldY","regionX","regionY","region","playerRegion","loadDistance","unloadDistance","shouldBeLoaded","dx","dy","regions","regionCoords","localX","localY","DEFAULT_PERLIN_CONFIG","DEFAULT_SIMPLEX_CONFIG","createPermutationTable","seed","perm","p","i","j","GRAD3","NoiseGenerator","X","Y","xf","yf","u","v","aa","ab","ba","bb","gradAA","gradBA","gradAB","gradBB","x1","x2","octaves","scale","persistence","lacunarity","total","amplitude","frequency","maxValue","F2","G2","s","t","X0","Y0","x0","y0","i1","j1","y1","y2","ii","jj","gi0","gi1","gi2","n0","n1","n2","t0","t1","t2","sx","sy","cellX","cellY","minDist","neighborX","neighborY","hash","px","py","distX","distY","dist","closestHash","a","h","g","NOISE_CONFIGS","BiomeType","BIOME_DEFINITIONS","DEFAULT_THRESHOLDS","BiomeManager","thresholds","moisture","temperature","biome","random","def","biomeManagerInstance","getBiomeManager","WorldGenerator","startTime","biomeDistribution","regionSize","worldStartX","worldStartY","generatedTiles","generationTimeMs","biomeDef","decorationRandom","decoration","resourceRandom","resource","temperatureLatitudeScale","baseTemp","latitudeEffect","altitudeEffect","spawnAreaSize","radius","angle","sampleSize","biomeCounts","totalTime","samples","start","biomeCount","worldGeneratorInstance","getWorldGenerator","resetWorldGenerator","PlayerState","PlayerController","fn","acceleration","deceleration","walkSpeed","runSpeed","inputX","inputY","inputLength","maxSpeed","targetVelX","targetVelY","newX","newY","canMoveX","canMoveY","oldPosition","tileX","tileY","speed","targetX","targetY","current","target","rate","state","CameraSystem","followSpeed","deadzone","distance","moveAmount","ratio","zoomSpeed","diff","halfWidth","halfHeight","zoom","intensity","pos","screenX","screenY","screenWidth","screenHeight","viewWidth","viewHeight","margin","SAVE_VERSION","STORAGE_PREFIX","MAX_SAVE_SLOTS","SaveManager","provider","consumer","slots","slot","exists","info","autosaveKey","autosaveExists","autosaveInfo","saveData","json","message","migratedData","intervalSeconds","slotName","DEFAULT_BINDINGS","GAMEPAD_CONFIG","InputManager","bindings","action","oldKey","newKey","binding","actions","button","gamepads","gamepad","isPressed","wasPressed","leftX","leftY","oldLeftX","oldLeftY","rightX","rightY","oldRightX","oldRightY","ResourceCategory","DEFAULT_RESOURCES","ResourceManager","category","r","resourceManagerInstance","getResourceManager","InventoryManager","resourceId","quantity","durability","remaining","stackSize","canAdd","canRemove","removed","sum","canFit","fromIndex","toIndex","fromSlot","toSlot","canMove","temp","amount","items","item","inventoryManagerInstance","getInventoryManager","CraftingStation","DEFAULT_RECIPES","CraftingManager","recipe","station","recipeId","inventory","availableStation","input","output","missing","have","stationId","craftId","craft","elapsed","craftingManagerInstance","getCraftingManager","SurvivalManager","gameTime","gameHoursPerSecond","decay","regenMultiplier","source","oldHealth","healed","resourceManager","stats","survivalManagerInstance","getSurvivalManager","UIManager","callback","panel","modal","modalIndex","topModal","content","renderer","initializeGame","engine","inputManager","tilemapManager","autotileSystem","regionManager","playerController","cameraSystem","saveManager","uiManager","quickStart"],"mappings":"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"}