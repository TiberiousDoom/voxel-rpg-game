{"version":3,"file":"voxel-rpg.umd.js","sources":["../src/core/types.ts","../src/core/EventBus.ts","../src/core/GameEngine.ts","../src/world/TileRegistry.ts","../src/world/TilemapManager.ts","../src/world/AutotileSystem.ts","../src/world/RegionManager.ts","../src/world/NoiseGenerator.ts","../src/world/BiomeManager.ts","../src/world/WorldGenerator.ts","../src/entities/PlayerController.ts","../src/entities/CameraSystem.ts","../src/systems/SaveManager.ts","../src/systems/InputManager.ts","../src/systems/ResourceManager.ts","../src/systems/InventoryManager.ts","../src/systems/CraftingManager.ts","../src/systems/SurvivalManager.ts","../src/ui/UIManager.ts","../src/index.ts"],"sourcesContent":["/**\n * Core type definitions for the 2D RPG game engine\n */\n\n// ============================================================================\n// Vector Types\n// ============================================================================\n\nexport interface Vector2 {\n  x: number;\n  y: number;\n}\n\nexport interface Vector2Int {\n  x: number;\n  y: number;\n}\n\nexport interface Bounds {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n// ============================================================================\n// Direction & Facing\n// ============================================================================\n\nexport enum Direction {\n  North = 'N',\n  South = 'S',\n  East = 'E',\n  West = 'W',\n  NorthEast = 'NE',\n  NorthWest = 'NW',\n  SouthEast = 'SE',\n  SouthWest = 'SW',\n}\n\n// ============================================================================\n// Entity Types\n// ============================================================================\n\nexport enum EntityType {\n  Player = 'player',\n  NPC = 'npc',\n  Monster = 'monster',\n  Item = 'item',\n  Projectile = 'projectile',\n}\n\n// ============================================================================\n// Tile Types\n// Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard\n// ============================================================================\n\nexport enum TileLayer {\n  Background = 0, // Decorative, no collision\n  Ground = 1,     // Terrain, floors\n  Objects = 2,    // Furniture, resources, items\n  Walls = 3,      // Structures, barriers\n  Foreground = 4, // Visual overlays, roofs\n}\n\nexport interface ResourceDrop {\n  resourceId: string;\n  minAmount: number;\n  maxAmount: number;\n  chance: number; // 0-1\n}\n\nexport interface TileType {\n  id: string;\n  name: string;\n  layer: TileLayer;\n  walkable: boolean;\n  hardness: number; // Mining time multiplier (0 = instant, -1 = unbreakable)\n  transparent: boolean;\n  drops: ResourceDrop[];\n  autotileGroup: string | null;\n  buildRequirements: { resourceId: string; amount: number }[];\n}\n\nexport interface Tile {\n  typeId: string;\n  layer: TileLayer;\n  position: Vector2Int;\n  variant: number; // Autotile variant index\n  metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Component System (ECS-lite)\n// ============================================================================\n\nexport interface Component {\n  readonly type: string;\n}\n\nexport interface Entity {\n  id: string;\n  type: EntityType;\n  position: Vector2;\n  velocity: Vector2;\n  facing: Direction;\n  components: Map<string, Component>;\n  active: boolean;\n}\n\n// ============================================================================\n// Game State\n// ============================================================================\n\nexport interface GameTime {\n  totalSeconds: number;\n  deltaTime: number;\n  gameHour: number; // 0-24\n  gameDay: number;\n  isPaused: boolean;\n}\n\nexport interface GameConfig {\n  tileSize: number;\n  regionSize: number; // Tiles per region side\n  loadDistance: number; // Regions to load around player\n  unloadDistance: number; // Regions to unload\n  dayLengthSeconds: number; // Real seconds per game day\n}\n\n// ============================================================================\n// Save Data\n// ============================================================================\n\nexport interface SaveMetadata {\n  version: string;\n  timestamp: number;\n  playtimeSeconds: number;\n  slotName: string;\n}\n\nexport interface SaveData {\n  metadata: SaveMetadata;\n  world: {\n    seed: number;\n    modifiedTiles: Array<{\n      position: Vector2Int;\n      layer: TileLayer;\n      typeId: string;\n    }>;\n  };\n  player: {\n    position: Vector2;\n    health: number;\n    maxHealth: number;\n    inventory: Array<{ itemId: string; quantity: number }>;\n  };\n  gameTime: {\n    totalSeconds: number;\n    gameDay: number;\n  };\n}\n\n// ============================================================================\n// Input Types\n// ============================================================================\n\nexport enum InputAction {\n  MoveUp = 'moveUp',\n  MoveDown = 'moveDown',\n  MoveLeft = 'moveLeft',\n  MoveRight = 'moveRight',\n  Sprint = 'sprint',\n  Interact = 'interact',\n  Attack = 'attack',\n  Secondary = 'secondary',\n  Cancel = 'cancel',\n  Inventory = 'inventory',\n  BuildMenu = 'buildMenu',\n  Pause = 'pause',\n  ZoomIn = 'zoomIn',\n  ZoomOut = 'zoomOut',\n  QuickSlot1 = 'quickSlot1',\n  QuickSlot2 = 'quickSlot2',\n  QuickSlot3 = 'quickSlot3',\n  QuickSlot4 = 'quickSlot4',\n  QuickSlot5 = 'quickSlot5',\n  QuickSlot6 = 'quickSlot6',\n  QuickSlot7 = 'quickSlot7',\n  QuickSlot8 = 'quickSlot8',\n  QuickSlot9 = 'quickSlot9',\n}\n\nexport interface InputBinding {\n  action: InputAction;\n  keys: string[];\n  mouseButtons?: number[];\n  gamepadButtons?: number[];  // Standard Gamepad API button indices\n}\n\n// ============================================================================\n// Gamepad Types\n// Per 2D_GAME_IMPLEMENTATION_PLAN.md - Input System (Gamepad Support)\n// ============================================================================\n\n/**\n * Standard Gamepad button indices (W3C Gamepad API)\n * https://w3c.github.io/gamepad/#remapping\n */\nexport enum GamepadButton {\n  A = 0,            // Bottom button (A on Xbox, X on PlayStation)\n  B = 1,            // Right button (B on Xbox, Circle on PlayStation)\n  X = 2,            // Left button (X on Xbox, Square on PlayStation)\n  Y = 3,            // Top button (Y on Xbox, Triangle on PlayStation)\n  LeftBumper = 4,   // Left shoulder button (LB/L1)\n  RightBumper = 5,  // Right shoulder button (RB/R1)\n  LeftTrigger = 6,  // Left trigger (LT/L2)\n  RightTrigger = 7, // Right trigger (RT/R2)\n  Select = 8,       // Back/Select/Share\n  Start = 9,        // Start/Menu/Options\n  LeftStick = 10,   // Left stick pressed (L3)\n  RightStick = 11,  // Right stick pressed (R3)\n  DPadUp = 12,      // D-pad up\n  DPadDown = 13,    // D-pad down\n  DPadLeft = 14,    // D-pad left\n  DPadRight = 15,   // D-pad right\n  Home = 16,        // Home/Guide button\n}\n\n/**\n * Standard Gamepad axes\n */\nexport enum GamepadAxis {\n  LeftStickX = 0,   // Left stick horizontal (-1 left, 1 right)\n  LeftStickY = 1,   // Left stick vertical (-1 up, 1 down)\n  RightStickX = 2,  // Right stick horizontal\n  RightStickY = 3,  // Right stick vertical\n}\n\n// ============================================================================\n// UI Types\n// ============================================================================\n\nexport enum PanelType {\n  HUD = 'hud',\n  Inventory = 'inventory',\n  Build = 'build',\n  NPC = 'npc',\n  Settings = 'settings',\n  Pause = 'pause',\n}\n\nexport interface UIState {\n  activePanels: Set<PanelType>;\n  modalStack: PanelType[];\n  tooltipContent: string | null;\n  tooltipPosition: Vector2 | null;\n}\n","/**\n * EventBus - Central event system for decoupled communication between game systems\n *\n * Supports typed events with strong typing for event payloads.\n */\n\nimport type { Vector2, Vector2Int, TileLayer, Entity } from './types';\n\n// ============================================================================\n// Event Definitions\n// ============================================================================\n\nexport interface GameEvents {\n  // World Events\n  'world:tileChanged': { position: Vector2Int; layer: TileLayer; oldTypeId: string | null; newTypeId: string | null };\n  'world:regionLoaded': { regionId: string; position: Vector2Int };\n  'world:regionUnloaded': { regionId: string };\n\n  // Entity Events\n  'entity:spawned': { entity: Entity };\n  'entity:despawned': { entityId: string };\n  'entity:moved': { entityId: string; from: Vector2; to: Vector2 };\n  'entity:damaged': { entityId: string; amount: number; sourceId: string | null };\n  'entity:healed': { entityId: string; amount: number };\n  'entity:died': { entityId: string; killerId: string | null };\n\n  // Player Events\n  'player:moved': { position: Vector2 };\n  'player:interacted': { targetId: string | null; position: Vector2Int };\n  'player:inventoryChanged': { itemId: string; delta: number };\n\n  // Input Events\n  'input:actionPressed': { action: string };\n  'input:actionReleased': { action: string };\n  'input:mouseClicked': { button: number; position: Vector2; worldPosition: Vector2 };\n  'input:mouseMoved': { position: Vector2; worldPosition: Vector2 };\n  'input:gamepadConnected': { index: number; id: string };\n  'input:gamepadDisconnected': { index: number; id: string };\n  'input:leftStickMoved': { x: number; y: number };\n  'input:rightStickMoved': { x: number; y: number };\n\n  // Time Events\n  'time:hourChanged': { hour: number; day: number };\n  'time:dayChanged': { day: number };\n  'time:paused': Record<string, never>;\n  'time:resumed': Record<string, never>;\n\n  // UI Events\n  'ui:panelOpened': { panel: string };\n  'ui:panelClosed': { panel: string };\n  'ui:tooltipShow': { content: string; position: Vector2 };\n  'ui:tooltipHide': Record<string, never>;\n\n  // Save Events\n  'save:started': { slot: string };\n  'save:completed': { slot: string };\n  'save:failed': { slot: string; error: string };\n  'load:started': { slot: string };\n  'load:completed': { slot: string };\n  'load:failed': { slot: string; error: string };\n\n  // Game State Events\n  'game:started': Record<string, never>;\n  'game:paused': Record<string, never>;\n  'game:resumed': Record<string, never>;\n  'game:quit': Record<string, never>;\n}\n\n// ============================================================================\n// Event Handler Types\n// ============================================================================\n\ntype EventHandler<T> = (payload: T) => void;\ntype UnsubscribeFn = () => void;\n\ninterface EventSubscription<K extends keyof GameEvents> {\n  handler: EventHandler<GameEvents[K]>;\n  once: boolean;\n  priority: number;\n}\n\n// ============================================================================\n// EventBus Implementation\n// ============================================================================\n\nexport class EventBus {\n  private static instance: EventBus | null = null;\n  private subscribers: Map<keyof GameEvents, EventSubscription<keyof GameEvents>[]> = new Map();\n  private eventQueue: Array<{ event: keyof GameEvents; payload: GameEvents[keyof GameEvents] }> = [];\n  private isProcessing = false;\n\n  private constructor() {}\n\n  /**\n   * Get the singleton EventBus instance\n   */\n  public static getInstance(): EventBus {\n    if (!EventBus.instance) {\n      EventBus.instance = new EventBus();\n    }\n    return EventBus.instance;\n  }\n\n  /**\n   * Reset the EventBus (useful for testing)\n   */\n  public static reset(): void {\n    if (EventBus.instance) {\n      EventBus.instance.subscribers.clear();\n      EventBus.instance.eventQueue = [];\n      EventBus.instance.isProcessing = false;\n    }\n    EventBus.instance = null;\n  }\n\n  /**\n   * Subscribe to an event\n   * @param event - The event type to subscribe to\n   * @param handler - The callback function to invoke\n   * @param priority - Higher priority handlers are called first (default: 0)\n   * @returns Unsubscribe function\n   */\n  public on<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    priority = 0\n  ): UnsubscribeFn {\n    return this.subscribe(event, handler, false, priority);\n  }\n\n  /**\n   * Subscribe to an event, automatically unsubscribing after first invocation\n   * @param event - The event type to subscribe to\n   * @param handler - The callback function to invoke\n   * @param priority - Higher priority handlers are called first (default: 0)\n   * @returns Unsubscribe function\n   */\n  public once<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    priority = 0\n  ): UnsubscribeFn {\n    return this.subscribe(event, handler, true, priority);\n  }\n\n  /**\n   * Emit an event immediately\n   * @param event - The event type to emit\n   * @param payload - The event payload\n   */\n  public emit<K extends keyof GameEvents>(event: K, payload: GameEvents[K]): void {\n    const subscribers = this.subscribers.get(event);\n    if (!subscribers || subscribers.length === 0) {\n      return;\n    }\n\n    // Sort by priority (higher first) and process\n    const sortedSubscribers = [...subscribers].sort((a, b) => b.priority - a.priority);\n    const toRemove: EventSubscription<K>[] = [];\n\n    for (const subscription of sortedSubscribers) {\n      try {\n        (subscription.handler as EventHandler<GameEvents[K]>)(payload);\n        if (subscription.once) {\n          toRemove.push(subscription as EventSubscription<K>);\n        }\n      } catch (error) {\n        console.error(`Error in event handler for \"${event}\":`, error);\n      }\n    }\n\n    // Remove one-time handlers\n    for (const sub of toRemove) {\n      const index = subscribers.indexOf(sub as EventSubscription<keyof GameEvents>);\n      if (index !== -1) {\n        subscribers.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * Queue an event to be processed later (useful for deferring events)\n   * @param event - The event type to queue\n   * @param payload - The event payload\n   */\n  public queue<K extends keyof GameEvents>(event: K, payload: GameEvents[K]): void {\n    this.eventQueue.push({ event, payload: payload as GameEvents[keyof GameEvents] });\n  }\n\n  /**\n   * Process all queued events\n   */\n  public processQueue(): void {\n    if (this.isProcessing) {\n      return;\n    }\n\n    this.isProcessing = true;\n\n    while (this.eventQueue.length > 0) {\n      const queued = this.eventQueue.shift();\n      if (queued) {\n        this.emit(queued.event, queued.payload as GameEvents[typeof queued.event]);\n      }\n    }\n\n    this.isProcessing = false;\n  }\n\n  /**\n   * Remove all subscribers for a specific event\n   * @param event - The event type to clear\n   */\n  public off<K extends keyof GameEvents>(event: K): void {\n    this.subscribers.delete(event);\n  }\n\n  /**\n   * Get the number of subscribers for an event\n   * @param event - The event type to check\n   */\n  public subscriberCount<K extends keyof GameEvents>(event: K): number {\n    return this.subscribers.get(event)?.length ?? 0;\n  }\n\n  private subscribe<K extends keyof GameEvents>(\n    event: K,\n    handler: EventHandler<GameEvents[K]>,\n    once: boolean,\n    priority: number\n  ): UnsubscribeFn {\n    if (!this.subscribers.has(event)) {\n      this.subscribers.set(event, []);\n    }\n\n    const subscription: EventSubscription<K> = { handler, once, priority };\n    this.subscribers.get(event)!.push(subscription as EventSubscription<keyof GameEvents>);\n\n    return () => {\n      const subs = this.subscribers.get(event);\n      if (subs) {\n        const index = subs.indexOf(subscription as EventSubscription<keyof GameEvents>);\n        if (index !== -1) {\n          subs.splice(index, 1);\n        }\n      }\n    };\n  }\n}\n\n// Export singleton getter for convenience\nexport const getEventBus = (): EventBus => EventBus.getInstance();\n","/**\n * GameEngine - Central orchestrator for all game systems\n *\n * Manages the game loop, system initialization, and coordinates\n * between all subsystems.\n */\n\nimport { EventBus, getEventBus } from './EventBus';\nimport type { GameConfig, GameTime } from './types';\n\n// ============================================================================\n// System Interface\n// ============================================================================\n\nexport interface GameSystem {\n  readonly name: string;\n  initialize?(): void | Promise<void>;\n  update?(deltaTime: number, gameTime: GameTime): void;\n  fixedUpdate?(fixedDeltaTime: number, gameTime: GameTime): void;\n  lateUpdate?(deltaTime: number, gameTime: GameTime): void;\n  destroy?(): void;\n}\n\n// ============================================================================\n// Default Configuration\n// ============================================================================\n\nconst DEFAULT_CONFIG: GameConfig = {\n  tileSize: 32,\n  regionSize: 64,\n  loadDistance: 2,\n  unloadDistance: 3,\n  dayLengthSeconds: 600, // 10 real minutes = 1 game day\n};\n\n// ============================================================================\n// GameEngine Implementation\n// ============================================================================\n\nexport class GameEngine {\n  private static instance: GameEngine | null = null;\n\n  private config: GameConfig;\n  private systems: Map<string, GameSystem> = new Map();\n  private systemOrder: string[] = [];\n  private eventBus: EventBus;\n\n  private isRunning = false;\n  private isPaused = false;\n  private lastFrameTime = 0;\n  private accumulatedTime = 0;\n  private readonly fixedTimeStep = 1 / 60; // 60 Hz fixed update\n\n  private gameTime: GameTime = {\n    totalSeconds: 0,\n    deltaTime: 0,\n    gameHour: 6, // Start at 6 AM\n    gameDay: 1,\n    isPaused: false,\n  };\n\n  private animationFrameId: number | null = null;\n\n  private constructor(config: Partial<GameConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.eventBus = getEventBus();\n  }\n\n  /**\n   * Get the singleton GameEngine instance\n   */\n  public static getInstance(config?: Partial<GameConfig>): GameEngine {\n    if (!GameEngine.instance) {\n      GameEngine.instance = new GameEngine(config);\n    }\n    return GameEngine.instance;\n  }\n\n  /**\n   * Reset the GameEngine (useful for testing)\n   */\n  public static reset(): void {\n    if (GameEngine.instance) {\n      GameEngine.instance.stop();\n      GameEngine.instance.systems.clear();\n      GameEngine.instance.systemOrder = [];\n    }\n    GameEngine.instance = null;\n    EventBus.reset();\n  }\n\n  /**\n   * Get the game configuration\n   */\n  public getConfig(): Readonly<GameConfig> {\n    return this.config;\n  }\n\n  /**\n   * Get the current game time\n   */\n  public getGameTime(): Readonly<GameTime> {\n    return this.gameTime;\n  }\n\n  /**\n   * Register a game system\n   * @param system - The system to register\n   * @param order - Optional order index (lower = earlier in update loop)\n   */\n  public registerSystem(system: GameSystem, order?: number): void {\n    if (this.systems.has(system.name)) {\n      console.warn(`System \"${system.name}\" is already registered. Skipping.`);\n      return;\n    }\n\n    this.systems.set(system.name, system);\n\n    if (order !== undefined) {\n      // Insert at specific position\n      this.systemOrder.splice(order, 0, system.name);\n    } else {\n      // Append to end\n      this.systemOrder.push(system.name);\n    }\n  }\n\n  /**\n   * Unregister a game system\n   * @param name - The name of the system to unregister\n   */\n  public unregisterSystem(name: string): void {\n    const system = this.systems.get(name);\n    if (system) {\n      system.destroy?.();\n      this.systems.delete(name);\n      this.systemOrder = this.systemOrder.filter(n => n !== name);\n    }\n  }\n\n  /**\n   * Get a registered system by name\n   */\n  public getSystem<T extends GameSystem>(name: string): T | undefined {\n    return this.systems.get(name) as T | undefined;\n  }\n\n  /**\n   * Initialize all registered systems\n   */\n  public async initialize(): Promise<void> {\n    console.log('[GameEngine] Initializing systems...');\n\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      if (system?.initialize) {\n        console.log(`[GameEngine] Initializing ${name}...`);\n        await system.initialize();\n      }\n    }\n\n    console.log('[GameEngine] All systems initialized.');\n  }\n\n  /**\n   * Start the game loop\n   */\n  public start(): void {\n    if (this.isRunning) {\n      console.warn('[GameEngine] Game loop is already running.');\n      return;\n    }\n\n    console.log('[GameEngine] Starting game loop...');\n    this.isRunning = true;\n    this.lastFrameTime = performance.now();\n    this.eventBus.emit('game:started', {});\n    this.loop();\n  }\n\n  /**\n   * Stop the game loop\n   */\n  public stop(): void {\n    if (!this.isRunning) {\n      return;\n    }\n\n    console.log('[GameEngine] Stopping game loop...');\n    this.isRunning = false;\n\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n\n    this.eventBus.emit('game:quit', {});\n  }\n\n  /**\n   * Pause the game\n   */\n  public pause(): void {\n    if (this.isPaused) return;\n\n    this.isPaused = true;\n    this.gameTime.isPaused = true;\n    this.eventBus.emit('game:paused', {});\n    this.eventBus.emit('time:paused', {});\n  }\n\n  /**\n   * Resume the game\n   */\n  public resume(): void {\n    if (!this.isPaused) return;\n\n    this.isPaused = false;\n    this.gameTime.isPaused = false;\n    this.lastFrameTime = performance.now(); // Reset to avoid huge delta\n    this.eventBus.emit('game:resumed', {});\n    this.eventBus.emit('time:resumed', {});\n  }\n\n  /**\n   * Toggle pause state\n   */\n  public togglePause(): void {\n    if (this.isPaused) {\n      this.resume();\n    } else {\n      this.pause();\n    }\n  }\n\n  /**\n   * Check if the game is currently running\n   */\n  public isGameRunning(): boolean {\n    return this.isRunning;\n  }\n\n  /**\n   * Check if the game is currently paused\n   */\n  public isGamePaused(): boolean {\n    return this.isPaused;\n  }\n\n  /**\n   * Main game loop\n   */\n  private loop = (): void => {\n    if (!this.isRunning) return;\n\n    const currentTime = performance.now();\n    const deltaTime = Math.min((currentTime - this.lastFrameTime) / 1000, 0.1); // Cap at 100ms\n    this.lastFrameTime = currentTime;\n\n    // Update game time\n    this.gameTime.deltaTime = deltaTime;\n\n    if (!this.isPaused) {\n      this.gameTime.totalSeconds += deltaTime;\n      this.updateGameClock(deltaTime);\n\n      // Process queued events\n      this.eventBus.processQueue();\n\n      // Fixed update (physics, etc.)\n      this.accumulatedTime += deltaTime;\n      while (this.accumulatedTime >= this.fixedTimeStep) {\n        this.fixedUpdate(this.fixedTimeStep);\n        this.accumulatedTime -= this.fixedTimeStep;\n      }\n\n      // Variable update\n      this.update(deltaTime);\n\n      // Late update (camera, etc.)\n      this.lateUpdate(deltaTime);\n    }\n\n    this.animationFrameId = requestAnimationFrame(this.loop);\n  };\n\n  /**\n   * Update game clock (day/night cycle)\n   */\n  private updateGameClock(deltaTime: number): void {\n    const secondsPerGameHour = this.config.dayLengthSeconds / 24;\n    const hoursElapsed = deltaTime / secondsPerGameHour;\n\n    const previousHour = Math.floor(this.gameTime.gameHour);\n    this.gameTime.gameHour += hoursElapsed;\n\n    // Check for hour change\n    const currentHour = Math.floor(this.gameTime.gameHour);\n    if (currentHour !== previousHour && currentHour < 24) {\n      this.eventBus.emit('time:hourChanged', {\n        hour: currentHour,\n        day: this.gameTime.gameDay,\n      });\n    }\n\n    // Check for day change\n    if (this.gameTime.gameHour >= 24) {\n      this.gameTime.gameHour -= 24;\n      this.gameTime.gameDay += 1;\n      this.eventBus.emit('time:dayChanged', { day: this.gameTime.gameDay });\n      this.eventBus.emit('time:hourChanged', {\n        hour: Math.floor(this.gameTime.gameHour),\n        day: this.gameTime.gameDay,\n      });\n    }\n  }\n\n  /**\n   * Fixed timestep update (for physics, etc.)\n   */\n  private fixedUpdate(fixedDeltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.fixedUpdate?.(fixedDeltaTime, this.gameTime);\n    }\n  }\n\n  /**\n   * Variable timestep update\n   */\n  private update(deltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.update?.(deltaTime, this.gameTime);\n    }\n  }\n\n  /**\n   * Late update (after all systems have updated)\n   */\n  private lateUpdate(deltaTime: number): void {\n    for (const name of this.systemOrder) {\n      const system = this.systems.get(name);\n      system?.lateUpdate?.(deltaTime, this.gameTime);\n    }\n  }\n}\n\n// Export singleton getter for convenience\nexport const getGameEngine = (config?: Partial<GameConfig>): GameEngine =>\n  GameEngine.getInstance(config);\n","/**\n * TileRegistry - Manages tile type definitions\n *\n * Central registry for all tile types with their properties.\n */\n\nimport { TileLayer, type TileType, type ResourceDrop } from '../core/types';\n\n// ============================================================================\n// Default Tile Types\n// ============================================================================\n\nconst createTileType = (\n  id: string,\n  name: string,\n  layer: TileLayer,\n  options: Partial<Omit<TileType, 'id' | 'name' | 'layer'>> = {}\n): TileType => ({\n  id,\n  name,\n  layer,\n  walkable: options.walkable ?? true,\n  hardness: options.hardness ?? 1,\n  transparent: options.transparent ?? true,\n  drops: options.drops ?? [],\n  autotileGroup: options.autotileGroup ?? null,\n  buildRequirements: options.buildRequirements ?? [],\n});\n\n// ============================================================================\n// TileRegistry Implementation\n// ============================================================================\n\nexport class TileRegistry {\n  private static instance: TileRegistry | null = null;\n  private tiles: Map<string, TileType> = new Map();\n\n  private constructor() {\n    this.registerDefaultTiles();\n  }\n\n  /**\n   * Get the singleton TileRegistry instance\n   */\n  public static getInstance(): TileRegistry {\n    if (!TileRegistry.instance) {\n      TileRegistry.instance = new TileRegistry();\n    }\n    return TileRegistry.instance;\n  }\n\n  /**\n   * Reset the registry (useful for testing)\n   */\n  public static reset(): void {\n    TileRegistry.instance = null;\n  }\n\n  /**\n   * Register a new tile type\n   */\n  public register(tile: TileType): void {\n    if (this.tiles.has(tile.id)) {\n      console.warn(`Tile type \"${tile.id}\" is already registered. Overwriting.`);\n    }\n    this.tiles.set(tile.id, tile);\n  }\n\n  /**\n   * Get a tile type by ID\n   */\n  public get(id: string): TileType | undefined {\n    return this.tiles.get(id);\n  }\n\n  /**\n   * Check if a tile type exists\n   */\n  public has(id: string): boolean {\n    return this.tiles.has(id);\n  }\n\n  /**\n   * Get all tile types\n   */\n  public getAll(): TileType[] {\n    return Array.from(this.tiles.values());\n  }\n\n  /**\n   * Get all tile types in a specific layer\n   */\n  public getByLayer(layer: TileLayer): TileType[] {\n    return this.getAll().filter(t => t.layer === layer);\n  }\n\n  /**\n   * Get all tile types in an autotile group\n   */\n  public getByAutotileGroup(group: string): TileType[] {\n    return this.getAll().filter(t => t.autotileGroup === group);\n  }\n\n  /**\n   * Register default tile types for the game\n   * Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard:\n   * - Layer 0 (Background): Decorative, no collision\n   * - Layer 1 (Ground): Terrain, floors\n   * - Layer 2 (Objects): Furniture, resources, items\n   * - Layer 3 (Walls): Structures, barriers\n   * - Layer 4 (Foreground): Visual overlays, roofs\n   */\n  private registerDefaultTiles(): void {\n    // Background Layer (Layer 0) - Decorative, no collision\n    // Used for visual decorations under terrain\n\n    // Ground Layer (Layer 1) - Terrain, Floors\n    this.register(createTileType('grass', 'Grass', TileLayer.Ground, {\n      autotileGroup: 'grass',\n      drops: [{ resourceId: 'fiber', minAmount: 0, maxAmount: 1, chance: 0.1 }],\n    }));\n\n    this.register(createTileType('dirt', 'Dirt', TileLayer.Ground, {\n      autotileGroup: 'dirt',\n      hardness: 0.8,\n    }));\n\n    this.register(createTileType('sand', 'Sand', TileLayer.Ground, {\n      autotileGroup: 'sand',\n      hardness: 0.5,\n    }));\n\n    this.register(createTileType('water', 'Water', TileLayer.Ground, {\n      walkable: false,\n      autotileGroup: 'water',\n      hardness: -1, // Unbreakable\n    }));\n\n    this.register(createTileType('deep_water', 'Deep Water', TileLayer.Ground, {\n      walkable: false,\n      autotileGroup: 'water',\n      hardness: -1,\n    }));\n\n    this.register(createTileType('stone_floor', 'Stone Floor', TileLayer.Ground, {\n      autotileGroup: 'stone',\n      hardness: 2,\n      drops: [{ resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.5 }],\n    }));\n\n    this.register(createTileType('wooden_floor', 'Wooden Floor', TileLayer.Ground, {\n      autotileGroup: 'wood_floor',\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 2 }],\n      drops: [{ resourceId: 'wood', minAmount: 1, maxAmount: 2, chance: 0.8 }],\n    }));\n\n    this.register(createTileType('stone_path', 'Stone Path', TileLayer.Ground, {\n      autotileGroup: 'stone_path',\n      hardness: 1.5,\n      buildRequirements: [{ resourceId: 'stone', amount: 2 }],\n      drops: [{ resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.8 }],\n    }));\n\n    // Objects Layer (Layer 2) - Furniture, Resources, Items\n    this.register(createTileType('tree', 'Tree', TileLayer.Objects, {\n      walkable: false,\n      hardness: 3,\n      drops: [\n        { resourceId: 'wood', minAmount: 3, maxAmount: 6, chance: 1 },\n        { resourceId: 'stick', minAmount: 1, maxAmount: 3, chance: 0.5 },\n      ],\n    }));\n\n    this.register(createTileType('rock', 'Rock', TileLayer.Objects, {\n      walkable: false,\n      hardness: 4,\n      drops: [\n        { resourceId: 'stone', minAmount: 2, maxAmount: 5, chance: 1 },\n        { resourceId: 'flint', minAmount: 0, maxAmount: 1, chance: 0.2 },\n      ],\n    }));\n\n    this.register(createTileType('iron_ore', 'Iron Ore', TileLayer.Objects, {\n      walkable: false,\n      hardness: 5,\n      drops: [\n        { resourceId: 'iron_ore', minAmount: 1, maxAmount: 3, chance: 1 },\n        { resourceId: 'stone', minAmount: 1, maxAmount: 2, chance: 0.5 },\n      ],\n    }));\n\n    this.register(createTileType('bush', 'Bush', TileLayer.Objects, {\n      walkable: true,\n      hardness: 0.5,\n      drops: [\n        { resourceId: 'fiber', minAmount: 1, maxAmount: 2, chance: 0.8 },\n        { resourceId: 'berries', minAmount: 0, maxAmount: 2, chance: 0.3 },\n      ],\n    }));\n\n    this.register(createTileType('chest', 'Chest', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 15 }],\n    }));\n\n    this.register(createTileType('workbench', 'Workbench', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1.5,\n      buildRequirements: [{ resourceId: 'wood', amount: 20 }],\n    }));\n\n    this.register(createTileType('campfire', 'Campfire', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [\n        { resourceId: 'wood', amount: 5 },\n        { resourceId: 'stone', amount: 3 },\n      ],\n    }));\n\n    this.register(createTileType('bed', 'Bed', TileLayer.Objects, {\n      walkable: false,\n      hardness: 1,\n      buildRequirements: [\n        { resourceId: 'wood', amount: 10 },\n        { resourceId: 'fiber', amount: 5 },\n      ],\n    }));\n\n    // Walls Layer (Layer 3) - Structures, Barriers\n    this.register(createTileType('wooden_wall', 'Wooden Wall', TileLayer.Walls, {\n      walkable: false,\n      transparent: false,\n      autotileGroup: 'wood_wall',\n      hardness: 2,\n      buildRequirements: [{ resourceId: 'wood', amount: 5 }],\n      drops: [{ resourceId: 'wood', minAmount: 2, maxAmount: 4, chance: 0.9 }],\n    }));\n\n    this.register(createTileType('stone_wall', 'Stone Wall', TileLayer.Walls, {\n      walkable: false,\n      transparent: false,\n      autotileGroup: 'stone_wall',\n      hardness: 4,\n      buildRequirements: [{ resourceId: 'stone', amount: 8 }],\n      drops: [{ resourceId: 'stone', minAmount: 3, maxAmount: 6, chance: 0.9 }],\n    }));\n\n    // Foreground Layer (Layer 4) - Visual overlays, roofs\n    this.register(createTileType('roof_wood', 'Wooden Roof', TileLayer.Foreground, {\n      walkable: true, // Player walks under it\n      transparent: false,\n      autotileGroup: 'roof_wood',\n      hardness: 1,\n      buildRequirements: [{ resourceId: 'wood', amount: 3 }],\n    }));\n  }\n}\n\n// Export singleton getter for convenience\nexport const getTileRegistry = (): TileRegistry => TileRegistry.getInstance();\n","/**\n * TilemapManager - Manages the 2D tile-based world\n *\n * Handles tile placement, removal, and querying across multiple layers.\n * Integrates with the EventBus for tile change notifications.\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - 5 Layer Standard:\n * - Layer 0 (Background): Decorative, no collision\n * - Layer 1 (Ground): Terrain, floors\n * - Layer 2 (Objects): Furniture, resources, items\n * - Layer 3 (Walls): Structures, barriers\n * - Layer 4 (Foreground): Visual overlays, roofs\n */\n\nconst MAX_LAYER = 4; // 5 layers total (0-4)\n\nimport type { GameSystem } from '../core/GameEngine';\nimport { getEventBus } from '../core/EventBus';\nimport { TileLayer, type Tile, type TileType, type Vector2Int, type Bounds, type GameTime } from '../core/types';\nimport { getTileRegistry, type TileRegistry } from './TileRegistry';\n\n// ============================================================================\n// Types\n// ============================================================================\n\ninterface TileChange {\n  position: Vector2Int;\n  layer: TileLayer;\n  oldTypeId: string | null;\n  newTypeId: string | null;\n  timestamp: number;\n}\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\nconst positionKey = (x: number, y: number, layer: TileLayer): string =>\n  `${x},${y},${layer}`;\n\nconst parsePositionKey = (key: string): { x: number; y: number; layer: TileLayer } => {\n  const [x, y, layer] = key.split(',').map(Number);\n  return { x, y, layer: layer as TileLayer };\n};\n\n// ============================================================================\n// TilemapManager Implementation\n// ============================================================================\n\nexport class TilemapManager implements GameSystem {\n  public readonly name = 'TilemapManager';\n\n  private tiles: Map<string, Tile> = new Map();\n  private tileRegistry: TileRegistry;\n  private pendingChanges: TileChange[] = [];\n  private changeHistory: TileChange[] = [];\n  private maxHistorySize = 1000;\n\n  constructor() {\n    this.tileRegistry = getTileRegistry();\n  }\n\n  /**\n   * Initialize the tilemap manager\n   */\n  public initialize(): void {\n    console.log('[TilemapManager] Initialized');\n  }\n\n  /**\n   * Update - processes pending changes\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    // Process any pending tile changes\n    this.processPendingChanges();\n  }\n\n  /**\n   * Set a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @param typeId - Tile type ID\n   * @param variant - Autotile variant (default: 0)\n   * @returns true if tile was set successfully\n   */\n  public setTile(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    typeId: string,\n    variant = 0\n  ): boolean {\n    const tileType = this.tileRegistry.get(typeId);\n    if (!tileType) {\n      console.warn(`[TilemapManager] Unknown tile type: ${typeId}`);\n      return false;\n    }\n\n    const key = positionKey(x, y, layer);\n    const existingTile = this.tiles.get(key);\n    const oldTypeId = existingTile?.typeId ?? null;\n\n    // Create new tile\n    const tile: Tile = {\n      typeId,\n      layer,\n      position: { x, y },\n      variant,\n    };\n\n    this.tiles.set(key, tile);\n\n    // Queue change event\n    this.pendingChanges.push({\n      position: { x, y },\n      layer,\n      oldTypeId,\n      newTypeId: typeId,\n      timestamp: Date.now(),\n    });\n\n    return true;\n  }\n\n  /**\n   * Remove a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The removed tile, or null if no tile existed\n   */\n  public removeTile(x: number, y: number, layer: TileLayer): Tile | null {\n    const key = positionKey(x, y, layer);\n    const tile = this.tiles.get(key);\n\n    if (!tile) {\n      return null;\n    }\n\n    this.tiles.delete(key);\n\n    // Queue change event\n    this.pendingChanges.push({\n      position: { x, y },\n      layer,\n      oldTypeId: tile.typeId,\n      newTypeId: null,\n      timestamp: Date.now(),\n    });\n\n    return tile;\n  }\n\n  /**\n   * Get a tile at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The tile, or undefined if no tile exists\n   */\n  public getTile(x: number, y: number, layer: TileLayer): Tile | undefined {\n    return this.tiles.get(positionKey(x, y, layer));\n  }\n\n  /**\n   * Get the tile type at a position\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns The tile type, or undefined if no tile exists\n   */\n  public getTileType(x: number, y: number, layer: TileLayer): TileType | undefined {\n    const tile = this.getTile(x, y, layer);\n    return tile ? this.tileRegistry.get(tile.typeId) : undefined;\n  }\n\n  /**\n   * Check if a position has a tile in any layer\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if any tile exists at this position\n   */\n  public hasTile(x: number, y: number): boolean {\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      if (this.tiles.has(positionKey(x, y, layer as TileLayer))) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if a position is walkable\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if the position can be walked on\n   */\n  public isWalkable(x: number, y: number): boolean {\n    // Check all layers for blocking tiles\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) {\n        const tileType = this.tileRegistry.get(tile.typeId);\n        if (tileType && !tileType.walkable) {\n          return false;\n        }\n      }\n    }\n\n    // Must have at least a Ground layer tile to be walkable\n    // Per 5-layer standard: Layer 1 (Ground) contains terrain/floors\n    const ground = this.getTile(x, y, TileLayer.Ground);\n    if (!ground) {\n      return false; // No ground = not walkable\n    }\n\n    const groundType = this.tileRegistry.get(ground.typeId);\n    return groundType?.walkable ?? false;\n  }\n\n  /**\n   * Check if a position is transparent (for light/vision)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns true if light can pass through\n   */\n  public isTransparent(x: number, y: number): boolean {\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) {\n        const tileType = this.tileRegistry.get(tile.typeId);\n        if (tileType && !tileType.transparent) {\n          return false;\n        }\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Get all tiles in a rectangular region\n   * @param bounds - The region bounds\n   * @param layer - Optional specific layer (all layers if not specified)\n   * @returns Array of tiles in the region\n   */\n  public getTilesInRegion(bounds: Bounds, layer?: TileLayer): Tile[] {\n    const tiles: Tile[] = [];\n\n    for (let x = bounds.x; x < bounds.x + bounds.width; x++) {\n      for (let y = bounds.y; y < bounds.y + bounds.height; y++) {\n        if (layer !== undefined) {\n          const tile = this.getTile(x, y, layer);\n          if (tile) tiles.push(tile);\n        } else {\n          for (let l = 0; l <= MAX_LAYER; l++) {\n            const tile = this.getTile(x, y, l as TileLayer);\n            if (tile) tiles.push(tile);\n          }\n        }\n      }\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get all tiles at a position (all layers)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @returns Array of tiles at this position\n   */\n  public getTilesAt(x: number, y: number): Tile[] {\n    const tiles: Tile[] = [];\n\n    for (let layer = 0; layer <= MAX_LAYER; layer++) {\n      const tile = this.getTile(x, y, layer as TileLayer);\n      if (tile) tiles.push(tile);\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get neighboring tiles (4-connected)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns Object with north, south, east, west tiles\n   */\n  public getNeighbors4(\n    x: number,\n    y: number,\n    layer: TileLayer\n  ): { north?: Tile; south?: Tile; east?: Tile; west?: Tile } {\n    return {\n      north: this.getTile(x, y - 1, layer),\n      south: this.getTile(x, y + 1, layer),\n      east: this.getTile(x + 1, y, layer),\n      west: this.getTile(x - 1, y, layer),\n    };\n  }\n\n  /**\n   * Get neighboring tiles (8-connected)\n   * @param x - X coordinate\n   * @param y - Y coordinate\n   * @param layer - Tile layer\n   * @returns Object with all 8 neighboring tiles\n   */\n  public getNeighbors8(\n    x: number,\n    y: number,\n    layer: TileLayer\n  ): {\n    north?: Tile;\n    south?: Tile;\n    east?: Tile;\n    west?: Tile;\n    northEast?: Tile;\n    northWest?: Tile;\n    southEast?: Tile;\n    southWest?: Tile;\n  } {\n    return {\n      north: this.getTile(x, y - 1, layer),\n      south: this.getTile(x, y + 1, layer),\n      east: this.getTile(x + 1, y, layer),\n      west: this.getTile(x - 1, y, layer),\n      northEast: this.getTile(x + 1, y - 1, layer),\n      northWest: this.getTile(x - 1, y - 1, layer),\n      southEast: this.getTile(x + 1, y + 1, layer),\n      southWest: this.getTile(x - 1, y + 1, layer),\n    };\n  }\n\n  /**\n   * Clear all tiles\n   */\n  public clear(): void {\n    this.tiles.clear();\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Get total tile count\n   */\n  public getTileCount(): number {\n    return this.tiles.size;\n  }\n\n  /**\n   * Get tile count by layer\n   */\n  public getTileCountByLayer(layer: TileLayer): number {\n    let count = 0;\n    for (const key of this.tiles.keys()) {\n      if (key.endsWith(`,${layer}`)) {\n        count++;\n      }\n    }\n    return count;\n  }\n\n  /**\n   * Get change history\n   */\n  public getChangeHistory(): readonly TileChange[] {\n    return this.changeHistory;\n  }\n\n  /**\n   * Serialize tilemap state for saving\n   */\n  public serialize(): Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant: number }> {\n    const data: Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant: number }> = [];\n\n    for (const tile of this.tiles.values()) {\n      data.push({\n        position: tile.position,\n        layer: tile.layer,\n        typeId: tile.typeId,\n        variant: tile.variant,\n      });\n    }\n\n    return data;\n  }\n\n  /**\n   * Deserialize tilemap state from save data\n   */\n  public deserialize(\n    data: Array<{ position: Vector2Int; layer: TileLayer; typeId: string; variant?: number }>\n  ): void {\n    this.clear();\n\n    for (const tileData of data) {\n      this.setTile(\n        tileData.position.x,\n        tileData.position.y,\n        tileData.layer,\n        tileData.typeId,\n        tileData.variant ?? 0\n      );\n    }\n\n    // Clear pending changes from deserialization\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Process pending tile changes and emit events\n   */\n  private processPendingChanges(): void {\n    const eventBus = getEventBus();\n\n    for (const change of this.pendingChanges) {\n      eventBus.emit('world:tileChanged', {\n        position: change.position,\n        layer: change.layer,\n        oldTypeId: change.oldTypeId,\n        newTypeId: change.newTypeId,\n      });\n\n      // Add to history\n      this.changeHistory.push(change);\n\n      // Trim history if needed\n      if (this.changeHistory.length > this.maxHistorySize) {\n        this.changeHistory.shift();\n      }\n    }\n\n    this.pendingChanges = [];\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.clear();\n    console.log('[TilemapManager] Destroyed');\n  }\n}\n","/**\n * AutotileSystem - Calculates tile variants based on neighbors\n *\n * Supports 4-bit (16 variants) and 8-bit (47 variants) autotiling patterns.\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * - 4-bit (16 variants): Simple walls\n * - 8-bit (47 variants): Terrain transitions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus, type GameEvents } from '@core/EventBus';\nimport type { TileLayer, Vector2Int, GameTime } from '@core/types';\nimport { TilemapManager } from './TilemapManager';\nimport { getTileRegistry } from './TileRegistry';\n\n// ============================================================================\n// Autotile Patterns\n// ============================================================================\n\n/**\n * 4-bit autotile bitmask positions:\n *   1\n * 8 X 2\n *   4\n */\nexport enum Neighbor4 {\n  North = 1,\n  East = 2,\n  South = 4,\n  West = 8,\n}\n\n/**\n * 8-bit autotile bitmask positions:\n * 1   2   4\n * 8   X   16\n * 32  64  128\n */\nexport enum Neighbor8 {\n  NorthWest = 1,\n  North = 2,\n  NorthEast = 4,\n  West = 8,\n  East = 16,\n  SouthWest = 32,\n  South = 64,\n  SouthEast = 128,\n}\n\n// ============================================================================\n// 4-bit to Variant Mapping (16 variants)\n// ============================================================================\n\n/**\n * Maps 4-bit neighbor bitmask to tile variant index.\n * Used for simple wall tiles.\n */\nconst VARIANT_MAP_4BIT: Record<number, number> = {\n  0b0000: 0,  // No neighbors\n  0b0001: 1,  // North only\n  0b0010: 2,  // East only\n  0b0011: 3,  // North + East\n  0b0100: 4,  // South only\n  0b0101: 5,  // North + South\n  0b0110: 6,  // East + South\n  0b0111: 7,  // North + East + South\n  0b1000: 8,  // West only\n  0b1001: 9,  // North + West\n  0b1010: 10, // East + West\n  0b1011: 11, // North + East + West\n  0b1100: 12, // South + West\n  0b1101: 13, // North + South + West\n  0b1110: 14, // East + South + West\n  0b1111: 15, // All neighbors\n};\n\n// ============================================================================\n// 8-bit to Variant Mapping (47 variants)\n// ============================================================================\n\n/**\n * Complete lookup table for 8-bit autotiling (47 unique variants).\n * Maps the masked bitmask (after removing irrelevant corners) to tile variant index.\n *\n * Variant indices are organized as follows:\n * 0-15:  Base 4-directional patterns (no relevant corners)\n * 16-46: Patterns with corner variations\n *\n * The tile atlas should be arranged in this order for correct rendering.\n */\nconst VARIANT_MAP_8BIT: Map<number, number> = new Map([\n  // ============ No edges (isolated) ============\n  [0, 0],\n\n  // ============ Single edge (4 end caps) ============\n  [Neighbor8.North, 1],\n  [Neighbor8.East, 2],\n  [Neighbor8.South, 3],\n  [Neighbor8.West, 4],\n\n  // ============ Two opposite edges (2 straight pieces) ============\n  [Neighbor8.North | Neighbor8.South, 5],\n  [Neighbor8.East | Neighbor8.West, 6],\n\n  // ============ Two adjacent edges - outer corners (4 patterns × 2 corner states = 8) ============\n  // NE corner area\n  [Neighbor8.North | Neighbor8.East, 7],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.NorthEast, 8],\n  // SE corner area\n  [Neighbor8.East | Neighbor8.South, 9],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.SouthEast, 10],\n  // SW corner area\n  [Neighbor8.South | Neighbor8.West, 11],\n  [Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 12],\n  // NW corner area\n  [Neighbor8.North | Neighbor8.West, 13],\n  [Neighbor8.North | Neighbor8.West | Neighbor8.NorthWest, 14],\n\n  // ============ Three edges - T junctions (4 patterns × 4 corner states = 16) ============\n  // Missing West (has N, E, S - corners NE and SE matter)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South, 15],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.NorthEast, 16],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.SouthEast, 17],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.NorthEast | Neighbor8.SouthEast, 18],\n\n  // Missing North (has E, S, W - corners SE and SW matter)\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West, 19],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast, 20],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 21],\n  [Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest, 22],\n\n  // Missing East (has N, S, W - corners NW and SW matter)\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West, 23],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest, 24],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 25],\n  [Neighbor8.North | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.SouthWest, 26],\n\n  // Missing South (has N, E, W - corners NW and NE matter)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West, 27],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthEast, 28],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthWest, 29],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.NorthWest, 30],\n\n  // ============ Four edges - center pieces (16 corner combinations) ============\n  // All 4 edges present, varying corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West, 31],\n  // 1 corner\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast, 32],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast, 33],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest, 34],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest, 35],\n  // 2 adjacent corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthEast, 36],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest, 37],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest | Neighbor8.NorthWest, 38],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.NorthEast, 39],\n  // 2 opposite corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthWest, 40],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.SouthEast, 41],\n  // 3 corners\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthEast | Neighbor8.SouthEast | Neighbor8.SouthWest, 42],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthEast | Neighbor8.SouthWest | Neighbor8.NorthWest, 43],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.SouthWest | Neighbor8.NorthWest | Neighbor8.NorthEast, 44],\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West | Neighbor8.NorthWest | Neighbor8.NorthEast | Neighbor8.SouthEast, 45],\n  // 4 corners (fully surrounded)\n  [Neighbor8.North | Neighbor8.East | Neighbor8.South | Neighbor8.West |\n   Neighbor8.NorthEast | Neighbor8.SouthEast | Neighbor8.SouthWest | Neighbor8.NorthWest, 46],\n]);\n\n/**\n * Mask out corners that don't have both adjacent edges present.\n * This is required because corners are only visually relevant when\n * both adjacent cardinal neighbors are also present.\n */\nfunction maskIrrelevantCorners(bitmask: number): number {\n  let masked = bitmask;\n\n  // NorthWest corner: needs both North and West edges\n  if ((bitmask & Neighbor8.NorthWest) && !((bitmask & Neighbor8.North) && (bitmask & Neighbor8.West))) {\n    masked &= ~Neighbor8.NorthWest;\n  }\n\n  // NorthEast corner: needs both North and East edges\n  if ((bitmask & Neighbor8.NorthEast) && !((bitmask & Neighbor8.North) && (bitmask & Neighbor8.East))) {\n    masked &= ~Neighbor8.NorthEast;\n  }\n\n  // SouthWest corner: needs both South and West edges\n  if ((bitmask & Neighbor8.SouthWest) && !((bitmask & Neighbor8.South) && (bitmask & Neighbor8.West))) {\n    masked &= ~Neighbor8.SouthWest;\n  }\n\n  // SouthEast corner: needs both South and East edges\n  if ((bitmask & Neighbor8.SouthEast) && !((bitmask & Neighbor8.South) && (bitmask & Neighbor8.East))) {\n    masked &= ~Neighbor8.SouthEast;\n  }\n\n  return masked;\n}\n\n/**\n * Calculate the 8-bit autotile variant index from a neighbor bitmask.\n * Returns a variant index 0-46 for use with the tile atlas.\n */\nfunction calculate8BitVariant(bitmask: number): number {\n  const maskedBitmask = maskIrrelevantCorners(bitmask);\n  return VARIANT_MAP_8BIT.get(maskedBitmask) ?? 0;\n}\n\n// ============================================================================\n// AutotileSystem Implementation\n// ============================================================================\n\nexport class AutotileSystem implements GameSystem {\n  public readonly name = 'AutotileSystem';\n\n  private tilemapManager: TilemapManager | null = null;\n  private pendingUpdates: Set<string> = new Set();\n  private unsubscribe: (() => void) | null = null;\n\n  /**\n   * Initialize with a reference to the TilemapManager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for tile changes\n    this.unsubscribe = eventBus.on('world:tileChanged', (event) => {\n      this.onTileChanged(event);\n    });\n\n    console.log('[AutotileSystem] Initialized');\n  }\n\n  /**\n   * Set the tilemap manager reference\n   */\n  public setTilemapManager(manager: TilemapManager): void {\n    this.tilemapManager = manager;\n  }\n\n  /**\n   * Update - processes pending autotile updates\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    if (this.pendingUpdates.size === 0 || !this.tilemapManager) {\n      return;\n    }\n\n    // Process all pending updates\n    for (const key of this.pendingUpdates) {\n      const [x, y, layer] = key.split(',').map(Number);\n      this.updateTileVariant(x, y, layer as TileLayer);\n    }\n\n    this.pendingUpdates.clear();\n  }\n\n  /**\n   * Handle tile change events\n   */\n  private onTileChanged(event: GameEvents['world:tileChanged']): void {\n    const { position, layer } = event;\n\n    // Queue update for the changed tile\n    this.queueUpdate(position.x, position.y, layer);\n\n    // Queue updates for all neighbors (they may need to update their variants)\n    this.queueUpdate(position.x, position.y - 1, layer); // North\n    this.queueUpdate(position.x + 1, position.y, layer); // East\n    this.queueUpdate(position.x, position.y + 1, layer); // South\n    this.queueUpdate(position.x - 1, position.y, layer); // West\n    this.queueUpdate(position.x + 1, position.y - 1, layer); // NorthEast\n    this.queueUpdate(position.x - 1, position.y - 1, layer); // NorthWest\n    this.queueUpdate(position.x + 1, position.y + 1, layer); // SouthEast\n    this.queueUpdate(position.x - 1, position.y + 1, layer); // SouthWest\n  }\n\n  /**\n   * Queue a tile position for autotile update\n   */\n  private queueUpdate(x: number, y: number, layer: TileLayer): void {\n    this.pendingUpdates.add(`${x},${y},${layer}`);\n  }\n\n  /**\n   * Update the variant for a single tile\n   */\n  private updateTileVariant(x: number, y: number, layer: TileLayer): void {\n    if (!this.tilemapManager) return;\n\n    const tile = this.tilemapManager.getTile(x, y, layer);\n    if (!tile) return;\n\n    const tileRegistry = getTileRegistry();\n    const tileType = tileRegistry.get(tile.typeId);\n    if (!tileType || !tileType.autotileGroup) return;\n\n    // Calculate neighbor bitmask\n    const variant = this.calculateVariant(x, y, layer, tileType.autotileGroup);\n\n    // Update tile variant if it changed\n    if (tile.variant !== variant) {\n      // Directly update the tile's variant (avoiding event loop)\n      tile.variant = variant;\n    }\n  }\n\n  /**\n   * Calculate the autotile variant for a position\n   */\n  public calculateVariant(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    autotileGroup: string\n  ): number {\n    if (!this.tilemapManager) return 0;\n\n    const tileRegistry = getTileRegistry();\n\n    // Check if neighbor matches the autotile group\n    const matchesGroup = (nx: number, ny: number): boolean => {\n      const neighbor = this.tilemapManager!.getTile(nx, ny, layer);\n      if (!neighbor) return false;\n      const neighborType = tileRegistry.get(neighbor.typeId);\n      return neighborType?.autotileGroup === autotileGroup;\n    };\n\n    // Calculate 4-bit bitmask (for simple autotiling)\n    let bitmask4 = 0;\n    if (matchesGroup(x, y - 1)) bitmask4 |= Neighbor4.North;\n    if (matchesGroup(x + 1, y)) bitmask4 |= Neighbor4.East;\n    if (matchesGroup(x, y + 1)) bitmask4 |= Neighbor4.South;\n    if (matchesGroup(x - 1, y)) bitmask4 |= Neighbor4.West;\n\n    // For now, use 4-bit autotiling (can be extended to 8-bit for terrain)\n    return VARIANT_MAP_4BIT[bitmask4] ?? 0;\n  }\n\n  /**\n   * Calculate 8-bit variant for terrain transitions\n   */\n  public calculateVariant8Bit(\n    x: number,\n    y: number,\n    layer: TileLayer,\n    autotileGroup: string\n  ): number {\n    if (!this.tilemapManager) return 0;\n\n    const tileRegistry = getTileRegistry();\n\n    // Check if neighbor matches the autotile group\n    const matchesGroup = (nx: number, ny: number): boolean => {\n      const neighbor = this.tilemapManager!.getTile(nx, ny, layer);\n      if (!neighbor) return false;\n      const neighborType = tileRegistry.get(neighbor.typeId);\n      return neighborType?.autotileGroup === autotileGroup;\n    };\n\n    // Calculate 8-bit bitmask\n    let bitmask8 = 0;\n    if (matchesGroup(x - 1, y - 1)) bitmask8 |= Neighbor8.NorthWest;\n    if (matchesGroup(x, y - 1)) bitmask8 |= Neighbor8.North;\n    if (matchesGroup(x + 1, y - 1)) bitmask8 |= Neighbor8.NorthEast;\n    if (matchesGroup(x - 1, y)) bitmask8 |= Neighbor8.West;\n    if (matchesGroup(x + 1, y)) bitmask8 |= Neighbor8.East;\n    if (matchesGroup(x - 1, y + 1)) bitmask8 |= Neighbor8.SouthWest;\n    if (matchesGroup(x, y + 1)) bitmask8 |= Neighbor8.South;\n    if (matchesGroup(x + 1, y + 1)) bitmask8 |= Neighbor8.SouthEast;\n\n    return calculate8BitVariant(bitmask8);\n  }\n\n  /**\n   * Force update all tiles in a region\n   */\n  public updateRegion(x: number, y: number, width: number, height: number, layer: TileLayer): void {\n    for (let tx = x; tx < x + width; tx++) {\n      for (let ty = y; ty < y + height; ty++) {\n        this.queueUpdate(tx, ty, layer);\n      }\n    }\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n      this.unsubscribe = null;\n    }\n    this.pendingUpdates.clear();\n    console.log('[AutotileSystem] Destroyed');\n  }\n}\n","/**\n * RegionManager - Manages world streaming by regions\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * - Region size: 64x64 tiles\n * - Load distance: 2 regions in each direction\n * - Unload distance: 3 regions in each direction\n * - Pause tasks in unloaded regions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { Vector2, Vector2Int, GameTime, Tile, TileLayer } from '@core/types';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nexport interface RegionConfig {\n  regionSize: number;      // Tiles per region side\n  loadDistance: number;    // Regions to load around player\n  unloadDistance: number;  // Regions to unload beyond this\n}\n\nconst DEFAULT_CONFIG: RegionConfig = {\n  regionSize: 64,\n  loadDistance: 2,\n  unloadDistance: 3,\n};\n\n// ============================================================================\n// Region Data Structure\n// ============================================================================\n\nexport interface RegionData {\n  id: string;\n  position: Vector2Int;      // Region coordinates (not tile coordinates)\n  tiles: Map<string, Tile>;  // Tiles within this region\n  isLoaded: boolean;\n  lastAccessTime: number;\n}\n\n// ============================================================================\n// RegionManager Implementation\n// ============================================================================\n\nexport class RegionManager implements GameSystem {\n  public readonly name = 'RegionManager';\n\n  private config: RegionConfig;\n  private regions: Map<string, RegionData> = new Map();\n  private loadedRegions: Set<string> = new Set();\n  private playerPosition: Vector2 = { x: 0, y: 0 };\n  private lastPlayerRegion: Vector2Int = { x: 0, y: 0 };\n\n  constructor(config: Partial<RegionConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the region manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for player movement to update regions\n    eventBus.on('player:moved', (event) => {\n      this.playerPosition = event.position;\n    });\n\n    console.log('[RegionManager] Initialized with config:', this.config);\n  }\n\n  /**\n   * Update - check if regions need to be loaded/unloaded\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    const currentRegion = this.worldToRegion(this.playerPosition.x, this.playerPosition.y);\n\n    // Only update regions if player moved to a new region\n    if (currentRegion.x !== this.lastPlayerRegion.x || currentRegion.y !== this.lastPlayerRegion.y) {\n      this.updateLoadedRegions(currentRegion);\n      this.lastPlayerRegion = currentRegion;\n    }\n  }\n\n  /**\n   * Convert world coordinates to region coordinates\n   */\n  public worldToRegion(worldX: number, worldY: number): Vector2Int {\n    return {\n      x: Math.floor(worldX / this.config.regionSize),\n      y: Math.floor(worldY / this.config.regionSize),\n    };\n  }\n\n  /**\n   * Convert region coordinates to world coordinates (top-left corner)\n   */\n  public regionToWorld(regionX: number, regionY: number): Vector2Int {\n    return {\n      x: regionX * this.config.regionSize,\n      y: regionY * this.config.regionSize,\n    };\n  }\n\n  /**\n   * Get region ID from region coordinates\n   */\n  public getRegionId(regionX: number, regionY: number): string {\n    return `${regionX},${regionY}`;\n  }\n\n  /**\n   * Parse region ID to coordinates\n   */\n  public parseRegionId(id: string): Vector2Int {\n    const [x, y] = id.split(',').map(Number);\n    return { x, y };\n  }\n\n  /**\n   * Check if a region is currently loaded\n   */\n  public isRegionLoaded(regionX: number, regionY: number): boolean {\n    return this.loadedRegions.has(this.getRegionId(regionX, regionY));\n  }\n\n  /**\n   * Get a region by coordinates\n   */\n  public getRegion(regionX: number, regionY: number): RegionData | undefined {\n    return this.regions.get(this.getRegionId(regionX, regionY));\n  }\n\n  /**\n   * Get or create a region\n   */\n  public getOrCreateRegion(regionX: number, regionY: number): RegionData {\n    const id = this.getRegionId(regionX, regionY);\n    let region = this.regions.get(id);\n\n    if (!region) {\n      region = {\n        id,\n        position: { x: regionX, y: regionY },\n        tiles: new Map(),\n        isLoaded: false,\n        lastAccessTime: Date.now(),\n      };\n      this.regions.set(id, region);\n    }\n\n    return region;\n  }\n\n  /**\n   * Load a region\n   */\n  public loadRegion(regionX: number, regionY: number): RegionData {\n    const region = this.getOrCreateRegion(regionX, regionY);\n\n    if (!region.isLoaded) {\n      region.isLoaded = true;\n      region.lastAccessTime = Date.now();\n      this.loadedRegions.add(region.id);\n\n      const eventBus = getEventBus();\n      eventBus.emit('world:regionLoaded', {\n        regionId: region.id,\n        position: region.position,\n      });\n\n      console.log(`[RegionManager] Loaded region ${region.id}`);\n    }\n\n    return region;\n  }\n\n  /**\n   * Unload a region\n   */\n  public unloadRegion(regionX: number, regionY: number): void {\n    const id = this.getRegionId(regionX, regionY);\n    const region = this.regions.get(id);\n\n    if (region && region.isLoaded) {\n      region.isLoaded = false;\n      this.loadedRegions.delete(id);\n\n      const eventBus = getEventBus();\n      eventBus.emit('world:regionUnloaded', { regionId: id });\n\n      console.log(`[RegionManager] Unloaded region ${id}`);\n    }\n  }\n\n  /**\n   * Update which regions are loaded based on player position\n   */\n  private updateLoadedRegions(playerRegion: Vector2Int): void {\n    const { loadDistance, unloadDistance } = this.config;\n\n    // Determine which regions should be loaded\n    const shouldBeLoaded = new Set<string>();\n    for (let dx = -loadDistance; dx <= loadDistance; dx++) {\n      for (let dy = -loadDistance; dy <= loadDistance; dy++) {\n        const regionX = playerRegion.x + dx;\n        const regionY = playerRegion.y + dy;\n        shouldBeLoaded.add(this.getRegionId(regionX, regionY));\n      }\n    }\n\n    // Load new regions\n    for (const id of shouldBeLoaded) {\n      if (!this.loadedRegions.has(id)) {\n        const { x, y } = this.parseRegionId(id);\n        this.loadRegion(x, y);\n      }\n    }\n\n    // Unload distant regions\n    for (const id of this.loadedRegions) {\n      const { x, y } = this.parseRegionId(id);\n      const dx = Math.abs(x - playerRegion.x);\n      const dy = Math.abs(y - playerRegion.y);\n\n      if (dx > unloadDistance || dy > unloadDistance) {\n        this.unloadRegion(x, y);\n      }\n    }\n  }\n\n  /**\n   * Get all currently loaded regions\n   */\n  public getLoadedRegions(): RegionData[] {\n    const regions: RegionData[] = [];\n    for (const id of this.loadedRegions) {\n      const region = this.regions.get(id);\n      if (region) {\n        regions.push(region);\n      }\n    }\n    return regions;\n  }\n\n  /**\n   * Get the number of loaded regions\n   */\n  public getLoadedRegionCount(): number {\n    return this.loadedRegions.size;\n  }\n\n  /**\n   * Set tile data in a region\n   */\n  public setRegionTile(\n    worldX: number,\n    worldY: number,\n    layer: TileLayer,\n    tile: Tile\n  ): void {\n    const regionCoords = this.worldToRegion(worldX, worldY);\n    const region = this.getOrCreateRegion(regionCoords.x, regionCoords.y);\n\n    // Calculate local position within region\n    const localX = worldX - regionCoords.x * this.config.regionSize;\n    const localY = worldY - regionCoords.y * this.config.regionSize;\n    const key = `${localX},${localY},${layer}`;\n\n    region.tiles.set(key, tile);\n    region.lastAccessTime = Date.now();\n  }\n\n  /**\n   * Get tile data from a region\n   */\n  public getRegionTile(\n    worldX: number,\n    worldY: number,\n    layer: TileLayer\n  ): Tile | undefined {\n    const regionCoords = this.worldToRegion(worldX, worldY);\n    const region = this.regions.get(this.getRegionId(regionCoords.x, regionCoords.y));\n\n    if (!region) return undefined;\n\n    const localX = worldX - regionCoords.x * this.config.regionSize;\n    const localY = worldY - regionCoords.y * this.config.regionSize;\n    const key = `${localX},${localY},${layer}`;\n\n    region.lastAccessTime = Date.now();\n    return region.tiles.get(key);\n  }\n\n  /**\n   * Serialize a region for saving\n   */\n  public serializeRegion(regionX: number, regionY: number): {\n    id: string;\n    position: Vector2Int;\n    tiles: Array<{ key: string; tile: Tile }>;\n  } | null {\n    const region = this.getRegion(regionX, regionY);\n    if (!region) return null;\n\n    const tiles: Array<{ key: string; tile: Tile }> = [];\n    for (const [key, tile] of region.tiles) {\n      tiles.push({ key, tile });\n    }\n\n    return {\n      id: region.id,\n      position: region.position,\n      tiles,\n    };\n  }\n\n  /**\n   * Deserialize a region from save data\n   */\n  public deserializeRegion(data: {\n    id: string;\n    position: Vector2Int;\n    tiles: Array<{ key: string; tile: Tile }>;\n  }): void {\n    const region = this.getOrCreateRegion(data.position.x, data.position.y);\n\n    region.tiles.clear();\n    for (const { key, tile } of data.tiles) {\n      region.tiles.set(key, tile);\n    }\n  }\n\n  /**\n   * Clear all regions\n   */\n  public clear(): void {\n    this.regions.clear();\n    this.loadedRegions.clear();\n    this.lastPlayerRegion = { x: 0, y: 0 };\n  }\n\n  /**\n   * Get region size\n   */\n  public getRegionSize(): number {\n    return this.config.regionSize;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.clear();\n    console.log('[RegionManager] Destroyed');\n  }\n}\n","/**\n * NoiseGenerator - Procedural noise functions for world generation\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 World Generation:\n * - Perlin noise for height maps (4 octaves, scale 0.01)\n * - Simplex noise for moisture (3 octaves, scale 0.015)\n */\n\n// ============================================================================\n// Noise Configuration\n// ============================================================================\n\nexport interface NoiseConfig {\n  seed: number;\n  octaves: number;\n  scale: number;\n  persistence: number;  // Amplitude reduction per octave (0-1)\n  lacunarity: number;   // Frequency multiplier per octave\n}\n\nconst DEFAULT_PERLIN_CONFIG: NoiseConfig = {\n  seed: 12345,\n  octaves: 4,\n  scale: 0.01,\n  persistence: 0.5,\n  lacunarity: 2.0,\n};\n\nconst DEFAULT_SIMPLEX_CONFIG: NoiseConfig = {\n  seed: 54321,\n  octaves: 3,\n  scale: 0.015,\n  persistence: 0.5,\n  lacunarity: 2.0,\n};\n\n// ============================================================================\n// Permutation Table (for reproducible noise)\n// ============================================================================\n\nfunction createPermutationTable(seed: number): Uint8Array {\n  const perm = new Uint8Array(512);\n  const p = new Uint8Array(256);\n\n  // Initialize with values 0-255\n  for (let i = 0; i < 256; i++) {\n    p[i] = i;\n  }\n\n  // Shuffle using seed\n  let n = seed;\n  for (let i = 255; i > 0; i--) {\n    n = (n * 1103515245 + 12345) & 0x7fffffff;\n    const j = n % (i + 1);\n    [p[i], p[j]] = [p[j], p[i]];\n  }\n\n  // Duplicate for wrapping\n  for (let i = 0; i < 256; i++) {\n    perm[i] = p[i];\n    perm[i + 256] = p[i];\n  }\n\n  return perm;\n}\n\n// ============================================================================\n// Gradient Vectors\n// ============================================================================\n\nconst GRAD3 = [\n  [1, 1, 0], [-1, 1, 0], [1, -1, 0], [-1, -1, 0],\n  [1, 0, 1], [-1, 0, 1], [1, 0, -1], [-1, 0, -1],\n  [0, 1, 1], [0, -1, 1], [0, 1, -1], [0, -1, -1],\n];\n\n// ============================================================================\n// NoiseGenerator Implementation\n// ============================================================================\n\nexport class NoiseGenerator {\n  private perm: Uint8Array;\n  private seed: number;\n\n  constructor(seed: number = Date.now()) {\n    this.seed = seed;\n    this.perm = createPermutationTable(seed);\n  }\n\n  /**\n   * Get the seed used for this generator\n   */\n  public getSeed(): number {\n    return this.seed;\n  }\n\n  /**\n   * Reseed the generator\n   */\n  public reseed(seed: number): void {\n    this.seed = seed;\n    this.perm = createPermutationTable(seed);\n  }\n\n  // ==========================================================================\n  // Perlin Noise\n  // ==========================================================================\n\n  /**\n   * 2D Perlin noise at a single point\n   * Returns value in range [-1, 1]\n   */\n  public perlin2D(x: number, y: number): number {\n    // Find unit grid cell\n    const X = Math.floor(x) & 255;\n    const Y = Math.floor(y) & 255;\n\n    // Relative position in cell\n    const xf = x - Math.floor(x);\n    const yf = y - Math.floor(y);\n\n    // Fade curves\n    const u = this.fade(xf);\n    const v = this.fade(yf);\n\n    // Hash coordinates of the 4 corners\n    const aa = this.perm[this.perm[X] + Y];\n    const ab = this.perm[this.perm[X] + Y + 1];\n    const ba = this.perm[this.perm[X + 1] + Y];\n    const bb = this.perm[this.perm[X + 1] + Y + 1];\n\n    // Gradient values at corners\n    const gradAA = this.grad2D(aa, xf, yf);\n    const gradBA = this.grad2D(ba, xf - 1, yf);\n    const gradAB = this.grad2D(ab, xf, yf - 1);\n    const gradBB = this.grad2D(bb, xf - 1, yf - 1);\n\n    // Interpolate\n    const x1 = this.lerp(gradAA, gradBA, u);\n    const x2 = this.lerp(gradAB, gradBB, u);\n\n    return this.lerp(x1, x2, v);\n  }\n\n  /**\n   * Fractal Brownian Motion using Perlin noise\n   * Returns value in range [0, 1]\n   */\n  public perlinFBM(\n    x: number,\n    y: number,\n    config: Partial<NoiseConfig> = {}\n  ): number {\n    const { octaves, scale, persistence, lacunarity } = {\n      ...DEFAULT_PERLIN_CONFIG,\n      ...config,\n    };\n\n    let total = 0;\n    let amplitude = 1;\n    let frequency = scale;\n    let maxValue = 0;\n\n    for (let i = 0; i < octaves; i++) {\n      total += this.perlin2D(x * frequency, y * frequency) * amplitude;\n      maxValue += amplitude;\n      amplitude *= persistence;\n      frequency *= lacunarity;\n    }\n\n    // Normalize to [0, 1]\n    return (total / maxValue + 1) / 2;\n  }\n\n  // ==========================================================================\n  // Simplex Noise\n  // ==========================================================================\n\n  /**\n   * 2D Simplex noise at a single point\n   * Returns value in range [-1, 1]\n   */\n  public simplex2D(x: number, y: number): number {\n    const F2 = 0.5 * (Math.sqrt(3) - 1);\n    const G2 = (3 - Math.sqrt(3)) / 6;\n\n    // Skew input space\n    const s = (x + y) * F2;\n    const i = Math.floor(x + s);\n    const j = Math.floor(y + s);\n\n    // Unskew cell origin\n    const t = (i + j) * G2;\n    const X0 = i - t;\n    const Y0 = j - t;\n    const x0 = x - X0;\n    const y0 = y - Y0;\n\n    // Determine which simplex we're in\n    let i1: number, j1: number;\n    if (x0 > y0) {\n      i1 = 1;\n      j1 = 0;\n    } else {\n      i1 = 0;\n      j1 = 1;\n    }\n\n    // Offsets for corners\n    const x1 = x0 - i1 + G2;\n    const y1 = y0 - j1 + G2;\n    const x2 = x0 - 1 + 2 * G2;\n    const y2 = y0 - 1 + 2 * G2;\n\n    // Hash indices\n    const ii = i & 255;\n    const jj = j & 255;\n    const gi0 = this.perm[ii + this.perm[jj]] % 12;\n    const gi1 = this.perm[ii + i1 + this.perm[jj + j1]] % 12;\n    const gi2 = this.perm[ii + 1 + this.perm[jj + 1]] % 12;\n\n    // Calculate contributions\n    let n0 = 0, n1 = 0, n2 = 0;\n\n    let t0 = 0.5 - x0 * x0 - y0 * y0;\n    if (t0 >= 0) {\n      t0 *= t0;\n      n0 = t0 * t0 * this.dot2D(GRAD3[gi0], x0, y0);\n    }\n\n    let t1 = 0.5 - x1 * x1 - y1 * y1;\n    if (t1 >= 0) {\n      t1 *= t1;\n      n1 = t1 * t1 * this.dot2D(GRAD3[gi1], x1, y1);\n    }\n\n    let t2 = 0.5 - x2 * x2 - y2 * y2;\n    if (t2 >= 0) {\n      t2 *= t2;\n      n2 = t2 * t2 * this.dot2D(GRAD3[gi2], x2, y2);\n    }\n\n    // Scale to [-1, 1]\n    return 70 * (n0 + n1 + n2);\n  }\n\n  /**\n   * Fractal Brownian Motion using Simplex noise\n   * Returns value in range [0, 1]\n   */\n  public simplexFBM(\n    x: number,\n    y: number,\n    config: Partial<NoiseConfig> = {}\n  ): number {\n    const { octaves, scale, persistence, lacunarity } = {\n      ...DEFAULT_SIMPLEX_CONFIG,\n      ...config,\n    };\n\n    let total = 0;\n    let amplitude = 1;\n    let frequency = scale;\n    let maxValue = 0;\n\n    for (let i = 0; i < octaves; i++) {\n      total += this.simplex2D(x * frequency, y * frequency) * amplitude;\n      maxValue += amplitude;\n      amplitude *= persistence;\n      frequency *= lacunarity;\n    }\n\n    // Normalize to [0, 1]\n    return (total / maxValue + 1) / 2;\n  }\n\n  // ==========================================================================\n  // Voronoi Noise (for biome regions)\n  // ==========================================================================\n\n  /**\n   * 2D Voronoi noise (cellular noise)\n   * Returns the distance to nearest cell point, normalized to [0, 1]\n   */\n  public voronoi2D(x: number, y: number, scale: number = 0.005): number {\n    const sx = x * scale;\n    const sy = y * scale;\n\n    const cellX = Math.floor(sx);\n    const cellY = Math.floor(sy);\n\n    let minDist = 10;\n\n    // Check neighboring cells\n    for (let dx = -1; dx <= 1; dx++) {\n      for (let dy = -1; dy <= 1; dy++) {\n        const neighborX = cellX + dx;\n        const neighborY = cellY + dy;\n\n        // Get reproducible random point in this cell\n        const hash = this.perm[(neighborX & 255) + this.perm[neighborY & 255]];\n        const px = neighborX + (hash / 256);\n        const py = neighborY + ((hash * 7) % 256) / 256;\n\n        // Calculate distance\n        const distX = sx - px;\n        const distY = sy - py;\n        const dist = Math.sqrt(distX * distX + distY * distY);\n\n        if (dist < minDist) {\n          minDist = dist;\n        }\n      }\n    }\n\n    // Normalize to [0, 1]\n    return Math.min(minDist / 1.5, 1);\n  }\n\n  /**\n   * Get the cell ID for Voronoi (useful for biome assignment)\n   * Returns a stable ID for the cell containing this point\n   */\n  public voronoiCellId(x: number, y: number, scale: number = 0.005): number {\n    const sx = x * scale;\n    const sy = y * scale;\n\n    const cellX = Math.floor(sx);\n    const cellY = Math.floor(sy);\n\n    let minDist = 10;\n    let closestHash = 0;\n\n    // Check neighboring cells\n    for (let dx = -1; dx <= 1; dx++) {\n      for (let dy = -1; dy <= 1; dy++) {\n        const neighborX = cellX + dx;\n        const neighborY = cellY + dy;\n\n        const hash = this.perm[(neighborX & 255) + this.perm[neighborY & 255]];\n        const px = neighborX + (hash / 256);\n        const py = neighborY + ((hash * 7) % 256) / 256;\n\n        const distX = sx - px;\n        const distY = sy - py;\n        const dist = Math.sqrt(distX * distX + distY * distY);\n\n        if (dist < minDist) {\n          minDist = dist;\n          closestHash = (neighborX * 73856093) ^ (neighborY * 19349663);\n        }\n      }\n    }\n\n    return Math.abs(closestHash);\n  }\n\n  // ==========================================================================\n  // Helper Functions\n  // ==========================================================================\n\n  private fade(t: number): number {\n    return t * t * t * (t * (t * 6 - 15) + 10);\n  }\n\n  private lerp(a: number, b: number, t: number): number {\n    return a + t * (b - a);\n  }\n\n  private grad2D(hash: number, x: number, y: number): number {\n    const h = hash & 3;\n    const u = h < 2 ? x : y;\n    const v = h < 2 ? y : x;\n    return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);\n  }\n\n  private dot2D(g: number[], x: number, y: number): number {\n    return g[0] * x + g[1] * y;\n  }\n}\n\n// ============================================================================\n// Default Noise Configurations (per spec)\n// ============================================================================\n\nexport const NOISE_CONFIGS = {\n  height: {\n    octaves: 4,\n    scale: 0.01,\n    persistence: 0.5,\n    lacunarity: 2.0,\n  },\n  moisture: {\n    octaves: 3,\n    scale: 0.015,\n    persistence: 0.5,\n    lacunarity: 2.0,\n  },\n  temperature: {\n    octaves: 2,\n    scale: 0.008,\n    persistence: 0.6,\n    lacunarity: 2.0,\n  },\n};\n","/**\n * BiomeManager - Manages biome definitions and determination\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * Biomes are determined by height and moisture values.\n * Required: 5+ distinct biomes in average world.\n */\n\nimport { TileLayer } from '@core/types';\n\n// ============================================================================\n// Biome Types\n// ============================================================================\n\nexport enum BiomeType {\n  Ocean = 'ocean',\n  Beach = 'beach',\n  Desert = 'desert',\n  Plains = 'plains',\n  Forest = 'forest',\n  Swamp = 'swamp',\n  Mountains = 'mountains',\n  Snow = 'snow',\n  Tundra = 'tundra',\n  Jungle = 'jungle',\n}\n\nexport interface BiomeDefinition {\n  id: BiomeType;\n  name: string;\n  color: string;               // Debug/minimap color\n  groundTile: string;          // Default ground tile type\n  decorationTiles: string[];   // Possible decorations (trees, rocks, etc.)\n  decorationDensity: number;   // 0-1 chance per tile\n  resourceTiles: string[];     // Possible resources (ores, plants)\n  resourceDensity: number;     // 0-1 chance per tile\n  walkable: boolean;           // Can player walk here?\n  buildable: boolean;          // Can player build here?\n  hostileSpawnRate: number;    // Monsters per 100 tiles\n}\n\n// ============================================================================\n// Biome Definitions\n// ============================================================================\n\nconst BIOME_DEFINITIONS: Map<BiomeType, BiomeDefinition> = new Map([\n  [BiomeType.Ocean, {\n    id: BiomeType.Ocean,\n    name: 'Ocean',\n    color: '#1a5276',\n    groundTile: 'water_deep',\n    decorationTiles: ['seaweed', 'coral'],\n    decorationDensity: 0.05,\n    resourceTiles: ['fish_spot'],\n    resourceDensity: 0.02,\n    walkable: false,\n    buildable: false,\n    hostileSpawnRate: 0.5,\n  }],\n  [BiomeType.Beach, {\n    id: BiomeType.Beach,\n    name: 'Beach',\n    color: '#f9e79f',\n    groundTile: 'sand',\n    decorationTiles: ['palm_tree', 'shell', 'driftwood'],\n    decorationDensity: 0.08,\n    resourceTiles: ['coconut', 'crab'],\n    resourceDensity: 0.03,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.2,\n  }],\n  [BiomeType.Desert, {\n    id: BiomeType.Desert,\n    name: 'Desert',\n    color: '#f5b041',\n    groundTile: 'sand',\n    decorationTiles: ['cactus', 'dead_bush', 'skull'],\n    decorationDensity: 0.04,\n    resourceTiles: ['iron_ore', 'gold_ore'],\n    resourceDensity: 0.02,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.8,\n  }],\n  [BiomeType.Plains, {\n    id: BiomeType.Plains,\n    name: 'Plains',\n    color: '#82e0aa',\n    groundTile: 'grass',\n    decorationTiles: ['tall_grass', 'flower_red', 'flower_yellow', 'small_rock'],\n    decorationDensity: 0.15,\n    resourceTiles: ['berry_bush', 'fiber_plant'],\n    resourceDensity: 0.05,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.3,\n  }],\n  [BiomeType.Forest, {\n    id: BiomeType.Forest,\n    name: 'Forest',\n    color: '#1e8449',\n    groundTile: 'grass',\n    decorationTiles: ['tree_oak', 'tree_birch', 'bush', 'mushroom', 'fallen_log'],\n    decorationDensity: 0.35,\n    resourceTiles: ['wood_log', 'berry_bush', 'mushroom_edible', 'herb'],\n    resourceDensity: 0.08,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.5,\n  }],\n  [BiomeType.Swamp, {\n    id: BiomeType.Swamp,\n    name: 'Swamp',\n    color: '#6c7a32',\n    groundTile: 'mud',\n    decorationTiles: ['dead_tree', 'cattail', 'lily_pad', 'moss_rock'],\n    decorationDensity: 0.25,\n    resourceTiles: ['slime_mold', 'swamp_herb', 'clay'],\n    resourceDensity: 0.06,\n    walkable: true,\n    buildable: false,\n    hostileSpawnRate: 1.0,\n  }],\n  [BiomeType.Mountains, {\n    id: BiomeType.Mountains,\n    name: 'Mountains',\n    color: '#7f8c8d',\n    groundTile: 'stone',\n    decorationTiles: ['boulder', 'pine_tree', 'mountain_flower'],\n    decorationDensity: 0.12,\n    resourceTiles: ['iron_ore', 'copper_ore', 'coal', 'crystal'],\n    resourceDensity: 0.1,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.6,\n  }],\n  [BiomeType.Snow, {\n    id: BiomeType.Snow,\n    name: 'Snow',\n    color: '#ecf0f1',\n    groundTile: 'snow',\n    decorationTiles: ['pine_tree_snowy', 'ice_crystal', 'snowman'],\n    decorationDensity: 0.1,\n    resourceTiles: ['ice', 'frozen_herb'],\n    resourceDensity: 0.03,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.4,\n  }],\n  [BiomeType.Tundra, {\n    id: BiomeType.Tundra,\n    name: 'Tundra',\n    color: '#bdc3c7',\n    groundTile: 'frozen_grass',\n    decorationTiles: ['dead_bush', 'small_rock', 'lichen'],\n    decorationDensity: 0.08,\n    resourceTiles: ['fiber_plant', 'flint'],\n    resourceDensity: 0.04,\n    walkable: true,\n    buildable: true,\n    hostileSpawnRate: 0.3,\n  }],\n  [BiomeType.Jungle, {\n    id: BiomeType.Jungle,\n    name: 'Jungle',\n    color: '#145a32',\n    groundTile: 'jungle_grass',\n    decorationTiles: ['jungle_tree', 'giant_fern', 'vine', 'exotic_flower'],\n    decorationDensity: 0.45,\n    resourceTiles: ['tropical_fruit', 'rare_herb', 'bamboo'],\n    resourceDensity: 0.1,\n    walkable: true,\n    buildable: false,\n    hostileSpawnRate: 1.2,\n  }],\n]);\n\n// ============================================================================\n// Biome Determination Thresholds\n// ============================================================================\n\ninterface BiomeThresholds {\n  heightOcean: number;\n  heightBeach: number;\n  heightMountain: number;\n  heightSnow: number;\n  moistureDry: number;\n  moistureMedium: number;\n  moistureWet: number;\n  temperatureCold: number;\n  temperatureHot: number;\n}\n\nconst DEFAULT_THRESHOLDS: BiomeThresholds = {\n  heightOcean: 0.3,\n  heightBeach: 0.35,\n  heightMountain: 0.75,\n  heightSnow: 0.85,\n  moistureDry: 0.25,\n  moistureMedium: 0.5,\n  moistureWet: 0.75,\n  temperatureCold: 0.3,\n  temperatureHot: 0.7,\n};\n\n// ============================================================================\n// BiomeManager Implementation\n// ============================================================================\n\nexport class BiomeManager {\n  private thresholds: BiomeThresholds;\n\n  constructor(thresholds: Partial<BiomeThresholds> = {}) {\n    this.thresholds = { ...DEFAULT_THRESHOLDS, ...thresholds };\n  }\n\n  /**\n   * Determine biome based on height, moisture, and temperature\n   * @param height - Height value [0, 1] - 0 is lowest, 1 is highest\n   * @param moisture - Moisture value [0, 1] - 0 is driest, 1 is wettest\n   * @param temperature - Temperature value [0, 1] - 0 is coldest, 1 is hottest\n   */\n  public determineBiome(\n    height: number,\n    moisture: number,\n    temperature: number = 0.5\n  ): BiomeType {\n    const t = this.thresholds;\n\n    // Ocean (deep water)\n    if (height < t.heightOcean) {\n      return BiomeType.Ocean;\n    }\n\n    // Beach (transition zone)\n    if (height < t.heightBeach) {\n      return BiomeType.Beach;\n    }\n\n    // Snow peaks\n    if (height > t.heightSnow) {\n      return BiomeType.Snow;\n    }\n\n    // Mountains\n    if (height > t.heightMountain) {\n      return temperature < t.temperatureCold ? BiomeType.Snow : BiomeType.Mountains;\n    }\n\n    // Cold biomes\n    if (temperature < t.temperatureCold) {\n      return moisture < t.moistureMedium ? BiomeType.Tundra : BiomeType.Snow;\n    }\n\n    // Hot biomes\n    if (temperature > t.temperatureHot) {\n      if (moisture < t.moistureDry) return BiomeType.Desert;\n      if (moisture > t.moistureWet) return BiomeType.Jungle;\n      return BiomeType.Plains;\n    }\n\n    // Temperate biomes (based on moisture)\n    if (moisture < t.moistureDry) {\n      return BiomeType.Desert;\n    }\n    if (moisture < t.moistureMedium) {\n      return BiomeType.Plains;\n    }\n    if (moisture < t.moistureWet) {\n      return BiomeType.Forest;\n    }\n    return BiomeType.Swamp;\n  }\n\n  /**\n   * Get biome definition by type\n   */\n  public getBiomeDefinition(biome: BiomeType): BiomeDefinition {\n    return BIOME_DEFINITIONS.get(biome)!;\n  }\n\n  /**\n   * Get all biome definitions\n   */\n  public getAllBiomes(): BiomeDefinition[] {\n    return Array.from(BIOME_DEFINITIONS.values());\n  }\n\n  /**\n   * Check if a biome is walkable\n   */\n  public isWalkable(biome: BiomeType): boolean {\n    return this.getBiomeDefinition(biome).walkable;\n  }\n\n  /**\n   * Check if a biome is buildable\n   */\n  public isBuildable(biome: BiomeType): boolean {\n    return this.getBiomeDefinition(biome).buildable;\n  }\n\n  /**\n   * Get ground tile for a biome\n   */\n  public getGroundTile(biome: BiomeType): string {\n    return this.getBiomeDefinition(biome).groundTile;\n  }\n\n  /**\n   * Get random decoration for a biome (or null based on density)\n   */\n  public getRandomDecoration(biome: BiomeType, random: number): string | null {\n    const def = this.getBiomeDefinition(biome);\n    if (random > def.decorationDensity || def.decorationTiles.length === 0) {\n      return null;\n    }\n    const index = Math.floor(random * def.decorationTiles.length / def.decorationDensity);\n    return def.decorationTiles[index % def.decorationTiles.length];\n  }\n\n  /**\n   * Get random resource for a biome (or null based on density)\n   */\n  public getRandomResource(biome: BiomeType, random: number): string | null {\n    const def = this.getBiomeDefinition(biome);\n    if (random > def.resourceDensity || def.resourceTiles.length === 0) {\n      return null;\n    }\n    const index = Math.floor(random * def.resourceTiles.length / def.resourceDensity);\n    return def.resourceTiles[index % def.resourceTiles.length];\n  }\n\n  /**\n   * Get spawn rate for hostile creatures in a biome\n   */\n  public getHostileSpawnRate(biome: BiomeType): number {\n    return this.getBiomeDefinition(biome).hostileSpawnRate;\n  }\n}\n\n// Export singleton instance\nlet biomeManagerInstance: BiomeManager | null = null;\n\nexport function getBiomeManager(): BiomeManager {\n  if (!biomeManagerInstance) {\n    biomeManagerInstance = new BiomeManager();\n  }\n  return biomeManagerInstance;\n}\n","/**\n * WorldGenerator - Procedural world generation\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * - Noise-based terrain generation\n * - Biome determination from height/moisture\n * - Target: < 10 seconds for starting region\n * - 5+ distinct biomes in average world\n */\n\nimport { NoiseGenerator, NOISE_CONFIGS } from './NoiseGenerator';\nimport { BiomeManager, BiomeType, getBiomeManager } from './BiomeManager';\nimport { TileLayer } from '@core/types';\n\n// ============================================================================\n// World Generation Config\n// ============================================================================\n\nexport interface WorldGenConfig {\n  seed: number;\n  regionSize: number;              // Tiles per region (should match RegionManager)\n  seaLevel: number;                // Height below which is water\n  temperatureLatitudeScale: number; // How temperature varies with Y\n  spawnAreaSize: number;           // Safe starting area radius\n}\n\nconst DEFAULT_CONFIG: WorldGenConfig = {\n  seed: Date.now(),\n  regionSize: 64,\n  seaLevel: 0.35,\n  temperatureLatitudeScale: 0.001,\n  spawnAreaSize: 32,\n};\n\n// ============================================================================\n// Generated Tile Data\n// ============================================================================\n\nexport interface GeneratedTile {\n  x: number;\n  y: number;\n  layer: TileLayer;\n  tileId: string;\n  biome: BiomeType;\n}\n\nexport interface GeneratedRegion {\n  regionX: number;\n  regionY: number;\n  tiles: GeneratedTile[];\n  biomeDistribution: Map<BiomeType, number>;\n  generationTimeMs: number;\n}\n\n// ============================================================================\n// WorldGenerator Implementation\n// ============================================================================\n\nexport class WorldGenerator {\n  private config: WorldGenConfig;\n  private noise: NoiseGenerator;\n  private biomeManager: BiomeManager;\n\n  constructor(config: Partial<WorldGenConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.noise = new NoiseGenerator(this.config.seed);\n    this.biomeManager = getBiomeManager();\n  }\n\n  /**\n   * Get the world seed\n   */\n  public getSeed(): number {\n    return this.config.seed;\n  }\n\n  /**\n   * Generate a region at the specified region coordinates\n   */\n  public generateRegion(regionX: number, regionY: number): GeneratedRegion {\n    const startTime = performance.now();\n    const tiles: GeneratedTile[] = [];\n    const biomeDistribution = new Map<BiomeType, number>();\n    const { regionSize } = this.config;\n\n    // Calculate world coordinates for this region\n    const worldStartX = regionX * regionSize;\n    const worldStartY = regionY * regionSize;\n\n    // Generate each tile in the region\n    for (let localX = 0; localX < regionSize; localX++) {\n      for (let localY = 0; localY < regionSize; localY++) {\n        const worldX = worldStartX + localX;\n        const worldY = worldStartY + localY;\n\n        const generatedTiles = this.generateTile(worldX, worldY);\n        tiles.push(...generatedTiles);\n\n        // Track biome distribution\n        if (generatedTiles.length > 0) {\n          const biome = generatedTiles[0].biome;\n          biomeDistribution.set(biome, (biomeDistribution.get(biome) ?? 0) + 1);\n        }\n      }\n    }\n\n    const generationTimeMs = performance.now() - startTime;\n\n    return {\n      regionX,\n      regionY,\n      tiles,\n      biomeDistribution,\n      generationTimeMs,\n    };\n  }\n\n  /**\n   * Generate tiles at a specific world coordinate\n   * Returns tiles for all relevant layers\n   */\n  public generateTile(worldX: number, worldY: number): GeneratedTile[] {\n    const tiles: GeneratedTile[] = [];\n\n    // Generate noise values\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const moisture = this.noise.simplexFBM(worldX, worldY, NOISE_CONFIGS.moisture);\n    const temperature = this.getTemperature(worldX, worldY);\n\n    // Determine biome\n    const biome = this.biomeManager.determineBiome(height, moisture, temperature);\n    const biomeDef = this.biomeManager.getBiomeDefinition(biome);\n\n    // Ground layer (always present)\n    tiles.push({\n      x: worldX,\n      y: worldY,\n      layer: TileLayer.Ground,\n      tileId: biomeDef.groundTile,\n      biome,\n    });\n\n    // Generate decoration/object layer based on biome\n    const decorationRandom = this.noise.perlin2D(worldX * 0.5 + 1000, worldY * 0.5) * 0.5 + 0.5;\n    const decoration = this.biomeManager.getRandomDecoration(biome, decorationRandom);\n    if (decoration) {\n      tiles.push({\n        x: worldX,\n        y: worldY,\n        layer: TileLayer.Objects,\n        tileId: decoration,\n        biome,\n      });\n    }\n\n    // Generate resources (separate noise channel)\n    const resourceRandom = this.noise.simplex2D(worldX * 0.3 + 2000, worldY * 0.3) * 0.5 + 0.5;\n    const resource = this.biomeManager.getRandomResource(biome, resourceRandom);\n    if (resource && !decoration) {\n      // Only place resource if no decoration\n      tiles.push({\n        x: worldX,\n        y: worldY,\n        layer: TileLayer.Objects,\n        tileId: resource,\n        biome,\n      });\n    }\n\n    return tiles;\n  }\n\n  /**\n   * Get temperature at a world position\n   * Temperature varies with Y coordinate to simulate latitude\n   */\n  private getTemperature(worldX: number, worldY: number): number {\n    const { temperatureLatitudeScale } = this.config;\n\n    // Base temperature from noise\n    const baseTemp = this.noise.simplexFBM(\n      worldX + 5000,\n      worldY + 5000,\n      NOISE_CONFIGS.temperature\n    );\n\n    // Latitude effect (colder at higher Y values, simulating going north)\n    const latitudeEffect = 1 - Math.abs(worldY * temperatureLatitudeScale);\n\n    // Altitude effect (colder at higher elevations)\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const altitudeEffect = 1 - Math.max(0, (height - 0.5) * 0.5);\n\n    return Math.max(0, Math.min(1, baseTemp * 0.5 + latitudeEffect * 0.3 + altitudeEffect * 0.2));\n  }\n\n  /**\n   * Get spawn point (safe starting location)\n   */\n  public findSpawnPoint(): { x: number; y: number } {\n    const { spawnAreaSize } = this.config;\n\n    // Search for a suitable spawn point near origin\n    for (let radius = 0; radius < 100; radius += 5) {\n      for (let angle = 0; angle < Math.PI * 2; angle += Math.PI / 8) {\n        const x = Math.round(Math.cos(angle) * radius);\n        const y = Math.round(Math.sin(angle) * radius);\n\n        if (this.isSuitableSpawn(x, y)) {\n          return { x, y };\n        }\n      }\n    }\n\n    // Fallback to origin\n    return { x: 0, y: 0 };\n  }\n\n  /**\n   * Check if a location is suitable for spawning\n   */\n  private isSuitableSpawn(x: number, y: number): boolean {\n    const tiles = this.generateTile(x, y);\n    if (tiles.length === 0) return false;\n\n    const biome = tiles[0].biome;\n\n    // Must be walkable and buildable\n    if (!this.biomeManager.isWalkable(biome)) return false;\n    if (!this.biomeManager.isBuildable(biome)) return false;\n\n    // Prefer low hostile spawn rate\n    if (this.biomeManager.getHostileSpawnRate(biome) > 0.5) return false;\n\n    // Prefer plains or forest (good starting biomes)\n    return biome === BiomeType.Plains || biome === BiomeType.Forest;\n  }\n\n  /**\n   * Get the biome at a world position\n   */\n  public getBiomeAt(worldX: number, worldY: number): BiomeType {\n    const height = this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n    const moisture = this.noise.simplexFBM(worldX, worldY, NOISE_CONFIGS.moisture);\n    const temperature = this.getTemperature(worldX, worldY);\n\n    return this.biomeManager.determineBiome(height, moisture, temperature);\n  }\n\n  /**\n   * Get height at a world position (for pathfinding, etc.)\n   */\n  public getHeightAt(worldX: number, worldY: number): number {\n    return this.noise.perlinFBM(worldX, worldY, NOISE_CONFIGS.height);\n  }\n\n  /**\n   * Check if position is above water\n   */\n  public isLand(worldX: number, worldY: number): boolean {\n    return this.getHeightAt(worldX, worldY) >= this.config.seaLevel;\n  }\n\n  /**\n   * Validate world generation (for testing)\n   * Generates a sample area and checks biome diversity\n   */\n  public validateGeneration(sampleSize: number = 1000): {\n    valid: boolean;\n    biomeCount: number;\n    biomeCounts: Map<BiomeType, number>;\n    averageGenerationTime: number;\n  } {\n    const biomeCounts = new Map<BiomeType, number>();\n    let totalTime = 0;\n    const samples = Math.sqrt(sampleSize);\n\n    for (let i = 0; i < samples; i++) {\n      for (let j = 0; j < samples; j++) {\n        const x = (i - samples / 2) * 10;\n        const y = (j - samples / 2) * 10;\n\n        const start = performance.now();\n        const biome = this.getBiomeAt(x, y);\n        totalTime += performance.now() - start;\n\n        biomeCounts.set(biome, (biomeCounts.get(biome) ?? 0) + 1);\n      }\n    }\n\n    const biomeCount = biomeCounts.size;\n    const valid = biomeCount >= 5; // Spec requires 5+ distinct biomes\n\n    return {\n      valid,\n      biomeCount,\n      biomeCounts,\n      averageGenerationTime: totalTime / sampleSize,\n    };\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet worldGeneratorInstance: WorldGenerator | null = null;\n\nexport function getWorldGenerator(seed?: number): WorldGenerator {\n  if (!worldGeneratorInstance || seed !== undefined) {\n    worldGeneratorInstance = new WorldGenerator(seed !== undefined ? { seed } : {});\n  }\n  return worldGeneratorInstance;\n}\n\nexport function resetWorldGenerator(): void {\n  worldGeneratorInstance = null;\n}\n","/**\n * PlayerController - Handles player movement and state\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Player Controller:\n * States: Idle, Walking, Running, Interacting, InMenu, Combat\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport { Direction } from '@core/types';\nimport type { Vector2, GameTime, InputAction } from '@core/types';\n\n// ============================================================================\n// Player State\n// ============================================================================\n\nexport enum PlayerState {\n  Idle = 'idle',\n  Walking = 'walking',\n  Running = 'running',\n  Interacting = 'interacting',\n  InMenu = 'inMenu',\n  Combat = 'combat',\n}\n\n// ============================================================================\n// Player Configuration\n// ============================================================================\n\nexport interface PlayerConfig {\n  walkSpeed: number;\n  runSpeed: number;\n  acceleration: number;\n  deceleration: number;\n}\n\nconst DEFAULT_CONFIG: PlayerConfig = {\n  walkSpeed: 4,      // Tiles per second\n  runSpeed: 7,       // Tiles per second when sprinting\n  acceleration: 20,  // How fast to reach max speed\n  deceleration: 15,  // How fast to stop\n};\n\n// ============================================================================\n// PlayerController Implementation\n// ============================================================================\n\nexport class PlayerController implements GameSystem {\n  public readonly name = 'PlayerController';\n\n  private config: PlayerConfig;\n  private position: Vector2 = { x: 0, y: 0 };\n  private velocity: Vector2 = { x: 0, y: 0 };\n  private facing: Direction = Direction.South;\n  private state: PlayerState = PlayerState.Idle;\n\n  // Input state\n  private moveInput: Vector2 = { x: 0, y: 0 };\n  private digitalMoveInput: Vector2 = { x: 0, y: 0 }; // D-pad/keyboard\n  private analogMoveInput: Vector2 = { x: 0, y: 0 };  // Left stick\n  private isSprinting = false;\n\n  // Collision callback (set by game to check tile walkability)\n  private checkWalkable: ((x: number, y: number) => boolean) | null = null;\n\n  constructor(config: Partial<PlayerConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the player controller\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Subscribe to input events\n    eventBus.on('input:actionPressed', this.onActionPressed.bind(this));\n    eventBus.on('input:actionReleased', this.onActionReleased.bind(this));\n\n    // Subscribe to gamepad analog stick for smooth movement\n    eventBus.on('input:leftStickMoved', this.onLeftStickMoved.bind(this));\n\n    console.log('[PlayerController] Initialized');\n  }\n\n  /**\n   * Set the walkability check function\n   */\n  public setWalkableCheck(fn: (x: number, y: number) => boolean): void {\n    this.checkWalkable = fn;\n  }\n\n  /**\n   * Handle action pressed events (digital input: keyboard/D-pad)\n   */\n  private onActionPressed(event: { action: string }): void {\n    switch (event.action) {\n      case 'moveUp':\n        this.digitalMoveInput.y = -1;\n        break;\n      case 'moveDown':\n        this.digitalMoveInput.y = 1;\n        break;\n      case 'moveLeft':\n        this.digitalMoveInput.x = -1;\n        break;\n      case 'moveRight':\n        this.digitalMoveInput.x = 1;\n        break;\n      case 'sprint':\n        this.isSprinting = true;\n        break;\n      case 'interact':\n        this.interact();\n        break;\n    }\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Handle action released events (digital input: keyboard/D-pad)\n   */\n  private onActionReleased(event: { action: string }): void {\n    switch (event.action) {\n      case 'moveUp':\n        if (this.digitalMoveInput.y < 0) this.digitalMoveInput.y = 0;\n        break;\n      case 'moveDown':\n        if (this.digitalMoveInput.y > 0) this.digitalMoveInput.y = 0;\n        break;\n      case 'moveLeft':\n        if (this.digitalMoveInput.x < 0) this.digitalMoveInput.x = 0;\n        break;\n      case 'moveRight':\n        if (this.digitalMoveInput.x > 0) this.digitalMoveInput.x = 0;\n        break;\n      case 'sprint':\n        this.isSprinting = false;\n        break;\n    }\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Handle left stick input (analog input from gamepad)\n   */\n  private onLeftStickMoved(event: { x: number; y: number }): void {\n    this.analogMoveInput = { x: event.x, y: event.y };\n    this.updateCombinedInput();\n  }\n\n  /**\n   * Combine digital and analog input (analog takes priority when active)\n   */\n  private updateCombinedInput(): void {\n    const analogLength = Math.sqrt(\n      this.analogMoveInput.x ** 2 + this.analogMoveInput.y ** 2\n    );\n\n    // Use analog if active (magnitude > small threshold), otherwise digital\n    if (analogLength > 0.1) {\n      this.moveInput = { ...this.analogMoveInput };\n    } else {\n      this.moveInput = { ...this.digitalMoveInput };\n    }\n  }\n\n  /**\n   * Fixed update for physics\n   */\n  public fixedUpdate(fixedDeltaTime: number, _gameTime: GameTime): void {\n    if (this.state === PlayerState.InMenu || this.state === PlayerState.Interacting) {\n      return;\n    }\n\n    this.updateMovement(fixedDeltaTime);\n  }\n\n  /**\n   * Update movement physics\n   */\n  private updateMovement(deltaTime: number): void {\n    const { acceleration, deceleration, walkSpeed, runSpeed } = this.config;\n\n    // Normalize input\n    let inputX = this.moveInput.x;\n    let inputY = this.moveInput.y;\n    const inputLength = Math.sqrt(inputX * inputX + inputY * inputY);\n    if (inputLength > 1) {\n      inputX /= inputLength;\n      inputY /= inputLength;\n    }\n\n    // Calculate target velocity\n    const maxSpeed = this.isSprinting ? runSpeed : walkSpeed;\n    const targetVelX = inputX * maxSpeed;\n    const targetVelY = inputY * maxSpeed;\n\n    // Apply acceleration/deceleration\n    if (inputLength > 0) {\n      // Accelerate toward target\n      this.velocity.x = this.approach(this.velocity.x, targetVelX, acceleration * deltaTime);\n      this.velocity.y = this.approach(this.velocity.y, targetVelY, acceleration * deltaTime);\n    } else {\n      // Decelerate to stop\n      this.velocity.x = this.approach(this.velocity.x, 0, deceleration * deltaTime);\n      this.velocity.y = this.approach(this.velocity.y, 0, deceleration * deltaTime);\n    }\n\n    // Calculate new position\n    const newX = this.position.x + this.velocity.x * deltaTime;\n    const newY = this.position.y + this.velocity.y * deltaTime;\n\n    // Check collision (simple tile-based check)\n    const canMoveX = this.canMoveTo(newX, this.position.y);\n    const canMoveY = this.canMoveTo(this.position.x, newY);\n\n    const oldPosition = { ...this.position };\n\n    if (canMoveX) {\n      this.position.x = newX;\n    } else {\n      this.velocity.x = 0;\n    }\n\n    if (canMoveY) {\n      this.position.y = newY;\n    } else {\n      this.velocity.y = 0;\n    }\n\n    // Update facing direction\n    if (inputLength > 0) {\n      this.facing = this.calculateFacing(inputX, inputY);\n    }\n\n    // Update state\n    this.updateState();\n\n    // Emit movement event if position changed\n    if (this.position.x !== oldPosition.x || this.position.y !== oldPosition.y) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:moved', { position: { ...this.position } });\n    }\n  }\n\n  /**\n   * Check if player can move to a position\n   */\n  private canMoveTo(x: number, y: number): boolean {\n    if (!this.checkWalkable) {\n      return true; // No collision check set, allow movement\n    }\n\n    // Check the tile at the target position\n    const tileX = Math.floor(x);\n    const tileY = Math.floor(y);\n\n    return this.checkWalkable(tileX, tileY);\n  }\n\n  /**\n   * Calculate facing direction from input\n   */\n  private calculateFacing(inputX: number, inputY: number): Direction {\n    // Prioritize vertical movement for diagonal\n    if (Math.abs(inputY) >= Math.abs(inputX)) {\n      return inputY < 0 ? Direction.North : Direction.South;\n    } else {\n      return inputX < 0 ? Direction.West : Direction.East;\n    }\n  }\n\n  /**\n   * Update player state based on current conditions\n   */\n  private updateState(): void {\n    const speed = Math.sqrt(this.velocity.x ** 2 + this.velocity.y ** 2);\n\n    if (speed < 0.1) {\n      this.state = PlayerState.Idle;\n    } else if (this.isSprinting && speed > this.config.walkSpeed * 0.9) {\n      this.state = PlayerState.Running;\n    } else {\n      this.state = PlayerState.Walking;\n    }\n  }\n\n  /**\n   * Handle interaction\n   */\n  private interact(): void {\n    // Calculate the tile in front of the player\n    const targetX = Math.floor(this.position.x + this.getFacingOffset().x);\n    const targetY = Math.floor(this.position.y + this.getFacingOffset().y);\n\n    const eventBus = getEventBus();\n    eventBus.emit('player:interacted', {\n      targetId: null,\n      position: { x: targetX, y: targetY },\n    });\n  }\n\n  /**\n   * Get the offset for the facing direction\n   */\n  private getFacingOffset(): Vector2 {\n    switch (this.facing) {\n      case Direction.North:\n        return { x: 0, y: -1 };\n      case Direction.South:\n        return { x: 0, y: 1 };\n      case Direction.East:\n        return { x: 1, y: 0 };\n      case Direction.West:\n        return { x: -1, y: 0 };\n      default:\n        return { x: 0, y: 0 };\n    }\n  }\n\n  /**\n   * Approach a target value at a given rate\n   */\n  private approach(current: number, target: number, rate: number): number {\n    if (current < target) {\n      return Math.min(current + rate, target);\n    } else {\n      return Math.max(current - rate, target);\n    }\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Get current position\n   */\n  public getPosition(): Readonly<Vector2> {\n    return this.position;\n  }\n\n  /**\n   * Set position (e.g., for teleportation or loading)\n   */\n  public setPosition(x: number, y: number): void {\n    this.position = { x, y };\n    this.velocity = { x: 0, y: 0 };\n\n    const eventBus = getEventBus();\n    eventBus.emit('player:moved', { position: { ...this.position } });\n  }\n\n  /**\n   * Get current velocity\n   */\n  public getVelocity(): Readonly<Vector2> {\n    return this.velocity;\n  }\n\n  /**\n   * Get current facing direction\n   */\n  public getFacing(): Direction {\n    return this.facing;\n  }\n\n  /**\n   * Get current state\n   */\n  public getState(): PlayerState {\n    return this.state;\n  }\n\n  /**\n   * Set state (e.g., for entering menus)\n   */\n  public setState(state: PlayerState): void {\n    this.state = state;\n\n    // Reset velocity when entering menu/interacting\n    if (state === PlayerState.InMenu || state === PlayerState.Interacting) {\n      this.velocity = { x: 0, y: 0 };\n    }\n  }\n\n  /**\n   * Check if player is moving\n   */\n  public isMoving(): boolean {\n    return this.state === PlayerState.Walking || this.state === PlayerState.Running;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[PlayerController] Destroyed');\n  }\n}\n","/**\n * CameraSystem - Smooth camera following for the player\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Camera Settings:\n * - Follow speed: 5.0\n * - Deadzone: 0.5 units\n * - Zoom range: 0.5x to 2.0x\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { Vector2, Bounds, GameTime } from '@core/types';\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nexport interface CameraConfig {\n  followSpeed: number;      // How fast camera follows target\n  deadzone: number;         // Distance before camera starts moving\n  minZoom: number;          // Minimum zoom level\n  maxZoom: number;          // Maximum zoom level\n  zoomSpeed: number;        // How fast zoom changes\n  shakeDecay: number;       // How fast shake diminishes\n  viewportWidth: number;    // Viewport width in tiles\n  viewportHeight: number;   // Viewport height in tiles\n}\n\nconst DEFAULT_CONFIG: CameraConfig = {\n  followSpeed: 5.0,\n  deadzone: 0.5,\n  minZoom: 0.5,\n  maxZoom: 2.0,\n  zoomSpeed: 2.0,\n  shakeDecay: 5.0,\n  viewportWidth: 20,\n  viewportHeight: 15,\n};\n\n// ============================================================================\n// CameraSystem Implementation\n// ============================================================================\n\nexport class CameraSystem implements GameSystem {\n  public readonly name = 'CameraSystem';\n\n  private config: CameraConfig;\n  private position: Vector2 = { x: 0, y: 0 };\n  private targetPosition: Vector2 = { x: 0, y: 0 };\n  private zoom = 1.0;\n  private targetZoom = 1.0;\n\n  // Screen shake\n  private shakeIntensity = 0;\n  private shakeOffset: Vector2 = { x: 0, y: 0 };\n\n  // Bounds (optional camera limits)\n  private bounds: Bounds | null = null;\n\n  constructor(config: Partial<CameraConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n  }\n\n  /**\n   * Initialize the camera system\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for player movement\n    eventBus.on('player:moved', (event) => {\n      this.setTarget(event.position.x, event.position.y);\n    });\n\n    // Listen for zoom input\n    eventBus.on('input:actionPressed', (event) => {\n      if (event.action === 'zoomIn') {\n        this.zoomIn();\n      } else if (event.action === 'zoomOut') {\n        this.zoomOut();\n      }\n    });\n\n    console.log('[CameraSystem] Initialized');\n  }\n\n  /**\n   * Late update - camera follows after all other updates\n   */\n  public lateUpdate(deltaTime: number, _gameTime: GameTime): void {\n    this.updateFollow(deltaTime);\n    this.updateZoom(deltaTime);\n    this.updateShake(deltaTime);\n  }\n\n  /**\n   * Update camera following\n   */\n  private updateFollow(deltaTime: number): void {\n    const { followSpeed, deadzone } = this.config;\n\n    // Calculate distance to target\n    const dx = this.targetPosition.x - this.position.x;\n    const dy = this.targetPosition.y - this.position.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n\n    // Only move if outside deadzone\n    if (distance > deadzone) {\n      // Calculate movement\n      const moveAmount = followSpeed * deltaTime;\n\n      if (moveAmount >= distance) {\n        // Snap to target if we'd overshoot\n        this.position.x = this.targetPosition.x;\n        this.position.y = this.targetPosition.y;\n      } else {\n        // Move toward target\n        const ratio = moveAmount / distance;\n        this.position.x += dx * ratio;\n        this.position.y += dy * ratio;\n      }\n    }\n\n    // Apply bounds if set\n    if (this.bounds) {\n      this.clampToBounds();\n    }\n  }\n\n  /**\n   * Update zoom level\n   */\n  private updateZoom(deltaTime: number): void {\n    if (this.zoom !== this.targetZoom) {\n      const { zoomSpeed } = this.config;\n      const diff = this.targetZoom - this.zoom;\n      const change = zoomSpeed * deltaTime;\n\n      if (Math.abs(diff) <= change) {\n        this.zoom = this.targetZoom;\n      } else {\n        this.zoom += Math.sign(diff) * change;\n      }\n    }\n  }\n\n  /**\n   * Update screen shake\n   */\n  private updateShake(deltaTime: number): void {\n    if (this.shakeIntensity > 0) {\n      // Generate random shake offset\n      const angle = Math.random() * Math.PI * 2;\n      this.shakeOffset.x = Math.cos(angle) * this.shakeIntensity;\n      this.shakeOffset.y = Math.sin(angle) * this.shakeIntensity;\n\n      // Decay shake\n      this.shakeIntensity -= this.config.shakeDecay * deltaTime;\n      if (this.shakeIntensity < 0) {\n        this.shakeIntensity = 0;\n        this.shakeOffset.x = 0;\n        this.shakeOffset.y = 0;\n      }\n    }\n  }\n\n  /**\n   * Clamp camera position to bounds\n   */\n  private clampToBounds(): void {\n    if (!this.bounds) return;\n\n    const halfWidth = this.getViewWidth() / 2;\n    const halfHeight = this.getViewHeight() / 2;\n\n    this.position.x = Math.max(\n      this.bounds.x + halfWidth,\n      Math.min(this.bounds.x + this.bounds.width - halfWidth, this.position.x)\n    );\n\n    this.position.y = Math.max(\n      this.bounds.y + halfHeight,\n      Math.min(this.bounds.y + this.bounds.height - halfHeight, this.position.y)\n    );\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Set camera target position\n   */\n  public setTarget(x: number, y: number): void {\n    this.targetPosition.x = x;\n    this.targetPosition.y = y;\n  }\n\n  /**\n   * Immediately snap camera to position\n   */\n  public snapTo(x: number, y: number): void {\n    this.position.x = x;\n    this.position.y = y;\n    this.targetPosition.x = x;\n    this.targetPosition.y = y;\n  }\n\n  /**\n   * Get camera position (with shake applied)\n   */\n  public getPosition(): Readonly<Vector2> {\n    return {\n      x: this.position.x + this.shakeOffset.x,\n      y: this.position.y + this.shakeOffset.y,\n    };\n  }\n\n  /**\n   * Get raw camera position (without shake)\n   */\n  public getRawPosition(): Readonly<Vector2> {\n    return this.position;\n  }\n\n  /**\n   * Get current zoom level\n   */\n  public getZoom(): number {\n    return this.zoom;\n  }\n\n  /**\n   * Set zoom level\n   */\n  public setZoom(zoom: number): void {\n    this.targetZoom = Math.max(this.config.minZoom, Math.min(this.config.maxZoom, zoom));\n  }\n\n  /**\n   * Zoom in\n   */\n  public zoomIn(): void {\n    this.setZoom(this.targetZoom * 1.2);\n  }\n\n  /**\n   * Zoom out\n   */\n  public zoomOut(): void {\n    this.setZoom(this.targetZoom / 1.2);\n  }\n\n  /**\n   * Add screen shake\n   */\n  public shake(intensity: number): void {\n    this.shakeIntensity = Math.max(this.shakeIntensity, intensity);\n  }\n\n  /**\n   * Set camera bounds\n   */\n  public setBounds(bounds: Bounds | null): void {\n    this.bounds = bounds;\n    if (bounds) {\n      this.clampToBounds();\n    }\n  }\n\n  /**\n   * Get visible area in world coordinates\n   */\n  public getViewBounds(): Bounds {\n    const halfWidth = this.getViewWidth() / 2;\n    const halfHeight = this.getViewHeight() / 2;\n    const pos = this.getPosition();\n\n    return {\n      x: pos.x - halfWidth,\n      y: pos.y - halfHeight,\n      width: this.getViewWidth(),\n      height: this.getViewHeight(),\n    };\n  }\n\n  /**\n   * Get view width in world units\n   */\n  public getViewWidth(): number {\n    return this.config.viewportWidth / this.zoom;\n  }\n\n  /**\n   * Get view height in world units\n   */\n  public getViewHeight(): number {\n    return this.config.viewportHeight / this.zoom;\n  }\n\n  /**\n   * Convert screen coordinates to world coordinates\n   */\n  public screenToWorld(screenX: number, screenY: number, screenWidth: number, screenHeight: number): Vector2 {\n    const pos = this.getPosition();\n    const viewWidth = this.getViewWidth();\n    const viewHeight = this.getViewHeight();\n\n    return {\n      x: pos.x + (screenX / screenWidth - 0.5) * viewWidth,\n      y: pos.y + (screenY / screenHeight - 0.5) * viewHeight,\n    };\n  }\n\n  /**\n   * Convert world coordinates to screen coordinates\n   */\n  public worldToScreen(worldX: number, worldY: number, screenWidth: number, screenHeight: number): Vector2 {\n    const pos = this.getPosition();\n    const viewWidth = this.getViewWidth();\n    const viewHeight = this.getViewHeight();\n\n    return {\n      x: ((worldX - pos.x) / viewWidth + 0.5) * screenWidth,\n      y: ((worldY - pos.y) / viewHeight + 0.5) * screenHeight,\n    };\n  }\n\n  /**\n   * Check if a world position is visible\n   */\n  public isVisible(worldX: number, worldY: number, margin = 0): boolean {\n    const bounds = this.getViewBounds();\n    return (\n      worldX >= bounds.x - margin &&\n      worldX <= bounds.x + bounds.width + margin &&\n      worldY >= bounds.y - margin &&\n      worldY <= bounds.y + bounds.height + margin\n    );\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[CameraSystem] Destroyed');\n  }\n}\n","/**\n * SaveManager - Handles game state persistence\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Save System:\n * - JSON serialization\n * - Version migrations\n * - Save slot management\n * - Target: < 5 seconds for 10 regions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { SaveData, SaveMetadata, Vector2, GameTime } from '@core/types';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst SAVE_VERSION = '0.1.0';\nconst STORAGE_PREFIX = 'voxel_rpg_save_';\nconst MAX_SAVE_SLOTS = 10;\n\n// ============================================================================\n// Save Slot Info\n// ============================================================================\n\nexport interface SaveSlotInfo {\n  slot: string;\n  exists: boolean;\n  metadata?: SaveMetadata;\n}\n\n// ============================================================================\n// Serializable Game State Interface\n// ============================================================================\n\nexport interface GameStateProvider {\n  getPlayerPosition(): Vector2;\n  getPlayerHealth(): number;\n  getPlayerMaxHealth(): number;\n  getPlayerInventory(): Array<{ itemId: string; quantity: number }>;\n  getWorldSeed(): number;\n  getModifiedTiles(): Array<{ position: { x: number; y: number }; layer: number; typeId: string }>;\n  getTotalPlaytime(): number;\n  getGameDay(): number;\n}\n\nexport interface GameStateConsumer {\n  loadPlayerPosition(position: Vector2): void;\n  loadPlayerHealth(current: number, max: number): void;\n  loadPlayerInventory(items: Array<{ itemId: string; quantity: number }>): void;\n  loadWorldSeed(seed: number): void;\n  loadModifiedTiles(tiles: Array<{ position: { x: number; y: number }; layer: number; typeId: string }>): void;\n  loadPlaytime(seconds: number): void;\n  loadGameDay(day: number): void;\n}\n\n// ============================================================================\n// SaveManager Implementation\n// ============================================================================\n\nexport class SaveManager implements GameSystem {\n  public readonly name = 'SaveManager';\n\n  private stateProvider: GameStateProvider | null = null;\n  private stateConsumer: GameStateConsumer | null = null;\n  private autosaveInterval: number | null = null;\n  private autosaveSlot = 'autosave';\n\n  /**\n   * Initialize the save manager\n   */\n  public initialize(): void {\n    console.log('[SaveManager] Initialized');\n  }\n\n  /**\n   * Set the game state provider (for saving)\n   */\n  public setStateProvider(provider: GameStateProvider): void {\n    this.stateProvider = provider;\n  }\n\n  /**\n   * Set the game state consumer (for loading)\n   */\n  public setStateConsumer(consumer: GameStateConsumer): void {\n    this.stateConsumer = consumer;\n  }\n\n  /**\n   * Get all save slots\n   */\n  public getSaveSlots(): SaveSlotInfo[] {\n    const slots: SaveSlotInfo[] = [];\n\n    // Check numbered slots\n    for (let i = 1; i <= MAX_SAVE_SLOTS; i++) {\n      const slot = `slot${i}`;\n      const key = STORAGE_PREFIX + slot;\n      const exists = localStorage.getItem(key) !== null;\n      const info: SaveSlotInfo = { slot, exists };\n\n      if (exists) {\n        try {\n          const data = JSON.parse(localStorage.getItem(key)!) as SaveData;\n          info.metadata = data.metadata;\n        } catch {\n          // Invalid save data\n        }\n      }\n\n      slots.push(info);\n    }\n\n    // Check autosave slot\n    const autosaveKey = STORAGE_PREFIX + this.autosaveSlot;\n    const autosaveExists = localStorage.getItem(autosaveKey) !== null;\n    const autosaveInfo: SaveSlotInfo = { slot: this.autosaveSlot, exists: autosaveExists };\n\n    if (autosaveExists) {\n      try {\n        const data = JSON.parse(localStorage.getItem(autosaveKey)!) as SaveData;\n        autosaveInfo.metadata = data.metadata;\n      } catch {\n        // Invalid save data\n      }\n    }\n\n    slots.unshift(autosaveInfo);\n\n    return slots;\n  }\n\n  /**\n   * Save game to a slot\n   */\n  public async saveGame(slot: string): Promise<boolean> {\n    if (!this.stateProvider) {\n      console.error('[SaveManager] No state provider set');\n      return false;\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('save:started', { slot });\n\n    try {\n      const saveData = this.createSaveData(slot);\n      const json = JSON.stringify(saveData);\n      const key = STORAGE_PREFIX + slot;\n\n      localStorage.setItem(key, json);\n\n      eventBus.emit('save:completed', { slot });\n      console.log(`[SaveManager] Game saved to slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      eventBus.emit('save:failed', { slot, error: message });\n      console.error(`[SaveManager] Save failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Load game from a slot\n   */\n  public async loadGame(slot: string): Promise<boolean> {\n    if (!this.stateConsumer) {\n      console.error('[SaveManager] No state consumer set');\n      return false;\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('load:started', { slot });\n\n    try {\n      const key = STORAGE_PREFIX + slot;\n      const json = localStorage.getItem(key);\n\n      if (!json) {\n        throw new Error(`Save slot \"${slot}\" not found`);\n      }\n\n      const saveData = JSON.parse(json) as SaveData;\n\n      // Check version and migrate if needed\n      const migratedData = this.migrateData(saveData);\n\n      // Apply save data to game state\n      this.applySaveData(migratedData);\n\n      eventBus.emit('load:completed', { slot });\n      console.log(`[SaveManager] Game loaded from slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      eventBus.emit('load:failed', { slot, error: message });\n      console.error(`[SaveManager] Load failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Delete a save slot\n   */\n  public deleteSave(slot: string): boolean {\n    try {\n      const key = STORAGE_PREFIX + slot;\n      localStorage.removeItem(key);\n      console.log(`[SaveManager] Deleted save slot \"${slot}\"`);\n      return true;\n    } catch (error) {\n      console.error(`[SaveManager] Delete failed:`, error);\n      return false;\n    }\n  }\n\n  /**\n   * Check if a save slot exists\n   */\n  public saveExists(slot: string): boolean {\n    const key = STORAGE_PREFIX + slot;\n    return localStorage.getItem(key) !== null;\n  }\n\n  /**\n   * Enable autosave at specified interval (in seconds)\n   */\n  public enableAutosave(intervalSeconds: number): void {\n    this.disableAutosave();\n    this.autosaveInterval = window.setInterval(() => {\n      this.saveGame(this.autosaveSlot);\n    }, intervalSeconds * 1000);\n    console.log(`[SaveManager] Autosave enabled every ${intervalSeconds} seconds`);\n  }\n\n  /**\n   * Disable autosave\n   */\n  public disableAutosave(): void {\n    if (this.autosaveInterval !== null) {\n      window.clearInterval(this.autosaveInterval);\n      this.autosaveInterval = null;\n      console.log('[SaveManager] Autosave disabled');\n    }\n  }\n\n  /**\n   * Create save data from current game state\n   */\n  private createSaveData(slotName: string): SaveData {\n    const provider = this.stateProvider!;\n\n    return {\n      metadata: {\n        version: SAVE_VERSION,\n        timestamp: Date.now(),\n        playtimeSeconds: provider.getTotalPlaytime(),\n        slotName,\n      },\n      world: {\n        seed: provider.getWorldSeed(),\n        modifiedTiles: provider.getModifiedTiles(),\n      },\n      player: {\n        position: provider.getPlayerPosition(),\n        health: provider.getPlayerHealth(),\n        maxHealth: provider.getPlayerMaxHealth(),\n        inventory: provider.getPlayerInventory(),\n      },\n      gameTime: {\n        totalSeconds: provider.getTotalPlaytime(),\n        gameDay: provider.getGameDay(),\n      },\n    };\n  }\n\n  /**\n   * Apply save data to game state\n   */\n  private applySaveData(data: SaveData): void {\n    const consumer = this.stateConsumer!;\n\n    consumer.loadWorldSeed(data.world.seed);\n    consumer.loadModifiedTiles(data.world.modifiedTiles);\n    consumer.loadPlayerPosition(data.player.position);\n    consumer.loadPlayerHealth(data.player.health, data.player.maxHealth);\n    consumer.loadPlayerInventory(data.player.inventory);\n    consumer.loadPlaytime(data.gameTime.totalSeconds);\n    consumer.loadGameDay(data.gameTime.gameDay);\n  }\n\n  /**\n   * Migrate save data from older versions\n   */\n  private migrateData(data: SaveData): SaveData {\n    // Currently no migrations needed\n    // Future migrations would check data.metadata.version and transform as needed\n    return data;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.disableAutosave();\n    console.log('[SaveManager] Destroyed');\n  }\n}\n","/**\n * InputManager - Handles keyboard, mouse, and gamepad input\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Input System:\n * - Default bindings for keyboard and gamepad\n * - Rebindable keys\n * - Target: < 50ms input latency\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { InputAction, InputBinding, Vector2, GameTime } from '@core/types';\nimport { GamepadButton, GamepadAxis } from '@core/types';\n\n// ============================================================================\n// Default Bindings\n// ============================================================================\n\n/**\n * Default input bindings per 2D_GAME_IMPLEMENTATION_PLAN.md:\n * | Action    | Keyboard       | Gamepad          |\n * |-----------|----------------|------------------|\n * | Move      | WASD / Arrows  | Left Stick       |\n * | Sprint    | Shift          | Left Trigger     |\n * | Interact  | E              | A Button         |\n * | Attack    | Left Click     | Right Trigger    |\n * | Cancel    | Escape         | B Button         |\n * | Inventory | I              | Start            |\n * | Build Menu| B              | Select           |\n */\nconst DEFAULT_BINDINGS: InputBinding[] = [\n  // Movement (D-pad also supported for digital input)\n  { action: 'moveUp' as InputAction, keys: ['KeyW', 'ArrowUp'], gamepadButtons: [GamepadButton.DPadUp] },\n  { action: 'moveDown' as InputAction, keys: ['KeyS', 'ArrowDown'], gamepadButtons: [GamepadButton.DPadDown] },\n  { action: 'moveLeft' as InputAction, keys: ['KeyA', 'ArrowLeft'], gamepadButtons: [GamepadButton.DPadLeft] },\n  { action: 'moveRight' as InputAction, keys: ['KeyD', 'ArrowRight'], gamepadButtons: [GamepadButton.DPadRight] },\n  // Actions\n  { action: 'sprint' as InputAction, keys: ['ShiftLeft', 'ShiftRight'], gamepadButtons: [GamepadButton.LeftTrigger] },\n  { action: 'interact' as InputAction, keys: ['KeyE'], gamepadButtons: [GamepadButton.A] },\n  { action: 'attack' as InputAction, keys: [], mouseButtons: [0], gamepadButtons: [GamepadButton.RightTrigger] },\n  { action: 'secondary' as InputAction, keys: [], mouseButtons: [2], gamepadButtons: [GamepadButton.RightBumper] },\n  { action: 'cancel' as InputAction, keys: ['Escape'], gamepadButtons: [GamepadButton.B] },\n  { action: 'inventory' as InputAction, keys: ['KeyI'], gamepadButtons: [GamepadButton.Start] },\n  { action: 'buildMenu' as InputAction, keys: ['KeyB'], gamepadButtons: [GamepadButton.Select] },\n  { action: 'pause' as InputAction, keys: ['KeyP', 'Escape'], gamepadButtons: [GamepadButton.Start] },\n  // Zoom (bumpers on gamepad)\n  { action: 'zoomIn' as InputAction, keys: ['Equal', 'NumpadAdd'], gamepadButtons: [GamepadButton.Y] },\n  { action: 'zoomOut' as InputAction, keys: ['Minus', 'NumpadSubtract'], gamepadButtons: [GamepadButton.X] },\n  // Quick slots (no gamepad equivalent - use radial menu instead)\n  { action: 'quickSlot1' as InputAction, keys: ['Digit1', 'Numpad1'] },\n  { action: 'quickSlot2' as InputAction, keys: ['Digit2', 'Numpad2'] },\n  { action: 'quickSlot3' as InputAction, keys: ['Digit3', 'Numpad3'] },\n  { action: 'quickSlot4' as InputAction, keys: ['Digit4', 'Numpad4'] },\n  { action: 'quickSlot5' as InputAction, keys: ['Digit5', 'Numpad5'] },\n  { action: 'quickSlot6' as InputAction, keys: ['Digit6', 'Numpad6'] },\n  { action: 'quickSlot7' as InputAction, keys: ['Digit7', 'Numpad7'] },\n  { action: 'quickSlot8' as InputAction, keys: ['Digit8', 'Numpad8'] },\n  { action: 'quickSlot9' as InputAction, keys: ['Digit9', 'Numpad9'] },\n];\n\n// Gamepad configuration\nconst GAMEPAD_CONFIG = {\n  deadzone: 0.15,           // Stick deadzone to prevent drift\n  triggerThreshold: 0.5,    // Trigger activation threshold\n};\n\n// ============================================================================\n// InputManager Implementation\n// ============================================================================\n\nexport class InputManager implements GameSystem {\n  public readonly name = 'InputManager';\n\n  private bindings: InputBinding[] = [];\n  private keyToAction: Map<string, InputAction[]> = new Map();\n  private mouseButtonToAction: Map<number, InputAction[]> = new Map();\n  private gamepadButtonToAction: Map<number, InputAction[]> = new Map();\n\n  // Current input state\n  private pressedKeys: Set<string> = new Set();\n  private pressedMouseButtons: Set<number> = new Set();\n  private pressedGamepadButtons: Set<number> = new Set();\n  private activeActions: Set<InputAction> = new Set();\n\n  // Mouse state\n  private mousePosition: Vector2 = { x: 0, y: 0 };\n  private mouseWorldPosition: Vector2 = { x: 0, y: 0 };\n\n  // Gamepad state\n  private activeGamepadIndex: number | null = null;\n  private leftStickInput: Vector2 = { x: 0, y: 0 };\n  private rightStickInput: Vector2 = { x: 0, y: 0 };\n  private gamepadConnected = false;\n\n  // Screen to world converter (set by game)\n  private screenToWorld: ((screenX: number, screenY: number) => Vector2) | null = null;\n\n  /**\n   * Initialize the input manager\n   */\n  public initialize(): void {\n    // Load default bindings\n    this.setBindings(DEFAULT_BINDINGS);\n\n    // Set up keyboard/mouse event listeners\n    window.addEventListener('keydown', this.onKeyDown.bind(this));\n    window.addEventListener('keyup', this.onKeyUp.bind(this));\n    window.addEventListener('mousedown', this.onMouseDown.bind(this));\n    window.addEventListener('mouseup', this.onMouseUp.bind(this));\n    window.addEventListener('mousemove', this.onMouseMove.bind(this));\n    window.addEventListener('contextmenu', this.onContextMenu.bind(this));\n    window.addEventListener('blur', this.onBlur.bind(this));\n\n    // Set up gamepad event listeners\n    window.addEventListener('gamepadconnected', this.onGamepadConnected.bind(this));\n    window.addEventListener('gamepaddisconnected', this.onGamepadDisconnected.bind(this));\n\n    // Check for already-connected gamepads\n    this.detectGamepads();\n\n    console.log('[InputManager] Initialized');\n  }\n\n  /**\n   * Update - polls gamepad state (Gamepad API requires polling)\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    this.pollGamepad();\n  }\n\n  /**\n   * Set input bindings\n   */\n  public setBindings(bindings: InputBinding[]): void {\n    this.bindings = [...bindings];\n    this.rebuildBindingMaps();\n  }\n\n  /**\n   * Get current bindings\n   */\n  public getBindings(): readonly InputBinding[] {\n    return this.bindings;\n  }\n\n  /**\n   * Rebind a key for an action\n   */\n  public rebindKey(action: InputAction, oldKey: string, newKey: string): void {\n    const binding = this.bindings.find(b => b.action === action);\n    if (binding) {\n      const index = binding.keys.indexOf(oldKey);\n      if (index !== -1) {\n        binding.keys[index] = newKey;\n        this.rebuildBindingMaps();\n      }\n    }\n  }\n\n  /**\n   * Set screen to world conversion function\n   */\n  public setScreenToWorldConverter(fn: (screenX: number, screenY: number) => Vector2): void {\n    this.screenToWorld = fn;\n  }\n\n  /**\n   * Rebuild the key/button to action maps\n   */\n  private rebuildBindingMaps(): void {\n    this.keyToAction.clear();\n    this.mouseButtonToAction.clear();\n    this.gamepadButtonToAction.clear();\n\n    for (const binding of this.bindings) {\n      // Map keys to actions\n      for (const key of binding.keys) {\n        const actions = this.keyToAction.get(key) ?? [];\n        actions.push(binding.action);\n        this.keyToAction.set(key, actions);\n      }\n\n      // Map mouse buttons to actions\n      if (binding.mouseButtons) {\n        for (const button of binding.mouseButtons) {\n          const actions = this.mouseButtonToAction.get(button) ?? [];\n          actions.push(binding.action);\n          this.mouseButtonToAction.set(button, actions);\n        }\n      }\n\n      // Map gamepad buttons to actions\n      if (binding.gamepadButtons) {\n        for (const button of binding.gamepadButtons) {\n          const actions = this.gamepadButtonToAction.get(button) ?? [];\n          actions.push(binding.action);\n          this.gamepadButtonToAction.set(button, actions);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle key down event\n   */\n  private onKeyDown(event: KeyboardEvent): void {\n    // Ignore if typing in an input field\n    if (this.isTypingInInput(event)) {\n      return;\n    }\n\n    const key = event.code;\n\n    if (this.pressedKeys.has(key)) {\n      return; // Already pressed, ignore repeat\n    }\n\n    this.pressedKeys.add(key);\n\n    // Trigger actions for this key\n    const actions = this.keyToAction.get(key);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        if (!this.activeActions.has(action)) {\n          this.activeActions.add(action);\n          eventBus.emit('input:actionPressed', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle key up event\n   */\n  private onKeyUp(event: KeyboardEvent): void {\n    const key = event.code;\n    this.pressedKeys.delete(key);\n\n    // Check if actions should be released\n    const actions = this.keyToAction.get(key);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        // Only release if no other bound keys are still pressed\n        if (!this.isActionStillPressed(action)) {\n          this.activeActions.delete(action);\n          eventBus.emit('input:actionReleased', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse down event\n   */\n  private onMouseDown(event: MouseEvent): void {\n    const button = event.button;\n    this.pressedMouseButtons.add(button);\n\n    const eventBus = getEventBus();\n\n    // Emit click event\n    eventBus.emit('input:mouseClicked', {\n      button,\n      position: { ...this.mousePosition },\n      worldPosition: { ...this.mouseWorldPosition },\n    });\n\n    // Trigger actions for this button\n    const actions = this.mouseButtonToAction.get(button);\n    if (actions) {\n      for (const action of actions) {\n        if (!this.activeActions.has(action)) {\n          this.activeActions.add(action);\n          eventBus.emit('input:actionPressed', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse up event\n   */\n  private onMouseUp(event: MouseEvent): void {\n    const button = event.button;\n    this.pressedMouseButtons.delete(button);\n\n    // Check if actions should be released\n    const actions = this.mouseButtonToAction.get(button);\n    if (actions) {\n      const eventBus = getEventBus();\n      for (const action of actions) {\n        if (!this.isActionStillPressed(action)) {\n          this.activeActions.delete(action);\n          eventBus.emit('input:actionReleased', { action });\n        }\n      }\n    }\n  }\n\n  /**\n   * Handle mouse move event\n   */\n  private onMouseMove(event: MouseEvent): void {\n    this.mousePosition = { x: event.clientX, y: event.clientY };\n\n    // Calculate world position if converter is set\n    if (this.screenToWorld) {\n      this.mouseWorldPosition = this.screenToWorld(event.clientX, event.clientY);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:mouseMoved', {\n      position: { ...this.mousePosition },\n      worldPosition: { ...this.mouseWorldPosition },\n    });\n  }\n\n  /**\n   * Handle context menu (prevent default right-click menu)\n   */\n  private onContextMenu(event: Event): void {\n    event.preventDefault();\n  }\n\n  /**\n   * Handle window blur (release all keys)\n   */\n  private onBlur(): void {\n    const eventBus = getEventBus();\n\n    // Release all active actions\n    for (const action of this.activeActions) {\n      eventBus.emit('input:actionReleased', { action });\n    }\n\n    this.pressedKeys.clear();\n    this.pressedMouseButtons.clear();\n    this.pressedGamepadButtons.clear();\n    this.activeActions.clear();\n    this.leftStickInput = { x: 0, y: 0 };\n    this.rightStickInput = { x: 0, y: 0 };\n  }\n\n  // ============================================================================\n  // Gamepad Methods\n  // ============================================================================\n\n  /**\n   * Handle gamepad connected event\n   */\n  private onGamepadConnected(event: GamepadEvent): void {\n    console.log(`[InputManager] Gamepad connected: ${event.gamepad.id}`);\n    this.activeGamepadIndex = event.gamepad.index;\n    this.gamepadConnected = true;\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:gamepadConnected', {\n      index: event.gamepad.index,\n      id: event.gamepad.id\n    });\n  }\n\n  /**\n   * Handle gamepad disconnected event\n   */\n  private onGamepadDisconnected(event: GamepadEvent): void {\n    console.log(`[InputManager] Gamepad disconnected: ${event.gamepad.id}`);\n\n    if (this.activeGamepadIndex === event.gamepad.index) {\n      this.activeGamepadIndex = null;\n      this.gamepadConnected = false;\n      this.pressedGamepadButtons.clear();\n      this.leftStickInput = { x: 0, y: 0 };\n      this.rightStickInput = { x: 0, y: 0 };\n\n      // Try to find another connected gamepad\n      this.detectGamepads();\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('input:gamepadDisconnected', {\n      index: event.gamepad.index,\n      id: event.gamepad.id\n    });\n  }\n\n  /**\n   * Detect already-connected gamepads\n   */\n  private detectGamepads(): void {\n    const gamepads = navigator.getGamepads();\n    for (const gamepad of gamepads) {\n      if (gamepad) {\n        this.activeGamepadIndex = gamepad.index;\n        this.gamepadConnected = true;\n        console.log(`[InputManager] Found gamepad: ${gamepad.id}`);\n        break;\n      }\n    }\n  }\n\n  /**\n   * Poll gamepad state (called every frame)\n   */\n  private pollGamepad(): void {\n    if (this.activeGamepadIndex === null) return;\n\n    const gamepads = navigator.getGamepads();\n    const gamepad = gamepads[this.activeGamepadIndex];\n\n    if (!gamepad) {\n      this.activeGamepadIndex = null;\n      this.gamepadConnected = false;\n      return;\n    }\n\n    // Poll buttons\n    this.pollGamepadButtons(gamepad);\n\n    // Poll analog sticks\n    this.pollGamepadSticks(gamepad);\n  }\n\n  /**\n   * Poll gamepad buttons\n   */\n  private pollGamepadButtons(gamepad: Gamepad): void {\n    const eventBus = getEventBus();\n\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i];\n      const isPressed = button.pressed || button.value > GAMEPAD_CONFIG.triggerThreshold;\n      const wasPressed = this.pressedGamepadButtons.has(i);\n\n      if (isPressed && !wasPressed) {\n        // Button pressed\n        this.pressedGamepadButtons.add(i);\n\n        const actions = this.gamepadButtonToAction.get(i);\n        if (actions) {\n          for (const action of actions) {\n            if (!this.activeActions.has(action)) {\n              this.activeActions.add(action);\n              eventBus.emit('input:actionPressed', { action });\n            }\n          }\n        }\n      } else if (!isPressed && wasPressed) {\n        // Button released\n        this.pressedGamepadButtons.delete(i);\n\n        const actions = this.gamepadButtonToAction.get(i);\n        if (actions) {\n          for (const action of actions) {\n            if (!this.isActionStillPressed(action)) {\n              this.activeActions.delete(action);\n              eventBus.emit('input:actionReleased', { action });\n            }\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Poll gamepad analog sticks\n   */\n  private pollGamepadSticks(gamepad: Gamepad): void {\n    const { deadzone } = GAMEPAD_CONFIG;\n\n    // Left stick\n    let leftX = gamepad.axes[GamepadAxis.LeftStickX] ?? 0;\n    let leftY = gamepad.axes[GamepadAxis.LeftStickY] ?? 0;\n\n    // Apply deadzone\n    if (Math.abs(leftX) < deadzone) leftX = 0;\n    if (Math.abs(leftY) < deadzone) leftY = 0;\n\n    // Update left stick input\n    const oldLeftX = this.leftStickInput.x;\n    const oldLeftY = this.leftStickInput.y;\n    this.leftStickInput = { x: leftX, y: leftY };\n\n    // Emit stick moved event if changed significantly\n    if (Math.abs(leftX - oldLeftX) > 0.01 || Math.abs(leftY - oldLeftY) > 0.01) {\n      const eventBus = getEventBus();\n      eventBus.emit('input:leftStickMoved', { x: leftX, y: leftY });\n    }\n\n    // Right stick\n    let rightX = gamepad.axes[GamepadAxis.RightStickX] ?? 0;\n    let rightY = gamepad.axes[GamepadAxis.RightStickY] ?? 0;\n\n    if (Math.abs(rightX) < deadzone) rightX = 0;\n    if (Math.abs(rightY) < deadzone) rightY = 0;\n\n    const oldRightX = this.rightStickInput.x;\n    const oldRightY = this.rightStickInput.y;\n    this.rightStickInput = { x: rightX, y: rightY };\n\n    if (Math.abs(rightX - oldRightX) > 0.01 || Math.abs(rightY - oldRightY) > 0.01) {\n      const eventBus = getEventBus();\n      eventBus.emit('input:rightStickMoved', { x: rightX, y: rightY });\n    }\n  }\n\n  /**\n   * Check if an action is still pressed by any bound key/button\n   */\n  private isActionStillPressed(action: InputAction): boolean {\n    const binding = this.bindings.find(b => b.action === action);\n    if (!binding) return false;\n\n    // Check keys\n    for (const key of binding.keys) {\n      if (this.pressedKeys.has(key)) {\n        return true;\n      }\n    }\n\n    // Check mouse buttons\n    if (binding.mouseButtons) {\n      for (const button of binding.mouseButtons) {\n        if (this.pressedMouseButtons.has(button)) {\n          return true;\n        }\n      }\n    }\n\n    // Check gamepad buttons\n    if (binding.gamepadButtons) {\n      for (const button of binding.gamepadButtons) {\n        if (this.pressedGamepadButtons.has(button)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Check if user is typing in an input field\n   */\n  private isTypingInInput(event: KeyboardEvent): boolean {\n    const target = event.target as HTMLElement;\n    return (\n      target.tagName === 'INPUT' ||\n      target.tagName === 'TEXTAREA' ||\n      target.isContentEditable\n    );\n  }\n\n  // ============================================================================\n  // Public API\n  // ============================================================================\n\n  /**\n   * Check if an action is currently active\n   */\n  public isActionActive(action: InputAction): boolean {\n    return this.activeActions.has(action);\n  }\n\n  /**\n   * Check if a key is currently pressed\n   */\n  public isKeyPressed(key: string): boolean {\n    return this.pressedKeys.has(key);\n  }\n\n  /**\n   * Check if a mouse button is currently pressed\n   */\n  public isMouseButtonPressed(button: number): boolean {\n    return this.pressedMouseButtons.has(button);\n  }\n\n  /**\n   * Get mouse position in screen coordinates\n   */\n  public getMousePosition(): Readonly<Vector2> {\n    return this.mousePosition;\n  }\n\n  /**\n   * Get mouse position in world coordinates\n   */\n  public getMouseWorldPosition(): Readonly<Vector2> {\n    return this.mouseWorldPosition;\n  }\n\n  /**\n   * Get all currently active actions\n   */\n  public getActiveActions(): ReadonlySet<InputAction> {\n    return this.activeActions;\n  }\n\n  // ============================================================================\n  // Gamepad Public API\n  // ============================================================================\n\n  /**\n   * Check if a gamepad is connected\n   */\n  public isGamepadConnected(): boolean {\n    return this.gamepadConnected;\n  }\n\n  /**\n   * Get left stick input (-1 to 1 for each axis)\n   */\n  public getLeftStick(): Readonly<Vector2> {\n    return this.leftStickInput;\n  }\n\n  /**\n   * Get right stick input (-1 to 1 for each axis)\n   */\n  public getRightStick(): Readonly<Vector2> {\n    return this.rightStickInput;\n  }\n\n  /**\n   * Check if a gamepad button is currently pressed\n   */\n  public isGamepadButtonPressed(button: number): boolean {\n    return this.pressedGamepadButtons.has(button);\n  }\n\n  /**\n   * Get the active gamepad (if any)\n   */\n  public getActiveGamepad(): Gamepad | null {\n    if (this.activeGamepadIndex === null) return null;\n    const gamepads = navigator.getGamepads();\n    return gamepads[this.activeGamepadIndex] ?? null;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    window.removeEventListener('keydown', this.onKeyDown.bind(this));\n    window.removeEventListener('keyup', this.onKeyUp.bind(this));\n    window.removeEventListener('mousedown', this.onMouseDown.bind(this));\n    window.removeEventListener('mouseup', this.onMouseUp.bind(this));\n    window.removeEventListener('mousemove', this.onMouseMove.bind(this));\n    window.removeEventListener('contextmenu', this.onContextMenu.bind(this));\n    window.removeEventListener('blur', this.onBlur.bind(this));\n    window.removeEventListener('gamepadconnected', this.onGamepadConnected.bind(this));\n    window.removeEventListener('gamepaddisconnected', this.onGamepadDisconnected.bind(this));\n\n    this.pressedKeys.clear();\n    this.pressedMouseButtons.clear();\n    this.pressedGamepadButtons.clear();\n    this.activeActions.clear();\n\n    console.log('[InputManager] Destroyed');\n  }\n}\n","/**\n * ResourceManager - Manages resource definitions and items\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 Resource System:\n * Categories: Raw Materials, Ores, Food, Special\n */\n\n// ============================================================================\n// Resource Categories\n// ============================================================================\n\nexport enum ResourceCategory {\n  RawMaterial = 'raw_material',\n  Ore = 'ore',\n  Food = 'food',\n  Tool = 'tool',\n  Weapon = 'weapon',\n  Armor = 'armor',\n  Building = 'building',\n  Special = 'special',\n  Consumable = 'consumable',\n}\n\n// ============================================================================\n// Resource Definition\n// ============================================================================\n\nexport interface ResourceDefinition {\n  id: string;\n  name: string;\n  description: string;\n  category: ResourceCategory;\n  stackSize: number;           // Max stack size (1 for non-stackable)\n  value: number;               // Base trade value\n  weight: number;              // Weight per unit\n  durability?: number;         // For tools/weapons/armor (undefined = indestructible)\n  damage?: number;             // For weapons\n  protection?: number;         // For armor\n  healAmount?: number;         // For food/consumables\n  hungerRestore?: number;      // For food\n  icon?: string;               // Icon asset path\n}\n\n// ============================================================================\n// Default Resources\n// ============================================================================\n\nconst DEFAULT_RESOURCES: ResourceDefinition[] = [\n  // Raw Materials\n  {\n    id: 'wood',\n    name: 'Wood',\n    description: 'Basic building material gathered from trees',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 2,\n    weight: 1,\n  },\n  {\n    id: 'stone',\n    name: 'Stone',\n    description: 'Common stone for building and tools',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 1,\n    weight: 2,\n  },\n  {\n    id: 'fiber',\n    name: 'Plant Fiber',\n    description: 'Flexible plant material for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 99,\n    value: 1,\n    weight: 0.2,\n  },\n  {\n    id: 'clay',\n    name: 'Clay',\n    description: 'Moldable earth for pottery and bricks',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 2,\n    weight: 1.5,\n  },\n  {\n    id: 'leather',\n    name: 'Leather',\n    description: 'Tanned animal hide',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 5,\n    weight: 0.5,\n  },\n  {\n    id: 'cloth',\n    name: 'Cloth',\n    description: 'Woven fabric from plant fibers',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 4,\n    weight: 0.3,\n  },\n\n  // Ores\n  {\n    id: 'iron_ore',\n    name: 'Iron Ore',\n    description: 'Raw iron ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 5,\n    weight: 3,\n  },\n  {\n    id: 'copper_ore',\n    name: 'Copper Ore',\n    description: 'Raw copper ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 3,\n    weight: 2.5,\n  },\n  {\n    id: 'gold_ore',\n    name: 'Gold Ore',\n    description: 'Precious gold ore, needs smelting',\n    category: ResourceCategory.Ore,\n    stackSize: 30,\n    value: 20,\n    weight: 4,\n  },\n  {\n    id: 'coal',\n    name: 'Coal',\n    description: 'Fuel for smelting and crafting',\n    category: ResourceCategory.Ore,\n    stackSize: 50,\n    value: 2,\n    weight: 1,\n  },\n  {\n    id: 'iron_ingot',\n    name: 'Iron Ingot',\n    description: 'Smelted iron, ready for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 10,\n    weight: 2,\n  },\n  {\n    id: 'copper_ingot',\n    name: 'Copper Ingot',\n    description: 'Smelted copper, ready for crafting',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 50,\n    value: 6,\n    weight: 1.5,\n  },\n  {\n    id: 'gold_ingot',\n    name: 'Gold Ingot',\n    description: 'Smelted gold, valuable and beautiful',\n    category: ResourceCategory.RawMaterial,\n    stackSize: 30,\n    value: 40,\n    weight: 3,\n  },\n\n  // Food\n  {\n    id: 'berries',\n    name: 'Berries',\n    description: 'Wild berries, slightly restores hunger',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 1,\n    weight: 0.1,\n    hungerRestore: 5,\n    healAmount: 0,\n  },\n  {\n    id: 'mushroom',\n    name: 'Mushroom',\n    description: 'Edible forest mushroom',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 2,\n    weight: 0.1,\n    hungerRestore: 8,\n    healAmount: 0,\n  },\n  {\n    id: 'raw_meat',\n    name: 'Raw Meat',\n    description: 'Uncooked meat, should be cooked before eating',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 5,\n    weight: 0.5,\n    hungerRestore: 10,\n    healAmount: -5, // Raw meat is bad for you\n  },\n  {\n    id: 'cooked_meat',\n    name: 'Cooked Meat',\n    description: 'Well-cooked meat, restores hunger and health',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 10,\n    weight: 0.4,\n    hungerRestore: 25,\n    healAmount: 10,\n  },\n  {\n    id: 'bread',\n    name: 'Bread',\n    description: 'Baked bread, a staple food',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 8,\n    weight: 0.2,\n    hungerRestore: 20,\n    healAmount: 0,\n  },\n  {\n    id: 'apple',\n    name: 'Apple',\n    description: 'Fresh apple from a tree',\n    category: ResourceCategory.Food,\n    stackSize: 20,\n    value: 3,\n    weight: 0.2,\n    hungerRestore: 10,\n    healAmount: 2,\n  },\n  {\n    id: 'fish',\n    name: 'Cooked Fish',\n    description: 'Freshly caught and cooked fish',\n    category: ResourceCategory.Food,\n    stackSize: 10,\n    value: 12,\n    weight: 0.4,\n    hungerRestore: 30,\n    healAmount: 5,\n  },\n\n  // Tools\n  {\n    id: 'stone_pickaxe',\n    name: 'Stone Pickaxe',\n    description: 'Basic mining tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 15,\n    weight: 3,\n    durability: 100,\n    damage: 5,\n  },\n  {\n    id: 'iron_pickaxe',\n    name: 'Iron Pickaxe',\n    description: 'Sturdy mining tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 50,\n    weight: 4,\n    durability: 250,\n    damage: 8,\n  },\n  {\n    id: 'stone_axe',\n    name: 'Stone Axe',\n    description: 'Basic woodcutting tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 15,\n    weight: 2.5,\n    durability: 100,\n    damage: 8,\n  },\n  {\n    id: 'iron_axe',\n    name: 'Iron Axe',\n    description: 'Sturdy woodcutting tool',\n    category: ResourceCategory.Tool,\n    stackSize: 1,\n    value: 50,\n    weight: 3.5,\n    durability: 250,\n    damage: 12,\n  },\n\n  // Weapons\n  {\n    id: 'wooden_sword',\n    name: 'Wooden Sword',\n    description: 'A basic wooden sword',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 10,\n    weight: 1.5,\n    durability: 50,\n    damage: 10,\n  },\n  {\n    id: 'stone_sword',\n    name: 'Stone Sword',\n    description: 'A crude stone blade',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 20,\n    weight: 3,\n    durability: 100,\n    damage: 15,\n  },\n  {\n    id: 'iron_sword',\n    name: 'Iron Sword',\n    description: 'A sturdy iron blade',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 75,\n    weight: 2.5,\n    durability: 300,\n    damage: 25,\n  },\n  {\n    id: 'bow',\n    name: 'Wooden Bow',\n    description: 'A ranged weapon for hunting',\n    category: ResourceCategory.Weapon,\n    stackSize: 1,\n    value: 30,\n    weight: 1,\n    durability: 150,\n    damage: 20,\n  },\n  {\n    id: 'arrow',\n    name: 'Arrow',\n    description: 'Ammunition for bows',\n    category: ResourceCategory.Weapon,\n    stackSize: 50,\n    value: 1,\n    weight: 0.1,\n    damage: 5,\n  },\n\n  // Consumables\n  {\n    id: 'health_potion',\n    name: 'Health Potion',\n    description: 'Restores health when consumed',\n    category: ResourceCategory.Consumable,\n    stackSize: 10,\n    value: 25,\n    weight: 0.5,\n    healAmount: 50,\n  },\n  {\n    id: 'bandage',\n    name: 'Bandage',\n    description: 'Stops bleeding and heals minor wounds',\n    category: ResourceCategory.Consumable,\n    stackSize: 20,\n    value: 5,\n    weight: 0.1,\n    healAmount: 15,\n  },\n\n  // Building Materials\n  {\n    id: 'wooden_plank',\n    name: 'Wooden Plank',\n    description: 'Processed wood for building',\n    category: ResourceCategory.Building,\n    stackSize: 50,\n    value: 5,\n    weight: 1,\n  },\n  {\n    id: 'stone_brick',\n    name: 'Stone Brick',\n    description: 'Cut stone for sturdy construction',\n    category: ResourceCategory.Building,\n    stackSize: 50,\n    value: 4,\n    weight: 2,\n  },\n  {\n    id: 'rope',\n    name: 'Rope',\n    description: 'Woven rope for building and crafting',\n    category: ResourceCategory.Building,\n    stackSize: 30,\n    value: 6,\n    weight: 0.5,\n  },\n\n  // Special\n  {\n    id: 'portal_shard',\n    name: 'Portal Shard',\n    description: 'A mysterious crystal from a closed portal',\n    category: ResourceCategory.Special,\n    stackSize: 10,\n    value: 100,\n    weight: 0.3,\n  },\n  {\n    id: 'monster_essence',\n    name: 'Monster Essence',\n    description: 'Magical essence dropped by monsters',\n    category: ResourceCategory.Special,\n    stackSize: 50,\n    value: 15,\n    weight: 0.1,\n  },\n];\n\n// ============================================================================\n// ResourceManager Implementation\n// ============================================================================\n\nexport class ResourceManager {\n  private resources: Map<string, ResourceDefinition> = new Map();\n\n  constructor() {\n    // Register default resources\n    for (const resource of DEFAULT_RESOURCES) {\n      this.registerResource(resource);\n    }\n  }\n\n  /**\n   * Register a new resource\n   */\n  public registerResource(resource: ResourceDefinition): void {\n    this.resources.set(resource.id, resource);\n  }\n\n  /**\n   * Get a resource by ID\n   */\n  public getResource(id: string): ResourceDefinition | undefined {\n    return this.resources.get(id);\n  }\n\n  /**\n   * Get all resources\n   */\n  public getAllResources(): ResourceDefinition[] {\n    return Array.from(this.resources.values());\n  }\n\n  /**\n   * Get resources by category\n   */\n  public getResourcesByCategory(category: ResourceCategory): ResourceDefinition[] {\n    return this.getAllResources().filter(r => r.category === category);\n  }\n\n  /**\n   * Check if a resource exists\n   */\n  public hasResource(id: string): boolean {\n    return this.resources.has(id);\n  }\n\n  /**\n   * Get resource count\n   */\n  public getResourceCount(): number {\n    return this.resources.size;\n  }\n\n  /**\n   * Check if resource is stackable\n   */\n  public isStackable(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource ? resource.stackSize > 1 : false;\n  }\n\n  /**\n   * Get max stack size for a resource\n   */\n  public getStackSize(id: string): number {\n    const resource = this.getResource(id);\n    return resource?.stackSize ?? 1;\n  }\n\n  /**\n   * Check if resource is consumable (food or consumable)\n   */\n  public isConsumable(id: string): boolean {\n    const resource = this.getResource(id);\n    if (!resource) return false;\n    return resource.category === ResourceCategory.Food ||\n           resource.category === ResourceCategory.Consumable;\n  }\n\n  /**\n   * Check if resource is a weapon\n   */\n  public isWeapon(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource?.category === ResourceCategory.Weapon;\n  }\n\n  /**\n   * Check if resource is a tool\n   */\n  public isTool(id: string): boolean {\n    const resource = this.getResource(id);\n    return resource?.category === ResourceCategory.Tool;\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet resourceManagerInstance: ResourceManager | null = null;\n\nexport function getResourceManager(): ResourceManager {\n  if (!resourceManagerInstance) {\n    resourceManagerInstance = new ResourceManager();\n  }\n  return resourceManagerInstance;\n}\n","/**\n * InventoryManager - Manages player inventory\n *\n * Handles item storage, stacking, and quick slots.\n */\n\nimport { getEventBus } from '@core/EventBus';\nimport { getResourceManager, ResourceDefinition } from './ResourceManager';\n\n// ============================================================================\n// Inventory Types\n// ============================================================================\n\nexport interface InventorySlot {\n  resourceId: string | null;\n  quantity: number;\n  durability?: number;  // For tools/weapons\n}\n\nexport interface InventoryConfig {\n  size: number;           // Total inventory slots\n  quickSlots: number;     // Number of quick access slots\n}\n\nconst DEFAULT_CONFIG: InventoryConfig = {\n  size: 30,\n  quickSlots: 9,\n};\n\n// ============================================================================\n// InventoryManager Implementation\n// ============================================================================\n\nexport class InventoryManager {\n  private slots: InventorySlot[] = [];\n  private config: InventoryConfig;\n  private selectedQuickSlot: number = 0;\n\n  constructor(config: Partial<InventoryConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.initializeSlots();\n  }\n\n  /**\n   * Initialize empty slots\n   */\n  private initializeSlots(): void {\n    this.slots = [];\n    for (let i = 0; i < this.config.size; i++) {\n      this.slots.push({ resourceId: null, quantity: 0 });\n    }\n  }\n\n  /**\n   * Get all slots\n   */\n  public getSlots(): readonly InventorySlot[] {\n    return this.slots;\n  }\n\n  /**\n   * Get a specific slot\n   */\n  public getSlot(index: number): InventorySlot | undefined {\n    return this.slots[index];\n  }\n\n  /**\n   * Get quick slots (first N slots)\n   */\n  public getQuickSlots(): readonly InventorySlot[] {\n    return this.slots.slice(0, this.config.quickSlots);\n  }\n\n  /**\n   * Get selected quick slot index\n   */\n  public getSelectedQuickSlot(): number {\n    return this.selectedQuickSlot;\n  }\n\n  /**\n   * Set selected quick slot\n   */\n  public setSelectedQuickSlot(index: number): void {\n    if (index >= 0 && index < this.config.quickSlots) {\n      this.selectedQuickSlot = index;\n    }\n  }\n\n  /**\n   * Get item in hand (selected quick slot)\n   */\n  public getItemInHand(): InventorySlot {\n    return this.slots[this.selectedQuickSlot];\n  }\n\n  /**\n   * Add an item to inventory\n   * Returns the amount that couldn't be added (0 if all added)\n   */\n  public addItem(resourceId: string, quantity: number = 1, durability?: number): number {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n    if (!resource) {\n      console.warn(`[InventoryManager] Unknown resource: ${resourceId}`);\n      return quantity;\n    }\n\n    let remaining = quantity;\n    const stackSize = resource.stackSize;\n\n    // First, try to add to existing stacks\n    if (stackSize > 1) {\n      for (const slot of this.slots) {\n        if (remaining <= 0) break;\n        if (slot.resourceId === resourceId && slot.quantity < stackSize) {\n          const canAdd = Math.min(remaining, stackSize - slot.quantity);\n          slot.quantity += canAdd;\n          remaining -= canAdd;\n        }\n      }\n    }\n\n    // Then, add to empty slots\n    for (const slot of this.slots) {\n      if (remaining <= 0) break;\n      if (slot.resourceId === null) {\n        const canAdd = Math.min(remaining, stackSize);\n        slot.resourceId = resourceId;\n        slot.quantity = canAdd;\n        slot.durability = durability ?? resource.durability;\n        remaining -= canAdd;\n      }\n    }\n\n    // Emit event for what was added\n    if (remaining < quantity) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId,\n        delta: quantity - remaining,\n      });\n    }\n\n    return remaining;\n  }\n\n  /**\n   * Remove an item from inventory\n   * Returns the amount actually removed\n   */\n  public removeItem(resourceId: string, quantity: number = 1): number {\n    let remaining = quantity;\n\n    // Remove from slots in reverse order (preserves quick slots longer)\n    for (let i = this.slots.length - 1; i >= 0; i--) {\n      if (remaining <= 0) break;\n      const slot = this.slots[i];\n      if (slot.resourceId === resourceId) {\n        const canRemove = Math.min(remaining, slot.quantity);\n        slot.quantity -= canRemove;\n        remaining -= canRemove;\n\n        if (slot.quantity <= 0) {\n          slot.resourceId = null;\n          slot.quantity = 0;\n          slot.durability = undefined;\n        }\n      }\n    }\n\n    const removed = quantity - remaining;\n\n    if (removed > 0) {\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId,\n        delta: -removed,\n      });\n    }\n\n    return removed;\n  }\n\n  /**\n   * Check if inventory has a certain amount of an item\n   */\n  public hasItem(resourceId: string, quantity: number = 1): boolean {\n    return this.getItemCount(resourceId) >= quantity;\n  }\n\n  /**\n   * Get total count of an item\n   */\n  public getItemCount(resourceId: string): number {\n    return this.slots\n      .filter(slot => slot.resourceId === resourceId)\n      .reduce((sum, slot) => sum + slot.quantity, 0);\n  }\n\n  /**\n   * Check if inventory has space for items\n   */\n  public hasSpace(resourceId: string, quantity: number = 1): boolean {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n    if (!resource) return false;\n\n    const stackSize = resource.stackSize;\n    let canFit = 0;\n\n    // Check existing stacks\n    if (stackSize > 1) {\n      for (const slot of this.slots) {\n        if (slot.resourceId === resourceId) {\n          canFit += stackSize - slot.quantity;\n        }\n      }\n    }\n\n    // Check empty slots\n    for (const slot of this.slots) {\n      if (slot.resourceId === null) {\n        canFit += stackSize;\n      }\n    }\n\n    return canFit >= quantity;\n  }\n\n  /**\n   * Get number of empty slots\n   */\n  public getEmptySlotCount(): number {\n    return this.slots.filter(slot => slot.resourceId === null).length;\n  }\n\n  /**\n   * Check if inventory is full\n   */\n  public isFull(): boolean {\n    return this.getEmptySlotCount() === 0;\n  }\n\n  /**\n   * Move item between slots\n   */\n  public moveItem(fromIndex: number, toIndex: number): boolean {\n    if (fromIndex < 0 || fromIndex >= this.slots.length) return false;\n    if (toIndex < 0 || toIndex >= this.slots.length) return false;\n    if (fromIndex === toIndex) return false;\n\n    const fromSlot = this.slots[fromIndex];\n    const toSlot = this.slots[toIndex];\n\n    // If target is empty, just move\n    if (toSlot.resourceId === null) {\n      toSlot.resourceId = fromSlot.resourceId;\n      toSlot.quantity = fromSlot.quantity;\n      toSlot.durability = fromSlot.durability;\n      fromSlot.resourceId = null;\n      fromSlot.quantity = 0;\n      fromSlot.durability = undefined;\n      return true;\n    }\n\n    // If same item type, try to stack\n    if (toSlot.resourceId === fromSlot.resourceId) {\n      const resourceManager = getResourceManager();\n      const resource = resourceManager.getResource(toSlot.resourceId!);\n      if (resource && resource.stackSize > 1) {\n        const canMove = Math.min(fromSlot.quantity, resource.stackSize - toSlot.quantity);\n        toSlot.quantity += canMove;\n        fromSlot.quantity -= canMove;\n        if (fromSlot.quantity <= 0) {\n          fromSlot.resourceId = null;\n          fromSlot.quantity = 0;\n          fromSlot.durability = undefined;\n        }\n        return true;\n      }\n    }\n\n    // Otherwise, swap\n    const temp = { ...fromSlot };\n    fromSlot.resourceId = toSlot.resourceId;\n    fromSlot.quantity = toSlot.quantity;\n    fromSlot.durability = toSlot.durability;\n    toSlot.resourceId = temp.resourceId;\n    toSlot.quantity = temp.quantity;\n    toSlot.durability = temp.durability;\n\n    return true;\n  }\n\n  /**\n   * Use durability on an item (for tools/weapons)\n   * Returns true if item broke\n   */\n  public useDurability(index: number, amount: number = 1): boolean {\n    const slot = this.slots[index];\n    if (!slot || slot.durability === undefined) return false;\n\n    slot.durability -= amount;\n    if (slot.durability <= 0) {\n      const resourceId = slot.resourceId;\n      slot.resourceId = null;\n      slot.quantity = 0;\n      slot.durability = undefined;\n\n      const eventBus = getEventBus();\n      eventBus.emit('player:inventoryChanged', {\n        itemId: resourceId!,\n        delta: -1,\n      });\n\n      return true; // Item broke\n    }\n\n    return false;\n  }\n\n  /**\n   * Clear the inventory\n   */\n  public clear(): void {\n    this.initializeSlots();\n  }\n\n  /**\n   * Serialize for saving\n   */\n  public serialize(): Array<{ itemId: string; quantity: number; durability?: number }> {\n    const items: Array<{ itemId: string; quantity: number; durability?: number }> = [];\n\n    for (const slot of this.slots) {\n      if (slot.resourceId) {\n        items.push({\n          itemId: slot.resourceId,\n          quantity: slot.quantity,\n          durability: slot.durability,\n        });\n      }\n    }\n\n    return items;\n  }\n\n  /**\n   * Deserialize from save data\n   */\n  public deserialize(items: Array<{ itemId: string; quantity: number; durability?: number }>): void {\n    this.clear();\n    for (const item of items) {\n      this.addItem(item.itemId, item.quantity, item.durability);\n    }\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet inventoryManagerInstance: InventoryManager | null = null;\n\nexport function getInventoryManager(): InventoryManager {\n  if (!inventoryManagerInstance) {\n    inventoryManagerInstance = new InventoryManager();\n  }\n  return inventoryManagerInstance;\n}\n","/**\n * CraftingManager - Manages crafting recipes and crafting operations\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1:\n * Requires 20+ recipes functional\n */\n\nimport { getEventBus } from '@core/EventBus';\nimport { getInventoryManager, InventoryManager } from './InventoryManager';\n\n// ============================================================================\n// Crafting Types\n// ============================================================================\n\nexport enum CraftingStation {\n  Hand = 'hand',           // No station required\n  Workbench = 'workbench',\n  Furnace = 'furnace',\n  Anvil = 'anvil',\n  Alchemy = 'alchemy',\n  Loom = 'loom',\n}\n\nexport interface RecipeIngredient {\n  resourceId: string;\n  quantity: number;\n  consumed: boolean;  // If false, item is a tool/catalyst\n}\n\nexport interface RecipeOutput {\n  resourceId: string;\n  quantity: number;\n}\n\nexport interface Recipe {\n  id: string;\n  name: string;\n  description: string;\n  inputs: RecipeIngredient[];\n  outputs: RecipeOutput[];\n  craftTime: number;         // Seconds to craft\n  requiredStation: CraftingStation;\n  skillRequired?: string;    // Future: skill requirements\n  skillLevel?: number;\n}\n\n// ============================================================================\n// Default Recipes (20+ per spec requirement)\n// ============================================================================\n\nconst DEFAULT_RECIPES: Recipe[] = [\n  // ===== HAND CRAFTING (No station) =====\n  {\n    id: 'craft_wooden_plank',\n    name: 'Wooden Plank',\n    description: 'Process wood into planks',\n    inputs: [{ resourceId: 'wood', quantity: 1, consumed: true }],\n    outputs: [{ resourceId: 'wooden_plank', quantity: 4 }],\n    craftTime: 2,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_rope',\n    name: 'Rope',\n    description: 'Weave fibers into rope',\n    inputs: [{ resourceId: 'fiber', quantity: 5, consumed: true }],\n    outputs: [{ resourceId: 'rope', quantity: 1 }],\n    craftTime: 3,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_bandage',\n    name: 'Bandage',\n    description: 'Create a simple bandage',\n    inputs: [{ resourceId: 'cloth', quantity: 2, consumed: true }],\n    outputs: [{ resourceId: 'bandage', quantity: 1 }],\n    craftTime: 2,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_wooden_sword',\n    name: 'Wooden Sword',\n    description: 'Carve a basic wooden sword',\n    inputs: [\n      { resourceId: 'wood', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'wooden_sword', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Hand,\n  },\n  {\n    id: 'craft_arrow',\n    name: 'Arrows',\n    description: 'Craft a bundle of arrows',\n    inputs: [\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'stone', quantity: 1, consumed: true },\n      { resourceId: 'fiber', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'arrow', quantity: 10 }],\n    craftTime: 4,\n    requiredStation: CraftingStation.Hand,\n  },\n\n  // ===== WORKBENCH RECIPES =====\n  {\n    id: 'craft_stone_pickaxe',\n    name: 'Stone Pickaxe',\n    description: 'Craft a stone mining tool',\n    inputs: [\n      { resourceId: 'wood', quantity: 2, consumed: true },\n      { resourceId: 'stone', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_pickaxe', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_axe',\n    name: 'Stone Axe',\n    description: 'Craft a stone woodcutting tool',\n    inputs: [\n      { resourceId: 'wood', quantity: 2, consumed: true },\n      { resourceId: 'stone', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_axe', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_sword',\n    name: 'Stone Sword',\n    description: 'Craft a stone blade',\n    inputs: [\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'stone', quantity: 4, consumed: true },\n      { resourceId: 'fiber', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'stone_sword', quantity: 1 }],\n    craftTime: 6,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_bow',\n    name: 'Wooden Bow',\n    description: 'Craft a hunting bow',\n    inputs: [\n      { resourceId: 'wood', quantity: 3, consumed: true },\n      { resourceId: 'fiber', quantity: 5, consumed: true },\n    ],\n    outputs: [{ resourceId: 'bow', quantity: 1 }],\n    craftTime: 8,\n    requiredStation: CraftingStation.Workbench,\n  },\n  {\n    id: 'craft_stone_brick',\n    name: 'Stone Bricks',\n    description: 'Cut stone into building bricks',\n    inputs: [{ resourceId: 'stone', quantity: 2, consumed: true }],\n    outputs: [{ resourceId: 'stone_brick', quantity: 4 }],\n    craftTime: 4,\n    requiredStation: CraftingStation.Workbench,\n  },\n\n  // ===== FURNACE RECIPES =====\n  {\n    id: 'smelt_iron',\n    name: 'Iron Ingot',\n    description: 'Smelt iron ore into an ingot',\n    inputs: [\n      { resourceId: 'iron_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_ingot', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'smelt_copper',\n    name: 'Copper Ingot',\n    description: 'Smelt copper ore into an ingot',\n    inputs: [\n      { resourceId: 'copper_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'copper_ingot', quantity: 1 }],\n    craftTime: 8,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'smelt_gold',\n    name: 'Gold Ingot',\n    description: 'Smelt gold ore into an ingot',\n    inputs: [\n      { resourceId: 'gold_ore', quantity: 2, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'gold_ingot', quantity: 1 }],\n    craftTime: 12,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'cook_meat',\n    name: 'Cooked Meat',\n    description: 'Cook raw meat',\n    inputs: [\n      { resourceId: 'raw_meat', quantity: 1, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'cooked_meat', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Furnace,\n  },\n  {\n    id: 'bake_bread',\n    name: 'Bread',\n    description: 'Bake bread from fiber (wheat)',\n    inputs: [\n      { resourceId: 'fiber', quantity: 3, consumed: true },\n      { resourceId: 'coal', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'bread', quantity: 1 }],\n    craftTime: 6,\n    requiredStation: CraftingStation.Furnace,\n  },\n\n  // ===== ANVIL RECIPES =====\n  {\n    id: 'craft_iron_pickaxe',\n    name: 'Iron Pickaxe',\n    description: 'Forge an iron mining tool',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 3, consumed: true },\n      { resourceId: 'wood', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_pickaxe', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Anvil,\n  },\n  {\n    id: 'craft_iron_axe',\n    name: 'Iron Axe',\n    description: 'Forge an iron woodcutting tool',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 3, consumed: true },\n      { resourceId: 'wood', quantity: 2, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_axe', quantity: 1 }],\n    craftTime: 10,\n    requiredStation: CraftingStation.Anvil,\n  },\n  {\n    id: 'craft_iron_sword',\n    name: 'Iron Sword',\n    description: 'Forge an iron blade',\n    inputs: [\n      { resourceId: 'iron_ingot', quantity: 4, consumed: true },\n      { resourceId: 'wood', quantity: 1, consumed: true },\n      { resourceId: 'leather', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'iron_sword', quantity: 1 }],\n    craftTime: 12,\n    requiredStation: CraftingStation.Anvil,\n  },\n\n  // ===== LOOM RECIPES =====\n  {\n    id: 'craft_cloth',\n    name: 'Cloth',\n    description: 'Weave fibers into cloth',\n    inputs: [{ resourceId: 'fiber', quantity: 4, consumed: true }],\n    outputs: [{ resourceId: 'cloth', quantity: 1 }],\n    craftTime: 5,\n    requiredStation: CraftingStation.Loom,\n  },\n\n  // ===== ALCHEMY RECIPES =====\n  {\n    id: 'brew_health_potion',\n    name: 'Health Potion',\n    description: 'Brew a healing potion',\n    inputs: [\n      { resourceId: 'mushroom', quantity: 3, consumed: true },\n      { resourceId: 'berries', quantity: 2, consumed: true },\n      { resourceId: 'monster_essence', quantity: 1, consumed: true },\n    ],\n    outputs: [{ resourceId: 'health_potion', quantity: 1 }],\n    craftTime: 15,\n    requiredStation: CraftingStation.Alchemy,\n  },\n];\n\n// ============================================================================\n// CraftingManager Implementation\n// ============================================================================\n\nexport class CraftingManager {\n  private recipes: Map<string, Recipe> = new Map();\n  private activeCrafts: Map<string, { recipe: Recipe; startTime: number; stationId: string }> = new Map();\n\n  constructor() {\n    // Register default recipes\n    for (const recipe of DEFAULT_RECIPES) {\n      this.registerRecipe(recipe);\n    }\n  }\n\n  /**\n   * Register a new recipe\n   */\n  public registerRecipe(recipe: Recipe): void {\n    this.recipes.set(recipe.id, recipe);\n  }\n\n  /**\n   * Get a recipe by ID\n   */\n  public getRecipe(id: string): Recipe | undefined {\n    return this.recipes.get(id);\n  }\n\n  /**\n   * Get all recipes\n   */\n  public getAllRecipes(): Recipe[] {\n    return Array.from(this.recipes.values());\n  }\n\n  /**\n   * Get recipes for a specific station\n   */\n  public getRecipesForStation(station: CraftingStation): Recipe[] {\n    return this.getAllRecipes().filter(r => r.requiredStation === station);\n  }\n\n  /**\n   * Get recipe count (should be 20+ per spec)\n   */\n  public getRecipeCount(): number {\n    return this.recipes.size;\n  }\n\n  /**\n   * Check if player can craft a recipe\n   */\n  public canCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    availableStation: CraftingStation = CraftingStation.Hand\n  ): boolean {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return false;\n\n    // Check station requirement\n    if (recipe.requiredStation !== CraftingStation.Hand &&\n        recipe.requiredStation !== availableStation) {\n      return false;\n    }\n\n    // Check ingredients\n    for (const input of recipe.inputs) {\n      if (!inventory.hasItem(input.resourceId, input.quantity)) {\n        return false;\n      }\n    }\n\n    // Check output space\n    for (const output of recipe.outputs) {\n      if (!inventory.hasSpace(output.resourceId, output.quantity)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Get missing ingredients for a recipe\n   */\n  public getMissingIngredients(\n    recipeId: string,\n    inventory: InventoryManager\n  ): Array<{ resourceId: string; have: number; need: number }> {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return [];\n\n    const missing: Array<{ resourceId: string; have: number; need: number }> = [];\n\n    for (const input of recipe.inputs) {\n      const have = inventory.getItemCount(input.resourceId);\n      if (have < input.quantity) {\n        missing.push({\n          resourceId: input.resourceId,\n          have,\n          need: input.quantity,\n        });\n      }\n    }\n\n    return missing;\n  }\n\n  /**\n   * Start crafting a recipe (for timed crafting)\n   */\n  public startCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    stationId: string = 'hand'\n  ): string | null {\n    const recipe = this.getRecipe(recipeId);\n    if (!recipe) return null;\n\n    // Consume ingredients\n    for (const input of recipe.inputs) {\n      if (input.consumed) {\n        inventory.removeItem(input.resourceId, input.quantity);\n      }\n    }\n\n    const craftId = `${recipeId}_${Date.now()}`;\n    this.activeCrafts.set(craftId, {\n      recipe,\n      startTime: Date.now(),\n      stationId,\n    });\n\n    return craftId;\n  }\n\n  /**\n   * Check if a craft is complete\n   */\n  public isCraftComplete(craftId: string): boolean {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft) return false;\n\n    const elapsed = (Date.now() - craft.startTime) / 1000;\n    return elapsed >= craft.recipe.craftTime;\n  }\n\n  /**\n   * Get craft progress (0-1)\n   */\n  public getCraftProgress(craftId: string): number {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft) return 0;\n\n    const elapsed = (Date.now() - craft.startTime) / 1000;\n    return Math.min(1, elapsed / craft.recipe.craftTime);\n  }\n\n  /**\n   * Complete a craft and receive outputs\n   */\n  public completeCraft(craftId: string, inventory: InventoryManager): boolean {\n    const craft = this.activeCrafts.get(craftId);\n    if (!craft || !this.isCraftComplete(craftId)) return false;\n\n    // Give outputs\n    for (const output of craft.recipe.outputs) {\n      inventory.addItem(output.resourceId, output.quantity);\n    }\n\n    this.activeCrafts.delete(craftId);\n    return true;\n  }\n\n  /**\n   * Cancel an active craft (ingredients are lost)\n   */\n  public cancelCraft(craftId: string): boolean {\n    return this.activeCrafts.delete(craftId);\n  }\n\n  /**\n   * Instant craft (for simple recipes or testing)\n   */\n  public instantCraft(\n    recipeId: string,\n    inventory: InventoryManager,\n    station: CraftingStation = CraftingStation.Hand\n  ): boolean {\n    if (!this.canCraft(recipeId, inventory, station)) return false;\n\n    const recipe = this.getRecipe(recipeId)!;\n\n    // Consume ingredients\n    for (const input of recipe.inputs) {\n      if (input.consumed) {\n        inventory.removeItem(input.resourceId, input.quantity);\n      }\n    }\n\n    // Give outputs\n    for (const output of recipe.outputs) {\n      inventory.addItem(output.resourceId, output.quantity);\n    }\n\n    return true;\n  }\n\n  /**\n   * Get all craftable recipes with current inventory\n   */\n  public getCraftableRecipes(\n    inventory: InventoryManager,\n    station: CraftingStation = CraftingStation.Hand\n  ): Recipe[] {\n    return this.getAllRecipes().filter(recipe =>\n      this.canCraft(recipe.id, inventory, station)\n    );\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet craftingManagerInstance: CraftingManager | null = null;\n\nexport function getCraftingManager(): CraftingManager {\n  if (!craftingManagerInstance) {\n    craftingManagerInstance = new CraftingManager();\n  }\n  return craftingManagerInstance;\n}\n","/**\n * SurvivalManager - Manages player survival mechanics\n *\n * Per 2D_GAME_IMPLEMENTATION_PLAN.md - Phase 1 Survival Mechanics:\n * - Health: Via damage, 0 = death\n * - Hunger: 2.0/hour decay, 20 critical = health drain, speed reduction\n * - Stamina: Via actions, 0 = cannot sprint, reduced actions\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport type { GameTime } from '@core/types';\nimport { getResourceManager } from './ResourceManager';\n\n// ============================================================================\n// Survival Configuration\n// ============================================================================\n\nexport interface SurvivalConfig {\n  maxHealth: number;\n  maxHunger: number;\n  maxStamina: number;\n\n  hungerDecayRate: number;     // Per game hour\n  staminaRegenRate: number;    // Per second when resting\n  hungerCritical: number;      // Below this, negative effects apply\n  staminaCritical: number;     // Below this, cannot sprint\n\n  hungerHealthDrain: number;   // Health lost per second when critical\n  hungerSpeedPenalty: number;  // Speed multiplier when hungry (0.5 = 50%)\n\n  sprintStaminaCost: number;   // Stamina per second while sprinting\n  attackStaminaCost: number;   // Stamina per attack\n  mineStaminaCost: number;     // Stamina per mining action\n}\n\nconst DEFAULT_CONFIG: SurvivalConfig = {\n  maxHealth: 100,\n  maxHunger: 100,\n  maxStamina: 100,\n\n  hungerDecayRate: 2.0,\n  staminaRegenRate: 10,\n  hungerCritical: 20,\n  staminaCritical: 10,\n\n  hungerHealthDrain: 1,\n  hungerSpeedPenalty: 0.5,\n\n  sprintStaminaCost: 15,\n  attackStaminaCost: 10,\n  mineStaminaCost: 5,\n};\n\n// ============================================================================\n// Player Stats\n// ============================================================================\n\nexport interface PlayerStats {\n  health: number;\n  maxHealth: number;\n  hunger: number;\n  maxHunger: number;\n  stamina: number;\n  maxStamina: number;\n}\n\n// ============================================================================\n// SurvivalManager Implementation\n// ============================================================================\n\nexport class SurvivalManager implements GameSystem {\n  public readonly name = 'SurvivalManager';\n\n  private config: SurvivalConfig;\n  private health: number;\n  private hunger: number;\n  private stamina: number;\n  private isResting: boolean = false;\n  private isSprinting: boolean = false;\n  private isDead: boolean = false;\n\n  // Accumulator for hunger decay (tracks fractional game hours)\n  private hungerAccumulator: number = 0;\n\n  constructor(config: Partial<SurvivalConfig> = {}) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.health = this.config.maxHealth;\n    this.hunger = this.config.maxHunger;\n    this.stamina = this.config.maxStamina;\n  }\n\n  /**\n   * Initialize the survival manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for sprint state changes\n    eventBus.on('input:actionPressed', (event) => {\n      if (event.action === 'sprint') {\n        this.isSprinting = true;\n      }\n    });\n\n    eventBus.on('input:actionReleased', (event) => {\n      if (event.action === 'sprint') {\n        this.isSprinting = false;\n      }\n    });\n\n    console.log('[SurvivalManager] Initialized');\n  }\n\n  /**\n   * Update survival mechanics each frame\n   */\n  public update(deltaTime: number, gameTime: GameTime): void {\n    if (this.isDead) return;\n\n    // Update hunger based on game time\n    this.updateHunger(deltaTime, gameTime);\n\n    // Update stamina\n    this.updateStamina(deltaTime);\n\n    // Apply critical hunger effects\n    this.applyCriticalEffects(deltaTime);\n  }\n\n  /**\n   * Update hunger decay\n   */\n  private updateHunger(deltaTime: number, gameTime: GameTime): void {\n    // Convert real time to game hours (assuming 1 game hour = 1 minute real time)\n    const gameHoursPerSecond = 1 / 60; // 1 hour per 60 real seconds\n    this.hungerAccumulator += deltaTime * gameHoursPerSecond * this.config.hungerDecayRate;\n\n    // Apply accumulated hunger decay\n    if (this.hungerAccumulator >= 1) {\n      const decay = Math.floor(this.hungerAccumulator);\n      this.hunger = Math.max(0, this.hunger - decay);\n      this.hungerAccumulator -= decay;\n    }\n  }\n\n  /**\n   * Update stamina (drain if sprinting, regen if resting)\n   */\n  private updateStamina(deltaTime: number): void {\n    if (this.isSprinting && this.stamina > 0) {\n      this.stamina = Math.max(0, this.stamina - this.config.sprintStaminaCost * deltaTime);\n    } else if (!this.isSprinting && this.stamina < this.config.maxStamina) {\n      // Regen rate is reduced if hungry\n      const regenMultiplier = this.isHungryCritical() ? 0.5 : 1.0;\n      this.stamina = Math.min(\n        this.config.maxStamina,\n        this.stamina + this.config.staminaRegenRate * deltaTime * regenMultiplier\n      );\n    }\n  }\n\n  /**\n   * Apply effects when survival stats are critical\n   */\n  private applyCriticalEffects(deltaTime: number): void {\n    // Health drain from starvation\n    if (this.isHungryCritical()) {\n      this.takeDamage(this.config.hungerHealthDrain * deltaTime, 'starvation');\n    }\n  }\n\n  // ==========================================================================\n  // Public API - Health\n  // ==========================================================================\n\n  /**\n   * Get current health\n   */\n  public getHealth(): number {\n    return this.health;\n  }\n\n  /**\n   * Get max health\n   */\n  public getMaxHealth(): number {\n    return this.config.maxHealth;\n  }\n\n  /**\n   * Take damage\n   */\n  public takeDamage(amount: number, source: string = 'unknown'): void {\n    if (this.isDead) return;\n\n    this.health = Math.max(0, this.health - amount);\n\n    const eventBus = getEventBus();\n    eventBus.emit('entity:damaged', {\n      entityId: 'player',\n      amount,\n      sourceId: source,\n    });\n\n    if (this.health <= 0) {\n      this.die();\n    }\n  }\n\n  /**\n   * Heal the player\n   */\n  public heal(amount: number): void {\n    if (this.isDead) return;\n\n    const oldHealth = this.health;\n    this.health = Math.min(this.config.maxHealth, this.health + amount);\n    const healed = this.health - oldHealth;\n\n    if (healed > 0) {\n      const eventBus = getEventBus();\n      eventBus.emit('entity:healed', {\n        entityId: 'player',\n        amount: healed,\n      });\n    }\n  }\n\n  /**\n   * Check if player is dead\n   */\n  public isPlayerDead(): boolean {\n    return this.isDead;\n  }\n\n  /**\n   * Handle player death\n   */\n  private die(): void {\n    this.isDead = true;\n    const eventBus = getEventBus();\n    eventBus.emit('entity:died', {\n      entityId: 'player',\n      killerId: null,\n    });\n  }\n\n  /**\n   * Respawn player (reset stats)\n   */\n  public respawn(): void {\n    this.health = this.config.maxHealth;\n    this.hunger = this.config.maxHunger;\n    this.stamina = this.config.maxStamina;\n    this.isDead = false;\n    this.hungerAccumulator = 0;\n  }\n\n  // ==========================================================================\n  // Public API - Hunger\n  // ==========================================================================\n\n  /**\n   * Get current hunger\n   */\n  public getHunger(): number {\n    return this.hunger;\n  }\n\n  /**\n   * Get max hunger\n   */\n  public getMaxHunger(): number {\n    return this.config.maxHunger;\n  }\n\n  /**\n   * Check if hunger is critical\n   */\n  public isHungryCritical(): boolean {\n    return this.hunger <= this.config.hungerCritical;\n  }\n\n  /**\n   * Restore hunger (eating)\n   */\n  public restoreHunger(amount: number): void {\n    this.hunger = Math.min(this.config.maxHunger, this.hunger + amount);\n  }\n\n  /**\n   * Get speed multiplier based on hunger\n   */\n  public getSpeedMultiplier(): number {\n    return this.isHungryCritical() ? this.config.hungerSpeedPenalty : 1.0;\n  }\n\n  // ==========================================================================\n  // Public API - Stamina\n  // ==========================================================================\n\n  /**\n   * Get current stamina\n   */\n  public getStamina(): number {\n    return this.stamina;\n  }\n\n  /**\n   * Get max stamina\n   */\n  public getMaxStamina(): number {\n    return this.config.maxStamina;\n  }\n\n  /**\n   * Check if stamina is critical\n   */\n  public isStaminaCritical(): boolean {\n    return this.stamina <= this.config.staminaCritical;\n  }\n\n  /**\n   * Check if player can sprint\n   */\n  public canSprint(): boolean {\n    return this.stamina > this.config.staminaCritical;\n  }\n\n  /**\n   * Use stamina for an action\n   * Returns true if action was possible\n   */\n  public useStamina(amount: number): boolean {\n    if (this.stamina < amount) return false;\n    this.stamina -= amount;\n    return true;\n  }\n\n  /**\n   * Use stamina for attack\n   */\n  public useAttackStamina(): boolean {\n    return this.useStamina(this.config.attackStaminaCost);\n  }\n\n  /**\n   * Use stamina for mining\n   */\n  public useMineStamina(): boolean {\n    return this.useStamina(this.config.mineStaminaCost);\n  }\n\n  // ==========================================================================\n  // Public API - Consumables\n  // ==========================================================================\n\n  /**\n   * Consume a food/consumable item\n   * Returns true if consumed successfully\n   */\n  public consume(resourceId: string): boolean {\n    const resourceManager = getResourceManager();\n    const resource = resourceManager.getResource(resourceId);\n\n    if (!resource) return false;\n    if (!resourceManager.isConsumable(resourceId)) return false;\n\n    // Apply effects\n    if (resource.healAmount) {\n      if (resource.healAmount > 0) {\n        this.heal(resource.healAmount);\n      } else {\n        this.takeDamage(-resource.healAmount, 'food_poisoning');\n      }\n    }\n\n    if (resource.hungerRestore) {\n      this.restoreHunger(resource.hungerRestore);\n    }\n\n    return true;\n  }\n\n  // ==========================================================================\n  // Stats Summary\n  // ==========================================================================\n\n  /**\n   * Get all player stats\n   */\n  public getStats(): PlayerStats {\n    return {\n      health: this.health,\n      maxHealth: this.config.maxHealth,\n      hunger: this.hunger,\n      maxHunger: this.config.maxHunger,\n      stamina: this.stamina,\n      maxStamina: this.config.maxStamina,\n    };\n  }\n\n  /**\n   * Set stats (for loading saves)\n   */\n  public setStats(stats: Partial<PlayerStats>): void {\n    if (stats.health !== undefined) this.health = stats.health;\n    if (stats.hunger !== undefined) this.hunger = stats.hunger;\n    if (stats.stamina !== undefined) this.stamina = stats.stamina;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    console.log('[SurvivalManager] Destroyed');\n  }\n}\n\n// ============================================================================\n// Singleton Access\n// ============================================================================\n\nlet survivalManagerInstance: SurvivalManager | null = null;\n\nexport function getSurvivalManager(): SurvivalManager {\n  if (!survivalManagerInstance) {\n    survivalManagerInstance = new SurvivalManager();\n  }\n  return survivalManagerInstance;\n}\n","/**\n * UIManager - Manages game UI panels and HUD\n *\n * Handles panel visibility, modal stacking, and tooltips.\n */\n\nimport type { GameSystem } from '@core/GameEngine';\nimport { getEventBus } from '@core/EventBus';\nimport { PanelType } from '@core/types';\nimport type { UIState, Vector2, GameTime } from '@core/types';\n\n// ============================================================================\n// UIManager Implementation\n// ============================================================================\n\nexport class UIManager implements GameSystem {\n  public readonly name = 'UIManager';\n\n  private state: UIState = {\n    activePanels: new Set([PanelType.HUD]),\n    modalStack: [],\n    tooltipContent: null,\n    tooltipPosition: null,\n  };\n\n  // Panel render callbacks\n  private panelRenderers: Map<PanelType, () => void> = new Map();\n\n  // UI element update callbacks (for external rendering systems)\n  private updateCallbacks: Set<(state: UIState) => void> = new Set();\n\n  /**\n   * Initialize the UI manager\n   */\n  public initialize(): void {\n    const eventBus = getEventBus();\n\n    // Listen for panel events from other systems\n    eventBus.on('ui:tooltipShow', (event) => {\n      this.showTooltip(event.content, event.position);\n    });\n\n    eventBus.on('ui:tooltipHide', () => {\n      this.hideTooltip();\n    });\n\n    console.log('[UIManager] Initialized');\n  }\n\n  /**\n   * Update - notify render callbacks\n   */\n  public update(_deltaTime: number, _gameTime: GameTime): void {\n    // Notify all update callbacks\n    for (const callback of this.updateCallbacks) {\n      callback(this.state);\n    }\n  }\n\n  // ============================================================================\n  // Panel Management\n  // ============================================================================\n\n  /**\n   * Open a panel\n   */\n  public openPanel(panel: PanelType, modal = false): void {\n    if (this.isPanelOpen(panel)) {\n      return;\n    }\n\n    this.state.activePanels.add(panel);\n\n    if (modal) {\n      this.state.modalStack.push(panel);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelOpened', { panel });\n  }\n\n  /**\n   * Close a panel\n   */\n  public closePanel(panel: PanelType): void {\n    if (!this.isPanelOpen(panel)) {\n      return;\n    }\n\n    this.state.activePanels.delete(panel);\n\n    // Remove from modal stack if present\n    const modalIndex = this.state.modalStack.indexOf(panel);\n    if (modalIndex !== -1) {\n      this.state.modalStack.splice(modalIndex, 1);\n    }\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelClosed', { panel });\n  }\n\n  /**\n   * Toggle a panel\n   */\n  public togglePanel(panel: PanelType, modal = false): void {\n    if (this.isPanelOpen(panel)) {\n      this.closePanel(panel);\n    } else {\n      this.openPanel(panel, modal);\n    }\n  }\n\n  /**\n   * Check if a panel is open\n   */\n  public isPanelOpen(panel: PanelType): boolean {\n    return this.state.activePanels.has(panel);\n  }\n\n  /**\n   * Close the topmost modal\n   */\n  public closeTopModal(): boolean {\n    if (this.state.modalStack.length === 0) {\n      return false;\n    }\n\n    const topModal = this.state.modalStack.pop()!;\n    this.state.activePanels.delete(topModal);\n\n    const eventBus = getEventBus();\n    eventBus.emit('ui:panelClosed', { panel: topModal });\n\n    return true;\n  }\n\n  /**\n   * Close all modals\n   */\n  public closeAllModals(): void {\n    while (this.closeTopModal()) {\n      // Continue until all modals closed\n    }\n  }\n\n  /**\n   * Get the topmost modal panel\n   */\n  public getTopModal(): PanelType | null {\n    if (this.state.modalStack.length === 0) {\n      return null;\n    }\n    return this.state.modalStack[this.state.modalStack.length - 1];\n  }\n\n  /**\n   * Check if any modal is open\n   */\n  public hasOpenModal(): boolean {\n    return this.state.modalStack.length > 0;\n  }\n\n  // ============================================================================\n  // Tooltip Management\n  // ============================================================================\n\n  /**\n   * Show a tooltip\n   */\n  public showTooltip(content: string, position: Vector2): void {\n    this.state.tooltipContent = content;\n    this.state.tooltipPosition = { ...position };\n  }\n\n  /**\n   * Hide the tooltip\n   */\n  public hideTooltip(): void {\n    this.state.tooltipContent = null;\n    this.state.tooltipPosition = null;\n  }\n\n  /**\n   * Check if tooltip is visible\n   */\n  public isTooltipVisible(): boolean {\n    return this.state.tooltipContent !== null;\n  }\n\n  /**\n   * Get tooltip content\n   */\n  public getTooltipContent(): string | null {\n    return this.state.tooltipContent;\n  }\n\n  /**\n   * Get tooltip position\n   */\n  public getTooltipPosition(): Vector2 | null {\n    return this.state.tooltipPosition;\n  }\n\n  // ============================================================================\n  // Render Callback Management\n  // ============================================================================\n\n  /**\n   * Register a panel renderer\n   */\n  public registerPanelRenderer(panel: PanelType, renderer: () => void): void {\n    this.panelRenderers.set(panel, renderer);\n  }\n\n  /**\n   * Unregister a panel renderer\n   */\n  public unregisterPanelRenderer(panel: PanelType): void {\n    this.panelRenderers.delete(panel);\n  }\n\n  /**\n   * Register an update callback\n   */\n  public onUpdate(callback: (state: UIState) => void): () => void {\n    this.updateCallbacks.add(callback);\n    return () => this.updateCallbacks.delete(callback);\n  }\n\n  // ============================================================================\n  // State Access\n  // ============================================================================\n\n  /**\n   * Get all active panels\n   */\n  public getActivePanels(): ReadonlySet<PanelType> {\n    return this.state.activePanels;\n  }\n\n  /**\n   * Get the modal stack\n   */\n  public getModalStack(): readonly PanelType[] {\n    return this.state.modalStack;\n  }\n\n  /**\n   * Get the full UI state\n   */\n  public getState(): Readonly<UIState> {\n    return this.state;\n  }\n\n  /**\n   * Cleanup\n   */\n  public destroy(): void {\n    this.state.activePanels.clear();\n    this.state.modalStack = [];\n    this.panelRenderers.clear();\n    this.updateCallbacks.clear();\n    console.log('[UIManager] Destroyed');\n  }\n}\n","/**\n * 2D RPG Game - Main Entry Point\n *\n * Phase 0 Foundation Systems per 2D_GAME_IMPLEMENTATION_PLAN.md\n */\n\n// Core engine\nexport * from './core';\n\n// World systems\nexport * from './world';\n\n// Entities\nexport * from './entities';\n\n// Game systems\nexport * from './systems';\n\n// UI\nexport * from './ui';\n\n// ============================================================================\n// Game Initialization\n// ============================================================================\n\nimport { GameEngine, getGameEngine } from './core';\nimport { TilemapManager, TileRegistry, AutotileSystem, RegionManager } from './world';\nimport { PlayerController, CameraSystem } from './entities';\nimport { InputManager, SaveManager } from './systems';\nimport { UIManager } from './ui';\n\n/**\n * Initialize and start the game\n */\nexport async function initializeGame(): Promise<GameEngine> {\n  const engine = getGameEngine();\n\n  // Register core systems in order\n  const inputManager = new InputManager();\n  const tilemapManager = new TilemapManager();\n  const autotileSystem = new AutotileSystem();\n  const regionManager = new RegionManager();\n  const playerController = new PlayerController();\n  const cameraSystem = new CameraSystem();\n  const saveManager = new SaveManager();\n  const uiManager = new UIManager();\n\n  // Connect autotile system to tilemap\n  autotileSystem.setTilemapManager(tilemapManager);\n\n  // Connect player to collision check\n  playerController.setWalkableCheck((x, y) => tilemapManager.isWalkable(x, y));\n\n  // Connect input to camera\n  inputManager.setScreenToWorldConverter((screenX, screenY) => {\n    // Placeholder - would use actual screen dimensions\n    return cameraSystem.screenToWorld(screenX, screenY, 800, 600);\n  });\n\n  // Register systems in update order\n  engine.registerSystem(inputManager, 0);\n  engine.registerSystem(tilemapManager, 1);\n  engine.registerSystem(autotileSystem, 2);\n  engine.registerSystem(regionManager, 3);\n  engine.registerSystem(playerController, 4);\n  engine.registerSystem(cameraSystem, 5);\n  engine.registerSystem(saveManager, 6);\n  engine.registerSystem(uiManager, 7);\n\n  // Initialize all systems\n  await engine.initialize();\n\n  return engine;\n}\n\n/**\n * Quick start for development\n */\nexport async function quickStart(): Promise<void> {\n  console.log('Starting 2D RPG Game...');\n\n  const engine = await initializeGame();\n\n  // Set up a basic world for testing\n  const tilemapManager = engine.getSystem<TilemapManager>('TilemapManager');\n  const playerController = engine.getSystem<PlayerController>('PlayerController');\n  const cameraSystem = engine.getSystem<CameraSystem>('CameraSystem');\n\n  if (tilemapManager) {\n    // Create a simple starting area\n    for (let x = -10; x <= 10; x++) {\n      for (let y = -10; y <= 10; y++) {\n        tilemapManager.setTile(x, y, 1, 'grass'); // Ground layer\n      }\n    }\n\n    // Add some trees\n    tilemapManager.setTile(5, 5, 2, 'tree');\n    tilemapManager.setTile(-3, 2, 2, 'tree');\n    tilemapManager.setTile(7, -4, 2, 'tree');\n\n    // Add some rocks\n    tilemapManager.setTile(-5, -5, 2, 'rock');\n    tilemapManager.setTile(3, -7, 2, 'rock');\n  }\n\n  if (playerController) {\n    playerController.setPosition(0, 0);\n  }\n\n  if (cameraSystem) {\n    cameraSystem.snapTo(0, 0);\n  }\n\n  // Start the game loop\n  engine.start();\n\n  console.log('Game started! Use WASD to move.');\n}\n"],"names":["Direction","EntityType","TileLayer","InputAction","GamepadButton","GamepadAxis","PanelType","EventBus","event","handler","priority","payload","subscribers","sortedSubscribers","b","toRemove","subscription","error","sub","index","queued","once","subs","getEventBus","DEFAULT_CONFIG","GameEngine","config","system","order","name","n","currentTime","deltaTime","secondsPerGameHour","hoursElapsed","previousHour","currentHour","fixedDeltaTime","getGameEngine","createTileType","id","layer","options","TileRegistry","tile","group","getTileRegistry","MAX_LAYER","positionKey","x","y","TilemapManager","_deltaTime","_gameTime","typeId","variant","key","oldTypeId","tileType","ground","bounds","tiles","l","count","data","tileData","eventBus","change","Neighbor4","Neighbor8","VARIANT_MAP_4BIT","VARIANT_MAP_8BIT","maskIrrelevantCorners","bitmask","masked","calculate8BitVariant","maskedBitmask","AutotileSystem","manager","position","autotileGroup","tileRegistry","matchesGroup","nx","ny","neighbor","bitmask4","bitmask8","width","height","tx","ty","RegionManager","currentRegion","worldX","worldY","regionX","regionY","region","playerRegion","loadDistance","unloadDistance","shouldBeLoaded","dx","dy","regions","regionCoords","localX","localY","DEFAULT_PERLIN_CONFIG","DEFAULT_SIMPLEX_CONFIG","createPermutationTable","seed","perm","p","i","j","GRAD3","NoiseGenerator","X","Y","xf","yf","u","v","aa","ab","ba","bb","gradAA","gradBA","gradAB","gradBB","x1","x2","octaves","scale","persistence","lacunarity","total","amplitude","frequency","maxValue","F2","G2","s","t","X0","Y0","x0","y0","i1","j1","y1","y2","ii","jj","gi0","gi1","gi2","n0","n1","n2","t0","t1","t2","sx","sy","cellX","cellY","minDist","neighborX","neighborY","hash","px","py","distX","distY","dist","closestHash","a","h","g","NOISE_CONFIGS","BiomeType","BIOME_DEFINITIONS","DEFAULT_THRESHOLDS","BiomeManager","thresholds","moisture","temperature","biome","random","def","biomeManagerInstance","getBiomeManager","WorldGenerator","startTime","biomeDistribution","regionSize","worldStartX","worldStartY","generatedTiles","generationTimeMs","biomeDef","decorationRandom","decoration","resourceRandom","resource","temperatureLatitudeScale","baseTemp","latitudeEffect","altitudeEffect","spawnAreaSize","radius","angle","sampleSize","biomeCounts","totalTime","samples","start","biomeCount","worldGeneratorInstance","getWorldGenerator","resetWorldGenerator","PlayerState","PlayerController","fn","acceleration","deceleration","walkSpeed","runSpeed","inputX","inputY","inputLength","maxSpeed","targetVelX","targetVelY","newX","newY","canMoveX","canMoveY","oldPosition","tileX","tileY","speed","targetX","targetY","current","target","rate","state","CameraSystem","followSpeed","deadzone","distance","moveAmount","ratio","zoomSpeed","diff","halfWidth","halfHeight","zoom","intensity","pos","screenX","screenY","screenWidth","screenHeight","viewWidth","viewHeight","margin","SAVE_VERSION","STORAGE_PREFIX","MAX_SAVE_SLOTS","SaveManager","provider","consumer","slots","slot","exists","info","autosaveKey","autosaveExists","autosaveInfo","saveData","json","message","migratedData","intervalSeconds","slotName","DEFAULT_BINDINGS","GAMEPAD_CONFIG","InputManager","bindings","action","oldKey","newKey","binding","actions","button","gamepads","gamepad","isPressed","wasPressed","leftX","leftY","oldLeftX","oldLeftY","rightX","rightY","oldRightX","oldRightY","ResourceCategory","DEFAULT_RESOURCES","ResourceManager","category","r","resourceManagerInstance","getResourceManager","InventoryManager","resourceId","quantity","durability","remaining","stackSize","canAdd","canRemove","removed","sum","canFit","fromIndex","toIndex","fromSlot","toSlot","canMove","temp","amount","items","item","inventoryManagerInstance","getInventoryManager","CraftingStation","DEFAULT_RECIPES","CraftingManager","recipe","station","recipeId","inventory","availableStation","input","output","missing","have","stationId","craftId","craft","elapsed","craftingManagerInstance","getCraftingManager","SurvivalManager","gameTime","gameHoursPerSecond","decay","regenMultiplier","source","oldHealth","healed","resourceManager","stats","survivalManagerInstance","getSurvivalManager","UIManager","callback","panel","modal","modalIndex","topModal","content","renderer","initializeGame","engine","inputManager","tilemapManager","autotileSystem","regionManager","playerController","cameraSystem","saveManager","uiManager","quickStart"],"mappings":"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"}